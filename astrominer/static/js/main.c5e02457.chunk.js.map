{"version":3,"sources":["functions/utils.js","functions/constants.js","functions/game.js","functions/fly.js","functions/manage.js","functions/ai.js","functions/savegame.js","fly/Heatbar.js","fly/PushButton.js","fly/StatusButton.js","fly/InfoFly.js","manage/ManagePlanet.js","manage/factory/FactoryButtonRow.js","manage/factory/FactoryTab.js","manage/factory/FactoryTabs.js","manage/ManageStorage.js","manage/ManageSystem.js","manage/ManageLog.js","manage/ManageTabs.js","InfoPanel.js","App.js","serviceWorker.js","index.js"],"names":["distanceBetween","ax","ay","bx","by","Math","sqrt","pow","midPoint","a","b","normalizeRadian","radians","retVal","PI","calcGravity","x","y","planet","distance","gravityDirection","atan2","c","GRAVITATIONAL_CONST","mass","sin","cos","dir","directionTo","x1","y1","x2","y2","dirComponents","amount","xAmt","yAmt","randomInt","minP","maxP","min","ceil","max","floor","random","randomFloat","randomBool","getPointFrom","startX","startY","getVertexData","sprite","calculateVertices","vertices","vertexData","map","p","window","world","system","screenScale","collisionPoints","push","toGlobal","globalX","globalY","spriteX","spriteY","HALF_SCREEN_WIDTH","HALF_SCREEN_HEIGHT","pointInSprite","pX","pY","topLeft","topRight","bottomLeft","AB","toVector","AD","AM","dotAMAB","dot","dotABAB","dotAMAD","dotADAD","p1","p2","u","v","keyboardListener","value","key","isDown","isUp","press","undefined","release","downHandler","event","upHandler","downListener","bind","upListener","addEventListener","unsubscribe","removeEventListener","showToast","text","Swal","fire","title","timer","position","showConfirmButton","toast","width","SCREEN_WIDTH","showClass","popup","hideClass","then","BLACK","YELLOW","BLUE","WHITE","DARK_GREY","LIGHT_GREY","GAME_STATE","INIT","FLY","MANAGE","LOCALSTORAGE_GAME_NAMES_KEY","SCREEN_HEIGHT","NEARBY_WIDTH","NEARBY_HEIGHT","MINIMAP_WIDTH","MINIMAP_HEIGHT","HALF_MINIMAP_WIDTH","HALF_MINIMAP_HEIGHT","MINIMAP_VIEW_WIDTH","MINIMAP_VIEW_HEIGHT","HALF_MINIMAP_VIEW_WIDTH","HALF_MINIMAP_VIEW_HEIGHT","MINIMAP_SCALE_X","MINIMAP_SCALE_Y","MINIMAP_BORDER_COLOR","MINIMAP_BACKGROUND_COLOR","MINIMAP_PLANET_COLOR","MINIMAP_SELECTED_PLANET_COLOR","MINIMAP_BUILDING_COLOR","MINIMAP_SHIP_COLOR","SPRITESHEET_JSON","ALIEN_SHIP_BLACK_FILE","ALIEN_SHIP_BLUE_FILE","ALIEN_SHIP_BLUE_LARGE_FILE","ALIEN_SHIP_BLUE_SMALL_FILE","ALIEN_SHIP_FIRE_FILE","ALIEN_SHIP_GREEN_FILE","ALIEN_SHIP_GREEN_SMALL_FILE","ALIEN_SHIP_GREEN_LARGE_FILE","ALIEN_SHIP_RED_FILE","ALIEN_SHIP_RED_SMALL_FILE","ALIEN_SHIP_RED_LARGE_FILE","BULLET_FILE","BULLET_BLUE_FILE","BULLET_WHITE_FILE","FACTORY_FILE","MINE_FILE","PLANET_GREEN_FILE","PLANET_PURPLE_FILE","PLANET_RED_FILE","PLANET_ROCK_FILE","SHIELD_BLUE_FILE","SHIELD_GREEN_FILE","SHIELD_WHITE_FILE","SHIP_BALL_FILE","SHIP_CARGO_FILE","SHIP_EXPLORER_FILE","SHIP_FAST_FILE","SHIP_FIGHTER_FILE","SHIP_HEAVY_FILE","SHIP_MISSILE_FILE","SHIP_RED_WINGS_FILE","SHIP_SKELETON_FILE","STAR_BACKGROUND_FILE","CRASH_JSON","CRASH","UNIVERSE_RADIUS","PLAYER","ALIEN","PLAYER_STARTING_RESOURCES","titanium","gold","uranium","ALLOWED_OVERLAP","TAKEOFF_SPEED","PLANET_RESOURCE_MAX","PLAYER_START_X","PLAYER_START_Y","MIN_ALIEN_DIST_TO_PLANET","MIN_ALIEN_DIST_TO_ALIEN","BUILDING_PLACEMENT_ROTATION_INCREMENT","BUILDING_TYPE_MINE","MINE_SCALE","MINE_WIDTH","MINE_ANIMATION_SPEED","MINE_SPEED_TITANIUM","MINE_SPEED_GOLD","MINE_SPEED_URANIUM","MINE_COST","SALVAGE_RATE","BUILDING_TYPE_FACTORY","FACTORY_COST","FACTORY_WIDTH","FACTORY_SCALE","EQUIP_TYPE_BRAKE","EQUIP_TYPE_PRIMARY_WEAPON","EQUIP_TYPE_SECONDARY_WEAPON","EQUIP_TYPE_THRUSTER","EQUIP_TYPE_ARMOR","EQUIP_TYPE_REPAIR_DROID","EQUIP_TYPE_GUNNERY_DROID","EQUIP_TYPE_SHIELD_DROID","EQUIP_TYPE_SPEED","EQUIP_TYPE_TURN","EQUIP_TYPE_STORAGE","EQUIP_TYPE_AUTOLANDER","THRUST_MOMENTUM","THRUST_BLINK","OBJ_EQUIP","OBJ_SHIP","ALIEN_AI_TURRET","ALIEN_AI_CREEPER","ALIEN_AI_MOTHERSHIP","ALIEN_AI_KAMIKAZI","EQUIP_AI_MINE","EQUIP_AI_TURRET","EQUIP_AI_MISSILE","DIR_AHEAD_OF_SHIP","DIR_BEHIND_SHIP","EQUIP_BRAKE","name","objType","type","brakeSpeedPct","cost","description","EQUIP_BLINK_BRAKE","EQUIP_SPEED_BOOST","boostSpeed","EQUIP_TURN_BOOST","EQUIP_STORAGE","storageAmount","EQUIP_ENHANCED_STORAGE","EQUIP_ARMOR","armorAmt","EQUIP_ENHANCED_ARMOR","EQUIP_THRUSTER","thrustSpeed","thrustType","EQUIP_BLINK_THRUSTER","EQUIP_AUTOLANDER","EQUIP_BLASTER","coolTime","cool","damage","speed","lifetime","jitter","bulletFile","EQUIP_FAST_BLASTER","EQUIP_SPRINKLER_BLASTER","EQUIP_STREAM_BLASTER","EQUIP_MELEE_GUN","EQUIP_SNIPER_RIFLE","EQUIP_ALIEN_BLASTER","EQUIP_ALIEN_BLASTER_FAST","EQUIP_ALIEN_BLASTER_LIGHTNING","EQUIP_STAPLE_GUN","EQUIP_STAPLE_GUN_HEAVY","EQUIP_SHIELD","shield","active","armor","armorMax","lifetimeMax","spriteFile","radius","EQUIP_SHIELD_LONG","EQUIP_SHIELD_STRONG","EQUIP_SHIELD_ULTRA","EQUIP_SHIELD_BLINK","SHIP_RED_MISSILE","propulsion","turnSpeed","resourcesMax","resources","equipMax","equip","crashSpeed","crashAngle","imageScale","imageFile","viewRange","aiType","EQUIP_ALIEN_MISSILE_LAUNCHER","createShip","EQUIP_R2D2","repairSpeed","EQUIP_GUNNERY_DROID","weapon","EQUIP_LIGHTING_DROID","EQUIP_SHIELD_DROID","SHIP_EXPLORER","SHIP_CARGO","SHIP_FAST","SHIP_SKELETON","SHIP_HEAVY","SHIP_FIGHTER","SHIP_WING","SHIP_ALIEN_TURRET","SHIP_ALIEN","SHIP_ALIEN_LARGE","SHIP_ALIEN_STAPLE_TURRET","SHIP_ALIEN_FIRE","SHIP_ALIEN_STEALTH","SHIP_ALIEN_MOTHERSHIP","SHIP_DECOY","SHIP_TURRET","SHIP_STREAM_TURRET","SHIP_MISSILE","SHIP_FRIENDSHIP_MISSILE","ALL_ALIENS","ALL_SHIPS","EQUIP_DECOY_DEPLOYER","EQUIP_TURRET_DEPLOYER","EQUIP_STREAM_TURRET_DEPLOYER","EQUIP_MISSILE_LAUNCHER","EQUIP_FRIENDSHIP_GUN","EQUIP_UPGRADES","EQUIP_PRIMARY_WEAPONS","EQUIP_SECONDARY_WEAPONS","EQUIP_DROIDS","ALL_EQUIP","XP_LEVELS","xp","obj","PLANET_DENSITY","Map","set","UNIVERSE_RINGS","planetCount","minDist","maxDist","minDistToOtherPlanet","minPlanetRadius","maxPlanetRadius","planetFiles","aliens","count","file","createEmptyWorld","saveGameName","ship","view","ships","planets","selectedPlanet","lastPlanetLanded","gameTickCount","blueprints","xpLevels","lodash","cloneDeep","nextId","keys","app","gameState","isTyping","gameLoop","bgSprite","explosionSheet","explosions","bullets","nearby","planetSpriteCache","shipSpriteCache","shieldSpriteCache","spriteContainers","background","minimap","screenHeight","miniMapGraphics","initializing","setupWorld","setupSpriteContainers","createBackground","createPlanets","shipStartX","shipStartY","getShipSprite","visible","createAliens","setupMiniMap","setupExplosionSheet","mainStage","stage","PIXI","Container","addChild","container","TilingSprite","Texture","from","ring","i","fileName","utils","length","String","fromCharCode","get","maxResource","minResource","createPlanet","getFreeXy","nearestPlanetDistance","origPlanet","nearestPlanet","dist","nearestPlanetDist","nearestAlienDistance","nearestAlien","alien","nearestAlienDist","minDistToPlanet","minDistToAlien","failCount","np","console","warn","planetFile","stored","raw","buildings","lastLandingDir","spriteId","getPlanetSprite","planetContainer","planetSprite","Sprite","loader","textures","anchor","spriteScale","scale","building","manage","makeBuildingSprite","entries","foundSprite","rotation","spriteWidth","spriteHeight","height","spriteSheet","getSpriteOrigWithHeight","origWidth","origHeight","setShieldRadius","shieldSprite","shipSprite","shieldWidth","getShieldSprite","cacheId","id","shipType","owner","selectedSecondaryWeaponIndex","vx","vy","alive","createAlien","alienInfo","miniMapContainer","mask","Graphics","drawRect","renderable","cacheAsBitmap","g","click","data","global","scaledX","scaledY","fly","clickOnMinimap","changeGameState","newState","enterFlyState","flyLoop","enterManageState","manageLoop","runBuildings","mineResource","children","buildingSprite","animationSpeed","resourceType","nextLevel","addBlueprint","shift","addMiningXp","addAlienXp","canAfford","payResourceCost","payResource","paid","Loader","shared","spritesheet","createExplosionSprite","AnimatedSprite","animations","loop","log","delta","setupNearby","runDroids","left","turnShip","right","d","up","w","booster","getEquip","propelShip","down","s","brake","brakeShip","space","firePrimaryWeapon","fireSecondaryWeapon","q","thrustShip","e","planetsInView","planetInView","grav","game","detectCollisionWithPlanet","landShip","detectCollisionWithAlien","shipsCollide","moveExplosions","moveBackground","drawMiniMap","minX","maxX","minY","maxY","repositionScreen","ai","moveAliens","coolAllWeapons","coolWeapons","disableShield","resetWeaponsCool","droid","shootAtNearestAlien","weaponRange","origDir","fireWeapon","tilePosition","getActiveShield","getAvailableShieldEquip","hasShieldDroid","getEquippedShield","point","planetDir","dirDiff","abs","success","hasAutolander","speedDiff","dirDiffAdj","damageShip","resetGame","r","getExplosionSprite","explosionSprite","playerShip","destroyShip","afterExplosion","play","onLoop","stop","getAvailablePlanetXY","turnBooster","thruster","thrustX","thrustY","fireBullet","gun","getSecondaryWeapon","selectFirstSecondaryWeapon","child","childSprite","childDistFromShip","checkForCollisionWithPlanet","checkForCollisionWithShip","enableShield","bullet","findOrCreateBullet","jitterAmt","killBullet","moveBullets","checkForBulletCollision","bulletWillHitShip","shieldEquip","bulletHitShip","shipDamage","alienDamage","equipType","t","clear","beginFill","lineStyle","endFill","planetOnMap","planetColor","drawCircle","buildingX","buildingY","clickX","clickY","primaryWeaponRange","gravity","takeOff","getBuildingInfo","buildingType","animation","buildMine","mine","getBuildingPlacementRotation","distanceFromShip","deg","degX","degY","buildingWidth","buildingFits","minBuildingWidth","transferResource","source","target","requestedAmtStr","maxCapacity","requestedAmt","Number","isNaN","amt","spaceLeft","unloadShip","resupplyShip","desiredAmt","freeAmt","desiredTitanium","buildFactory","factory","buildShip","shipTemplate","newShip","switchToShip","oldShip","removeShipFromStorage","addShipToStorage","newShipSprite","filter","removedShip","hasFactory","makeEquip","equipTemplate","buildEquip","costToRepair","repairShip","addArmor","titaniumOnHand","addEquip","newEquip","moveEquipFromPlanetToShip","equipToMove","remove","moveEquipFromShipToPlanet","shipResources","owing","this","removeResource","salvageEquip","salvageShip","canEquip","includes","find","eq","hasMoved","creeperAi","turretAi","missileAi","mothershipAi","alienSprite","shootAt","shooter","turretShip","getNearestOpponentTarget","distanceToPlayer","enableShieldIfNeeded","getNearestAlienTarget","getNearestPlayerTarget","getNearestFriendlyTarget","missile","dirToTarget","crashIntoPlayer","moved","playerTarget","distToOpponent","dirToPlanet","rightLeft","turnDir","alienTarget","alienDist","shipId","otherShip","getShield","saveLocalStorage","objToSave","localStorage","getItem","removeItem","setItem","JSON","stringify","loadLocalStorage","objString","parse","upgradeDB","db","result","oldVersion","deleteObjectStore","createObjectStore","keyPath","loadWorld","dbRequest","indexedDB","open","onerror","onupgradeneeded","onsuccess","request","transaction","objectStore","newWorld","oldSystem","removeChildren","saveWorld","worldToStore","omit","objectStoreRequest","put","deleteWorld","delete","HEATBAR","Heatbar","curr","topFree","colorImgSrc","className","style","IMG_WIDTH","IMG_HEIGHT","src","alt","clipPath","PushButton","selected","onChange","imgFile","onClick","BUTTON","StatusButton","rightFree","getStatus","InfoFly","backgroundImage","backgroundSize","paddingRight","textAlign","cellPadding","colSpan","ManagePlanet","useState","titaniumAmt","setTitaniumAmt","goldAmt","setGoldAmt","uraniumAmt","setUraniumAmt","shipOnPlanet","disabled","display","round","marginLeft","defaultValue","FactoryButtonRow","template","existingInventory","templateArg","FactoryTab","templateList","maxHeight","minWidth","FactoryTabs","upgrades","primaryWeapons","secondaryWeapons","droids","Tabs","defaultActiveKey","Tab","eventKey","ManageStorage","selectedShip","setSelectedShip","currentShip","selectedShipEquip","concat","viewShip","ManageSystem","nameInput","useRef","gameNames","savegame","setCurrentGame","newName","current","addGameName","newGameName","onFocus","onBlur","ref","saveGame","gameName","loadGame","confirm","deleteGame","ManageLog","timeSpentMin","timeSpentHr","translations","Object","entry","ManageTabs","mountOnEnter","unmountOnExit","InfoPanel","React","Component","App","props","createPixiApp","Application","renderer","backgroundColor","pixiRef","appendChild","add","load","setupGame","setupKeyboardListeners","setupWindowResizeListener","plugins","interaction","on","ticker","mainLoop","forceUpdate","createRef","resizeScreenToWindow","h","innerHeight","resize","Boolean","location","hostname","match","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.c5e02457.chunk.js","sourcesContent":["import { c } from './';\nimport Swal from \"sweetalert2\";\n\n/**\n * Returns the distance between two points \n */\nexport function distanceBetween(ax, ay, bx, by) {\n  return Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\n}\n  \n/**\n * Returns array with [x,y] of midpoint between two points\n * Both params should be [x,y]\n */\nexport function midPoint(a, b) {\n  return [(a[0]+b[0])/2, (a[1]+b[1])/2];\n}\n\n/**\n * Convert the angle to 0 <= rad <= 2*PI \n */\nexport function normalizeRadian(radians) {\n  let retVal = radians;\n  if (retVal < 0) {\n    retVal += Math.PI * 2;\n  }\n  if (retVal > Math.PI * 2) {\n    retVal -= Math.PI * 2;\n  }\n  return retVal;\n}\n  \n/**\n * Calc gravity for point.\n * @return {x,y,dir} This will be the x and y forces applied to the object (not a point)\n */\nexport function calcGravity(x, y, planet) {\n  let distance = distanceBetween(x, y, planet.x, planet.y);\n  if (distance < 10) {\n    distance = 10;\n  }\n  let gravityDirection = Math.atan2(x - planet.x, y - planet.y);\n  let gravityX = c.GRAVITATIONAL_CONST * planet.mass / Math.pow(distance, 2) * -Math.sin(gravityDirection);\n  let gravityY = c.GRAVITATIONAL_CONST * planet.mass / Math.pow(distance, 2) * -Math.cos(gravityDirection);\n  return {x:gravityX, y:gravityY, dir:gravityDirection};\n}\n\n/**\n * @return the angle x1,y1 would need to face to point directly at x2,y2\n */\nexport function directionTo(x1,y1, x2,y2) {\n  return normalizeRadian(Math.atan2(y2 - y1, x2 - x1));\n}\n\n/**\n * @return {xAmt, yAmt} splitting the dir and amount into x,y portions\n */\nexport function dirComponents(dir, amount) {\n  let xAmt = amount * Math.cos(dir);\n  let yAmt = amount * Math.sin(dir);\n  return {xAmt, yAmt};\n}\n\n/**\n * @return an int between min and max inclusive\n */\nexport function randomInt(minP, maxP) {\n  let min = Math.ceil(minP);\n  let max = Math.floor(maxP);\n  return Math.floor(Math.random() * (max - min +1) + min); \n}\n\n/**\n * @return a random floating point number between min and max\n */\nexport function randomFloat(min, max) {\n  return min + (Math.random() * (max - min));\n}\n\n/**\n * @return true 50% of the time\n */\nexport function randomBool() {\n  return Math.random() > 0.5;\n}\n\n/**\n * @return add distance in direction to startX,startY \n */\nexport function getPointFrom(startX, startY, dir, distance) {\n  let x = startX + (distance * Math.cos(dir));\n  let y = startY + (distance * Math.sin(dir));\n  return {x,y};\n}\n\n/**\n * return a collection of points [[x,y],[x,y]] on a rectangular sprite that can be used for collision detection\n * param x,y global x,y position of sprite (on main map, not in viewport)\n * NOTE: This will scale based on the scaleFactor set by the window size\n */\nexport function getVertexData(x,y, sprite) {\n  sprite.calculateVertices();\n  const vertices = sprite.vertexData.map(p => p / window.world.system.screenScale);\n  let collisionPoints = []; // [[x,y],[x,y]]\n  collisionPoints.push(toGlobal(x, y, vertices[0], vertices[1])); // top left\n  collisionPoints.push(toGlobal(x, y, vertices[2], vertices[3])); // top right\n  collisionPoints.push(toGlobal(x, y, vertices[4], vertices[5])); // bottom right\n  collisionPoints.push(toGlobal(x, y, vertices[6], vertices[7])); // bottom left\n  // Add a few points between to help with border collisions (these have already been converted to global)\n  collisionPoints.push(midPoint(collisionPoints[0], collisionPoints[1]));\n  collisionPoints.push(midPoint(collisionPoints[1], collisionPoints[2]));\n  collisionPoints.push(midPoint(collisionPoints[2], collisionPoints[3]));\n  collisionPoints.push(midPoint(collisionPoints[3], collisionPoints[0]));\n  return collisionPoints;\n}\n\n/**\n * Converts the local sprite-based x,y to global based on ship's position\n * @return [x,y] in global map coordinates\n */\nexport function toGlobal(globalX,globalY, spriteX,spriteY) {\n  return [globalX + (spriteX - c.HALF_SCREEN_WIDTH), globalY+ (spriteY - c.HALF_SCREEN_HEIGHT)];\n}\n\n\n/**\n * return true if the pX,pY (global positions) is inside the sprite at x,y\n * param x,y global x,y position of sprite (on main map, not in viewport)\n */\nexport function pointInSprite(x,y, sprite, pX, pY) {\n  sprite.calculateVertices();\n  // scale the vertices for the screen scaling\n  const vertices = sprite.vertexData.map(p => p / window.world.system.screenScale);\n  const topLeft = (toGlobal(x, y, vertices[0], vertices[1])); // top left\n  const topRight = (toGlobal(x, y, vertices[2], vertices[3])); // top right\n  const bottomLeft = (toGlobal(x, y, vertices[6], vertices[7])); // bottom right\n  // Complicated math stuff\n  const AB = toVector(topLeft, topRight);\n  const AD = toVector(topLeft, bottomLeft);\n  const AM = toVector(topLeft, [pX, pY]);\n  const dotAMAB = dot(AM, AB);\n  const dotABAB = dot(AB, AB);\n  const dotAMAD = dot(AM, AD);\n  const dotADAD = dot(AD, AD);\n  return 0 <= dotAMAB && dotAMAB <= dotABAB && 0 <= dotAMAD && dotAMAD <= dotADAD;\n}\n\n// p1 and p2 are [x,y]\nfunction toVector(p1, p2) {\n  return [(p2[0] - p1[0]), (p2[1] - p1[1])];\n}\n\n// u and v are [x,y]\nfunction dot(u, v) {\n  return (u[0] * v[0]) + (u[1] * v[1]);\n}\n\n/**\n * Sets up a keyboard listener\n */\nexport function keyboardListener(value) {\n  let key = {};\n  key.value = value;\n  key.isDown = false;\n  key.isUp = true;\n  key.press = undefined;\n  key.release = undefined;\n  //The `downHandler`\n  key.downHandler = event => {\n    if (event.key === key.value) {\n      if (key.isUp && key.press) key.press();\n      key.isDown = true;\n      key.isUp = false;\n    }\n  };\n  //The `upHandler`\n  key.upHandler = event => {\n    if (event.key === key.value) {\n      if (key.isDown && key.release) key.release();\n      key.isDown = false;\n      key.isUp = true;\n    }\n  };\n  //Attach event listeners\n  const downListener = key.downHandler.bind(key);\n  const upListener = key.upHandler.bind(key);\n  window.addEventListener(\n    \"keydown\", downListener, false\n  );\n  window.addEventListener(\n    \"keyup\", upListener, false\n  );\n  // Detach event listeners\n  key.unsubscribe = () => {\n    window.removeEventListener(\"keydown\", downListener);\n    window.removeEventListener(\"keyup\", upListener);\n  };\n  return key;\n}\n\nexport function showToast(text) {\n  Swal.fire({\n    title: text,\n    timer: 5000,\n    position:'top-left',\n    showConfirmButton: false,\n    toast:true,\n    width: Math.floor(c.SCREEN_WIDTH/2)+'px',\n    showClass: {\n      popup: 'animate__animated animate__slideInDown'\n    },\n    hideClass: {\n      popup: 'animate__animated animate__slideOutUp'\n    }\n  }).then();\n}","// Colors\nexport const BLACK = 0X000000;\nexport const YELLOW = 0xCC55CC;\nexport const BLUE = 0x00AAFF;\nexport const WHITE = 0xFFFFFF;\nexport const DARK_GREY = 0x303030;\nexport const LIGHT_GREY = 0x909090;\n\nexport const GAME_STATE = {\n  INIT: \"init\",\n  FLY: \"fly\",\n  MANAGE: \"manage\"\n};\n\n// Saved games\nexport const LOCALSTORAGE_GAME_NAMES_KEY = 'saved-game-names';\n\n// Screen Layout\nexport const SCREEN_WIDTH = 1000;\nexport const SCREEN_HEIGHT = 1000;\nexport const HALF_SCREEN_WIDTH = SCREEN_WIDTH / 2;\nexport const HALF_SCREEN_HEIGHT = SCREEN_HEIGHT / 2;\nexport const NEARBY_WIDTH = SCREEN_WIDTH * 3;\nexport const NEARBY_HEIGHT = SCREEN_HEIGHT * 3;\n// size of minimap on screen\nexport const MINIMAP_WIDTH = 250;\nexport const MINIMAP_HEIGHT = 250;\nexport const HALF_MINIMAP_WIDTH = MINIMAP_WIDTH / 2;\nexport const HALF_MINIMAP_HEIGHT = MINIMAP_HEIGHT / 2;\n// how far the minimap can view\nexport const MINIMAP_VIEW_WIDTH = 8000;\nexport const MINIMAP_VIEW_HEIGHT = 8000;\nexport const HALF_MINIMAP_VIEW_WIDTH = MINIMAP_VIEW_WIDTH / 2;\nexport const HALF_MINIMAP_VIEW_HEIGHT = MINIMAP_VIEW_HEIGHT / 2;\n// convert minimap pixels to real pixels\nexport const MINIMAP_SCALE_X = MINIMAP_WIDTH / MINIMAP_VIEW_WIDTH;\nexport const MINIMAP_SCALE_Y = MINIMAP_HEIGHT / MINIMAP_VIEW_HEIGHT;\n// MiniMap colors\nexport const MINIMAP_BORDER_COLOR = LIGHT_GREY;\nexport const MINIMAP_BACKGROUND_COLOR = DARK_GREY;\nexport const MINIMAP_PLANET_COLOR = LIGHT_GREY;\nexport const MINIMAP_SELECTED_PLANET_COLOR = YELLOW;\nexport const MINIMAP_BUILDING_COLOR = BLUE;\nexport const MINIMAP_SHIP_COLOR = WHITE;\n\n// Files\nexport const SPRITESHEET_JSON = \"images/spritesheet.json\";\nexport const ALIEN_SHIP_BLACK_FILE = \"alien_black.png\";\nexport const ALIEN_SHIP_BLUE_FILE = \"alien_blue.png\";\nexport const ALIEN_SHIP_BLUE_LARGE_FILE = \"alien_blue_large.png\";\nexport const ALIEN_SHIP_BLUE_SMALL_FILE = \"alien_blue_small.png\";\nexport const ALIEN_SHIP_FIRE_FILE = \"alien_fire.png\";\nexport const ALIEN_SHIP_GREEN_FILE = \"alien_green.png\";\nexport const ALIEN_SHIP_GREEN_SMALL_FILE = \"alien_green_small.png\";\nexport const ALIEN_SHIP_GREEN_LARGE_FILE = \"alien_green_large.png\";\nexport const ALIEN_SHIP_RED_FILE = \"alien_red.png\";\nexport const ALIEN_SHIP_RED_SMALL_FILE = \"alien_red_small.png\";\nexport const ALIEN_SHIP_RED_LARGE_FILE = \"alien_red_large.png\";\nexport const BULLET_FILE = \"bullet.png\";\nexport const BULLET_BLUE_FILE = \"bullet_blue.png\";\nexport const BULLET_WHITE_FILE = \"bullet_white.png\";\nexport const FACTORY_FILE = \"factory.png\";\nexport const MINE_FILE = \"mine\"; // animation name in json\nexport const PLANET_GREEN_FILE = \"planet_green.png\";\nexport const PLANET_PURPLE_FILE = \"planet_purple.png\";\nexport const PLANET_RED_FILE = \"planet_red.png\";\nexport const PLANET_ROCK_FILE = \"planet_rock.png\";\nexport const SHIELD_BLUE_FILE = \"shield_blue.png\";\nexport const SHIELD_GREEN_FILE = \"shield_green.png\";\nexport const SHIELD_WHITE_FILE = \"shield_white.png\";\nexport const SHIP_BALL_FILE = \"ship_ball.png\";\nexport const SHIP_CARGO_FILE = \"ship_cargo.png\";\nexport const SHIP_EXPLORER_FILE = \"ship_explorer.png\";\nexport const SHIP_FAST_FILE = \"ship_fast.png\";\nexport const SHIP_FIGHTER_FILE = \"ship_fighter.png\";\nexport const SHIP_HEAVY_FILE = \"ship_heavy.png\";\nexport const SHIP_MISSILE_FILE = \"ship_missile.png\";\nexport const SHIP_RED_WINGS_FILE = \"ship_red_wings.png\";\nexport const SHIP_SKELETON_FILE = \"ship_skeleton.png\";\nexport const STAR_BACKGROUND_FILE = \"images/stars.png\";\nexport const CRASH_JSON = \"images/crash.json\";\nexport const CRASH = \"crash\"; // animation name in json\n\nexport const UNIVERSE_RADIUS = 35000;\nexport const PLAYER = \"player\";\nexport const ALIEN = \"alien\";\nexport const PLAYER_STARTING_RESOURCES = {titanium: 30, gold: 20, uranium: 0};\nexport const GRAVITATIONAL_CONST = 2;\nexport const ALLOWED_OVERLAP = 2; // overlap for fudging collision detection\nexport const TAKEOFF_SPEED = 10; // in units of planet gravity\nexport const PLANET_RESOURCE_MAX = 99999999;\nexport const PLAYER_START_X = -(UNIVERSE_RADIUS + 1000); // left of the universe\nexport const PLAYER_START_Y = 0;\nexport const MIN_ALIEN_DIST_TO_PLANET = 50;\nexport const MIN_ALIEN_DIST_TO_ALIEN = 3;\n\n// Buildings\nexport const BUILDING_PLACEMENT_ROTATION_INCREMENT = 0.05;\n// Mine\nexport const BUILDING_TYPE_MINE = \"mine\";\nexport const MINE_SCALE = 1;\nexport const MINE_WIDTH = 52;\nexport const MINE_ANIMATION_SPEED = 0.5;\nexport const MINE_SPEED_TITANIUM = 0.0166; // 1 every sec\nexport const MINE_SPEED_GOLD = 0.0083;  // 1 every 2 sec\nexport const MINE_SPEED_URANIUM = 0.0033; // 1 every 5 sec\nexport const MINE_COST = {titanium: 20, gold: 10, uranium: 0};\nexport const SALVAGE_RATE = 0.5; // amount returned when salvaging equipment or ships\n// Factory\nexport const BUILDING_TYPE_FACTORY = \"factory\";\nexport const FACTORY_COST = {titanium: 50, gold: 20, uranium: 10};\nexport const FACTORY_WIDTH = 91;\nexport const FACTORY_SCALE = 0.8;\n\n// Equipment\nexport const EQUIP_TYPE_BRAKE = \"Brake\";\nexport const EQUIP_TYPE_PRIMARY_WEAPON = \"Primary Weapon\";\nexport const EQUIP_TYPE_SECONDARY_WEAPON = \"Secondary Weapon\";\nexport const EQUIP_TYPE_THRUSTER = \"Thruster\";\nexport const EQUIP_TYPE_ARMOR = \"Armor\";\nexport const EQUIP_TYPE_REPAIR_DROID = \"Repair Droid\";\nexport const EQUIP_TYPE_GUNNERY_DROID = \"Gunnery Droid\";\nexport const EQUIP_TYPE_SHIELD_DROID = \"Shield Droid\";\nexport const EQUIP_TYPE_SPEED = \"Speed\";\nexport const EQUIP_TYPE_TURN = \"Turn\";\nexport const EQUIP_TYPE_STORAGE = \"Storage\";\nexport const EQUIP_TYPE_AUTOLANDER = \"Autolander\";\n\nexport const THRUST_MOMENTUM = \"Thrust Momentum\";\nexport const THRUST_BLINK = \"Thrust Blink\";\n\nexport const OBJ_EQUIP = \"Equip\";\nexport const OBJ_SHIP = \"Ship\";\n\nexport const ALIEN_AI_TURRET = \"ALIEN_AI_TURRET\";\nexport const ALIEN_AI_CREEPER = \"ALIEN_AI_CREEPER\";\nexport const ALIEN_AI_MOTHERSHIP = \"ALIEN_AI_MOTHERSHIP\";\nexport const ALIEN_AI_KAMIKAZI = \"ALIEN_AI_KAMIKAZI\";\nexport const EQUIP_AI_MINE = \"EQUIP_AI_MINE\";\nexport const EQUIP_AI_TURRET = \"EQUIP_AI_TURRET\";\nexport const EQUIP_AI_MISSILE = \"EQUIP_AI_MISSILE\";\n\nexport const DIR_AHEAD_OF_SHIP = \"ahead\";\nexport const DIR_BEHIND_SHIP = \"behind\";\n\n// Ship Upgrades\n// brakeSpeedPct is best between 0.02 - 0.1 (higher is ok)\nexport const EQUIP_BRAKE = {\n  name: \"Brake\", objType: OBJ_EQUIP, type: EQUIP_TYPE_BRAKE, brakeSpeedPct: 0.04,\n  cost: {titanium: 20, gold: 10, uranium: 0},\n  description: \"Slows your ship down.\",\n};\nexport const EQUIP_BLINK_BRAKE = {\n  name: \"Blink Brake\", objType: OBJ_EQUIP, type: EQUIP_TYPE_BRAKE, brakeSpeedPct: 0,\n  cost: {titanium: 50, gold: 50, uranium: 30},\n  description: \"Stops your ship immediately.\",\n};\nexport const EQUIP_SPEED_BOOST = {\n  name: \"Speed Booster\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SPEED, boostSpeed: 0.075,\n  cost: {titanium: 0, gold: 20, uranium: 10},\n  description: \"Increase the ship's acceleration. Helps slow ships take off of large planets.\",\n};\nexport const EQUIP_TURN_BOOST = {\n  name: \"Turn Booster\", objType: OBJ_EQUIP, type: EQUIP_TYPE_TURN, boostSpeed: 0.05,\n  cost: {titanium: 0, gold: 10, uranium: 20},\n  description: \"Increase turning speed.\",\n};\nexport const EQUIP_STORAGE = {\n  name: \"Storage\", objType: OBJ_EQUIP, type: EQUIP_TYPE_STORAGE, storageAmount: 100,\n  cost: {titanium: 30, gold: 0, uranium: 0},\n  description: \"100 more resource storage.\",\n};\nexport const EQUIP_ENHANCED_STORAGE = {\n  name: \"Enhanced Storage\", objType: OBJ_EQUIP, type: EQUIP_TYPE_STORAGE, storageAmount: 300,\n  cost: {titanium: 200, gold: 0, uranium: 0},\n  description: \"300 more resources.\",\n};\nexport const EQUIP_ARMOR = {\n  name: \"Armor Plate\", objType: OBJ_EQUIP, type: EQUIP_TYPE_ARMOR, armorAmt: 100,\n  cost: {titanium: 50, gold: 0, uranium: 0},\n  description: \"Increase armor by 100.\",\n};\nexport const EQUIP_ENHANCED_ARMOR = {\n  name: \"Enhanced Armor\", objType: OBJ_EQUIP, type: EQUIP_TYPE_ARMOR, armorAmt: 300,\n  cost: {titanium: 300, gold: 0, uranium: 0},\n  description: \"Increase armor by 300.\",\n};\nexport const EQUIP_THRUSTER = {\n  name: \"Thruster\", objType: OBJ_EQUIP, type: EQUIP_TYPE_THRUSTER, thrustSpeed: 0.08, thrustType: THRUST_MOMENTUM,\n  cost: {titanium: 40, gold: 40, uranium: 10},\n  description: \"Enable lateral movement. Use 'q' and 'e' keys.\",\n};\n// blink thrustSpeed is good from 2 to 10\nexport const EQUIP_BLINK_THRUSTER = {\n  name: \"Blink Thruster\", objType: OBJ_EQUIP, type: EQUIP_TYPE_THRUSTER, thrustSpeed: 2.5, thrustType: THRUST_BLINK,\n  cost: {titanium: 60, gold: 50, uranium: 10},\n  description: \"Lateral movement without momentum. Use 'q' and 'e' keys.\",\n};\nexport const EQUIP_AUTOLANDER = {\n  name: \"Auto Lander\", objType: OBJ_EQUIP, type: EQUIP_TYPE_AUTOLANDER,\n  cost: {titanium: 60, gold: 50, uranium: 10},\n  description: \"Never crash into a planet again!\",\n};\n\n\n// Primary Weapons\nexport const EQUIP_BLASTER = {\n  name: \"Blaster\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 25,\n  cool: 0,\n  damage: 10,\n  speed: 2.5,\n  lifetime: 100,\n  jitter: 0.05,\n  bulletFile: BULLET_FILE,\n  cost: {titanium: 0, gold: 0, uranium: 10}\n};\nexport const EQUIP_FAST_BLASTER = {\n  name: \"Fast Blaster\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 10,\n  cool: 0,\n  damage: 10,\n  speed: 4,\n  lifetime: 80,\n  jitter: 0.05,\n  bulletFile: BULLET_FILE,\n  cost: {titanium: 20, gold: 20, uranium: 40}\n};\nexport const EQUIP_SPRINKLER_BLASTER = {\n  name: \"Sprinkler Blaster\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 2,\n  cool: 0,\n  damage: 8,\n  speed: 2.5,\n  lifetime: 150,\n  jitter: 1,\n  bulletFile: BULLET_FILE,\n  cost: {titanium: 10, gold: 10, uranium: 80}\n};\nexport const EQUIP_STREAM_BLASTER = {\n  name: \"Stream Blaster\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 4,\n  cool: 0,\n  damage: 8,\n  speed: 7,\n  lifetime: 70,\n  jitter: 0.04,\n  bulletFile: BULLET_FILE,\n  cost: {titanium: 0, gold: 50, uranium: 150}\n};\nexport const EQUIP_MELEE_GUN = {\n  name: \"Melee Gun\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 3,\n  cool: 0,\n  damage: 12,\n  speed: 3,\n  lifetime: 40,\n  jitter: 0.25,\n  bulletFile: BULLET_FILE,\n  cost: {titanium: 0, gold: 150, uranium: 200}\n};\nexport const EQUIP_SNIPER_RIFLE = {\n  name: \"Sniper Rifle\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 100,\n  cool: 0,\n  damage: 160,\n  speed: 9,\n  lifetime: 90,\n  jitter: 0.0,\n  bulletFile: BULLET_FILE,\n  cost: {titanium: 0, gold: 200, uranium: 300}\n};\nexport const EQUIP_ALIEN_BLASTER = {\n  name: \"Alien Blaster\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 20,\n  cool: 0,\n  damage: 5,\n  speed: 2,\n  lifetime: 120,\n  jitter: 0.12,\n  bulletFile: BULLET_BLUE_FILE,\n  cost: {titanium: 0, gold: 0, uranium: 5}\n};\nexport const EQUIP_ALIEN_BLASTER_FAST = {\n  name: \"Alien Fast Blaster\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 10,\n  cool: 0,\n  damage: 12,\n  speed: 5,\n  lifetime: 110,\n  jitter: 0.1,\n  bulletFile: BULLET_BLUE_FILE,\n  cost: {titanium: 0, gold: 50, uranium: 80}\n};\nexport const EQUIP_ALIEN_BLASTER_LIGHTNING = {\n  name: \"Alien Lighting Blaster\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 10,\n  cool: 0,\n  damage: 25,\n  speed: 12,\n  lifetime: 50,\n  jitter: 0.08,\n  bulletFile: BULLET_BLUE_FILE,\n  cost: {titanium: 0, gold: 300, uranium: 500}\n};\nexport const EQUIP_STAPLE_GUN = {\n  name: \"Staple Gun\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 3,\n  cool: 0,\n  damage: 5,\n  speed: 3,\n  lifetime: 250,\n  jitter: 0.2,\n  bulletFile: BULLET_WHITE_FILE,\n  cost: {titanium: 0, gold: 50, uranium: 200}\n};\nexport const EQUIP_STAPLE_GUN_HEAVY = {\n  name: \"Heavy Staple Gun\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 3,\n  cool: 0,\n  damage: 6,\n  speed: 3,\n  lifetime: 250,\n  jitter: 0.15,\n  bulletFile: BULLET_WHITE_FILE,\n  cost: {titanium: 0, gold: 250, uranium: 400}\n};\n\n// Secondary (more at end of file after the ships)\nexport const EQUIP_SHIELD = {\n  name: \"Force Shield\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, cool: 0, coolTime: 600,\n  shield: {\n    active: false,\n    armor: 500,\n    armorMax: 500,\n    lifetime: 300,\n    lifetimeMax: 300,\n    spriteFile: SHIELD_BLUE_FILE,\n    radius: 0\n  },\n  cost: {titanium: 0, gold: 100, uranium: 10}\n};\nexport const EQUIP_SHIELD_LONG = {\n  name: \"Long Shield\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, cool: 0, coolTime: 1200,\n  shield: {\n    active: false,\n    armor: 500,\n    armorMax: 500,\n    lifetime: 1000,\n    lifetimeMax: 1000,\n    spriteFile: SHIELD_WHITE_FILE,\n    radius: 0\n  },\n  cost: {titanium: 0, gold: 200, uranium: 10}\n};\nexport const EQUIP_SHIELD_STRONG = {\n  name: \"Strong Shield\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, cool: 0, coolTime: 850,\n  shield: {\n    active: false,\n    armor: 1500,\n    armorMax: 1500,\n    lifetime: 400,\n    lifetimeMax: 400,\n    spriteFile: SHIELD_GREEN_FILE,\n    radius: 0\n  },\n  cost: {titanium: 0, gold: 200, uranium: 10}\n};\nexport const EQUIP_SHIELD_ULTRA = {\n  name: \"Ultra Shield\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, cool: 0, coolTime: 1000,\n  shield: {\n    active: false,\n    armor: 1300,\n    armorMax: 1300,\n    lifetime: 800,\n    lifetimeMax: 800,\n    spriteFile: SHIELD_BLUE_FILE,\n    radius: 0\n  },\n  cost: {titanium: 0, gold: 300, uranium: 100}\n};\nexport const EQUIP_SHIELD_BLINK = {\n  name: \"Blink Shield\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, cool: 0, coolTime: 501,\n  shield: {\n    active: false,\n    armor: 1000,\n    armorMax: 1000,\n    lifetime: 500,\n    lifetimeMax: 500,\n    spriteFile: SHIELD_BLUE_FILE,\n    radius: 0\n  },\n  cost: {titanium: 0, gold: 500, uranium: 100}\n};\n\nexport const SHIP_RED_MISSILE = {\n  name: \"Alien Missile\",\n  objType: OBJ_SHIP,\n  propulsion: 0.08,\n  turnSpeed: 0.3,\n  resourcesMax: 0,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 0,\n  equip: [],\n  armorMax: 150,\n  armor: 150,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 0.8,\n  imageFile: ALIEN_SHIP_RED_SMALL_FILE,\n  cost: {titanium: 5, gold: 5, uranium: 10},\n  viewRange: SCREEN_WIDTH * 3,\n  aiType: ALIEN_AI_KAMIKAZI,\n};\n\nexport const EQUIP_ALIEN_MISSILE_LAUNCHER = {\n  name: \"Alien Missile Launcher\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, coolTime: 100, cool: 100,\n  createShip: {type: SHIP_RED_MISSILE, dir: DIR_AHEAD_OF_SHIP},\n  cost: {titanium: 150, gold: 150, uranium: 200},\n  description: \"Fires red alien missiles that persistently follow enemies.\",\n};\n\n// Droids\nexport const EQUIP_R2D2 = {\n  name: \"R2D2 Repair Droid\", objType: OBJ_EQUIP, type: EQUIP_TYPE_REPAIR_DROID, repairSpeed: 0.2,\n  cost: {titanium: 50, gold: 300, uranium: 100},\n  description: \"Repairs your ship while you are flying.\"\n};\nexport const EQUIP_GUNNERY_DROID = {\n  name: \"Gunnery Droid\", objType: OBJ_EQUIP, type: EQUIP_TYPE_GUNNERY_DROID,\n  weapon: EQUIP_FAST_BLASTER, cost: {titanium: 100, gold: 400, uranium: 200},\n  description: \"Fires a fast blaster at the nearest enemy.\",\n};\nexport const EQUIP_LIGHTING_DROID = {\n  name: \"Lightning Droid\", objType: OBJ_EQUIP, type: EQUIP_TYPE_GUNNERY_DROID,\n  weapon: EQUIP_ALIEN_BLASTER_LIGHTNING, cost: {titanium: 100, gold: 500, uranium: 300},\n  description: \"Fires a lightning blaster at the nearest enemy.\",\n};\nexport const EQUIP_SHIELD_DROID = {\n  name: \"Shield Droid\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SHIELD_DROID,\n  cost: {titanium: 50, gold: 600, uranium: 50},\n  description: \"Deploys your shields automatically when bullets are flying.\",\n};\n\n// Ships\nexport const SHIP_EXPLORER = {\n  name: \"Explorer\",\n  objType: OBJ_SHIP,\n  propulsion: 0.05, // best between 0.02 - 0.1\n  turnSpeed: 0.05, // // best between 0.3 - 0.07\n  resourcesMax: 50,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 4,\n  equip: [EQUIP_BRAKE, EQUIP_BLASTER],\n  armorMax: 50,\n  armor: 50,\n  crashSpeed: 2,\n  crashAngle: 0.5,\n  imageScale: 0.6,\n  imageFile: SHIP_EXPLORER_FILE,\n  cost: {titanium: 40, gold: 20, uranium: 10},\n  description: \"A basic ship with good handling and 4 slots.\",\n};\n\nexport const SHIP_CARGO = {\n  name: \"Cargo\",\n  objType: OBJ_SHIP,\n  propulsion: 0.025, // best between 0.02 - 0.1\n  turnSpeed: 0.02, // // best between 0.3 - 0.07\n  resourcesMax: 750,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 3,\n  equip: [EQUIP_BRAKE],\n  armorMax: 20,\n  armor: 20,\n  crashSpeed: 1.2,\n  crashAngle: 0.3,\n  imageScale: 1,\n  imageFile: SHIP_CARGO_FILE,\n  cost: {titanium: 100, gold: 50, uranium: 50},\n  description: \"A large, slow ship that can carry 750 resources, but only has 3 slots.\",\n};\n\nexport const SHIP_FAST = {\n  name: \"Fast\",\n  objType: OBJ_SHIP,\n  propulsion: 0.1, // best between 0.02 - 0.1\n  turnSpeed: 0.07, // // best between 0.3 - 0.07\n  resourcesMax: 40,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 6,\n  equip: [EQUIP_BRAKE],\n  armorMax: 50,\n  armor: 50,\n  crashSpeed: 2,\n  crashAngle: 0.5,\n  imageScale: 0.6,\n  imageFile: SHIP_FAST_FILE,\n  cost: {titanium: 200, gold: 100, uranium: 50},\n  description: \"A fast ship with good handling and 6 slots.\",\n};\n\nexport const SHIP_SKELETON = {\n  name: \"Skeleton\",\n  objType: OBJ_SHIP,\n  propulsion: 0.03, // best between 0.02 - 0.1\n  turnSpeed: 0.03, // // best between 0.3 - 0.07\n  resourcesMax: 30,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 8,\n  equip: [],\n  armorMax: 50,\n  armor: 50,\n  crashSpeed: 2,\n  crashAngle: 0.5,\n  imageScale: 0.7,\n  imageFile: SHIP_SKELETON_FILE,\n  cost: {titanium: 200, gold: 200, uranium: 50},\n  description: \"A framework with 8 slots that makes it flexible.\",\n};\n\nexport const SHIP_HEAVY = {\n  name: \"Heavy\",\n  objType: OBJ_SHIP,\n  propulsion: 0.055, // best between 0.02 - 0.1\n  turnSpeed: 0.05, // // best between 0.3 - 0.07\n  resourcesMax: 300,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 8,\n  equip: [EQUIP_BRAKE],\n  armorMax: 500,\n  armor: 500,\n  crashSpeed: 1.5,\n  crashAngle: 0.4,\n  imageScale: 0.5,\n  imageFile: SHIP_HEAVY_FILE,\n  cost: {titanium: 500, gold: 400, uranium: 300},\n  description: \"A large ship with 500 armor and 300 resources and 8 slots.\",\n};\n\nexport const SHIP_FIGHTER = {\n  name: \"Fighter\",\n  objType: OBJ_SHIP,\n  propulsion: 0.08, // best between 0.02 - 0.1\n  turnSpeed: 0.07, // // best between 0.3 - 0.07\n  resourcesMax: 200,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 10,\n  equip: [EQUIP_BRAKE],\n  armorMax: 300,\n  armor: 300,\n  crashSpeed: 1.5,\n  crashAngle: 0.6,\n  imageScale: 0.6,\n  imageFile: SHIP_FIGHTER_FILE,\n  cost: {titanium: 500, gold: 500, uranium: 500},\n  description: \"A fast, heavily armored ship with 10 slots.\",\n};\n\nexport const SHIP_WING = {\n  name: \"Wing Ship\",\n  objType: OBJ_SHIP,\n  propulsion: 0.075, // best between 0.02 - 0.1\n  turnSpeed: 0.06, // // best between 0.3 - 0.07\n  resourcesMax: 300,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 12,\n  equip: [EQUIP_BLINK_BRAKE],\n  armorMax: 500,\n  armor: 500,\n  crashSpeed: 3,\n  crashAngle: 0.5,\n  imageScale: 0.7,\n  imageFile: SHIP_RED_WINGS_FILE,\n  cost: {titanium: 1000, gold: 1000, uranium: 1000},\n  description: \"A large ship with good handling 500 armor, 300 resources and 12 slots.\",\n};\n\nexport const SHIP_ALIEN_TURRET = {\n  name: \"Alien Turret\",\n  objType: OBJ_SHIP,\n  propulsion: 0.001, // best between 0.02 - 0.1\n  turnSpeed: 0.05, // // best between 0.3 - 0.07\n  resourcesMax: 100,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 3,\n  equip: [EQUIP_BRAKE, EQUIP_ALIEN_BLASTER],\n  armorMax: 100,\n  armor: 100,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 0.8,\n  imageFile: ALIEN_SHIP_GREEN_SMALL_FILE,\n  cost: {titanium: 50, gold: 50, uranium: 50},\n  aiType: ALIEN_AI_TURRET,\n  description: \"A basic turret with an alien blaster\",\n};\n\nexport const SHIP_ALIEN = {\n  name: \"Alien Ship\",\n  objType: OBJ_SHIP,\n  propulsion: 0.05, // best between 0.02 - 0.1\n  turnSpeed: 0.05, // // best between 0.3 - 0.07\n  resourcesMax: 100,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 5,\n  equip: [EQUIP_BRAKE, EQUIP_ALIEN_BLASTER],\n  armorMax: 100,\n  armor: 100,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 0.9,\n  imageFile: ALIEN_SHIP_GREEN_FILE,\n  cost: {titanium: 150, gold: 100, uranium: 80},\n  aiType: ALIEN_AI_CREEPER,\n  description: \"The basic alien scout ship.\",\n};\n\nexport const SHIP_ALIEN_LARGE = {\n  name: \"Alien Large\",\n  objType: OBJ_SHIP,\n  propulsion: 0.03, // best between 0.02 - 0.1\n  turnSpeed: 0.05, // // best between 0.3 - 0.07\n  resourcesMax: 100,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 8,\n  equip: [EQUIP_BRAKE, EQUIP_ALIEN_BLASTER_FAST],\n  armorMax: 300,\n  armor: 300,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 1,\n  imageFile: ALIEN_SHIP_GREEN_LARGE_FILE,\n  cost: {titanium: 150, gold: 100, uranium: 80},\n  aiType: ALIEN_AI_CREEPER,\n  description: \"A large heavily armored alien.\",\n};\n\nexport const SHIP_ALIEN_STAPLE_TURRET = {\n  name: \"Alien Staple Turret\",\n  objType: OBJ_SHIP,\n  propulsion: 0.00,\n  turnSpeed: 0.001,\n  resourcesMax: 100,\n  resources: {\n     titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 3,\n  equip: [EQUIP_BRAKE, EQUIP_STAPLE_GUN_HEAVY],\n  armorMax: 200,\n  armor: 200,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 1.3,\n  imageFile: ALIEN_SHIP_BLUE_SMALL_FILE,\n  cost: {titanium: 150, gold: 150, uranium: 200},\n  aiType: ALIEN_AI_TURRET,\n  description: \"A hard-to-hit turret with a heavy staple gun.\",\n};\n\nexport const SHIP_ALIEN_FIRE = {\n  name: \"Alien Fire\",\n  objType: OBJ_SHIP,\n  propulsion: 0.08, // best between 0.02 - 0.1\n  turnSpeed: 0.05, // // best between 0.3 - 0.07\n  resourcesMax: 100,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 8,\n  equip: [EQUIP_BRAKE, EQUIP_STAPLE_GUN_HEAVY, EQUIP_SHIELD_LONG],\n  armorMax: 350,\n  armor: 350,\n  crashSpeed: 2,\n  crashAngle: 0.4,\n  imageScale: 1.5,\n  imageFile: ALIEN_SHIP_FIRE_FILE,\n  cost: {titanium: 250, gold: 200, uranium: 80},\n  aiType: ALIEN_AI_CREEPER,\n  description: \"A tough alien ship with a shield and heavy staple gun.\",\n};\n\nexport const SHIP_ALIEN_STEALTH = {\n  name: \"Alien Stealth\",\n  objType: OBJ_SHIP,\n  propulsion: 0.04, // best between 0.02 - 0.1\n  turnSpeed: 0.05, // // best between 0.3 - 0.07\n  resourcesMax: 100,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 6,\n  equip: [EQUIP_BRAKE, EQUIP_ALIEN_BLASTER_FAST],\n  armorMax: 150,\n  armor: 150,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 1.5,\n  imageFile: ALIEN_SHIP_BLACK_FILE,\n  cost: {titanium: 100, gold: 200, uranium: 150},\n  aiType: ALIEN_AI_CREEPER,\n  description: \"An alien with a cloak making it hard to see.\",\n};\n\nexport const SHIP_ALIEN_MOTHERSHIP = {\n  name: \"Alien Mothership\",\n  objType: OBJ_SHIP,\n  propulsion: 0.00,\n  turnSpeed: 0.001,\n  resourcesMax: 10000,\n  resources: {\n    titanium: 1000,\n    gold: 1000,\n    uranium: 2000,\n  },\n  equipMax: 10,\n  equip: [EQUIP_BRAKE, EQUIP_ALIEN_MISSILE_LAUNCHER, EQUIP_SHIELD_ULTRA, EQUIP_ALIEN_BLASTER_LIGHTNING],\n  armorMax: 1000,\n  armor: 1000,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 1.3,\n  imageFile: ALIEN_SHIP_RED_LARGE_FILE,\n  cost: {titanium: 1200, gold: 1000, uranium: 750},\n  aiType: ALIEN_AI_MOTHERSHIP,\n  description: \"A large heavily armored ship with smart missiles.\",\n};\n\nexport const SHIP_DECOY = {\n  name: \"Decoy\",\n  objType: OBJ_SHIP,\n  propulsion: 0.0,\n  turnSpeed: 0.0,\n  resourcesMax: 0,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 0,\n  equip: [],\n  armorMax: 350,\n  armor: 350,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 0.55,\n  imageFile: SHIP_EXPLORER_FILE,\n  cost: {titanium:10, gold: 0, uranium: 0},\n  aiType: EQUIP_AI_MINE,\n  description: \"An empty shell of a ship.\",\n};\n\nexport const SHIP_TURRET = {\n  name: \"Turret\",\n  objType: OBJ_SHIP,\n  propulsion: 0.0,\n  turnSpeed: 0.0,\n  resourcesMax: 0,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 1,\n  equip: [EQUIP_FAST_BLASTER],\n  armorMax: 350,\n  armor: 350,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 0.6,\n  imageFile: ALIEN_SHIP_BLUE_LARGE_FILE,\n  cost: {titanium: 5, gold: 10, uranium: 5},\n  aiType: EQUIP_AI_TURRET,\n  description: \"A turret with a fast blaster.\",\n};\n\nexport const SHIP_STREAM_TURRET = {\n  name: \"Stream Turret\",\n  objType: OBJ_SHIP,\n  propulsion: 0.0,\n  turnSpeed: 0.0,\n  resourcesMax: 0,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 1,\n  equip: [EQUIP_STREAM_BLASTER],\n  armorMax: 500,\n  armor: 500,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 0.4,\n  imageFile: ALIEN_SHIP_BLUE_LARGE_FILE,\n  cost: {titanium: 10, gold: 20, uranium: 10},\n  aiType: EQUIP_AI_TURRET,\n  description: \"A well armored turret with a stream blaster\",\n};\n\nexport const SHIP_MISSILE = {\n  name: \"Missile\",\n  objType: OBJ_SHIP,\n  propulsion: 0.08,\n  turnSpeed: 0.25,\n  resourcesMax: 0,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 0,\n  equip: [],\n  armorMax: 200,\n  armor: 200,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 1,\n  imageFile: SHIP_BALL_FILE,\n  cost: {titanium: 0, gold: 5, uranium: 20},\n  aiType: EQUIP_AI_MISSILE,\n  description: \"An enemy seeking missile.\",\n};\n\nexport const SHIP_FRIENDSHIP_MISSILE = {\n  name: \"Friendship Missile\",\n  objType: OBJ_SHIP,\n  propulsion: 0.09, // best between 0.02 - 0.1\n  turnSpeed: 0.25, // // best between 0.3 - 0.07\n  resourcesMax: 0,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 0,\n  equip: [],\n  armorMax: 40,\n  armor: 40,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 0.5,\n  imageFile: ALIEN_SHIP_BLUE_FILE,\n  cost: {titanium: 0, gold: 10, uranium: 0},\n  aiType: EQUIP_AI_MISSILE,\n  description: \"A missile that turns enemies into friends.\",\n};\n\nexport const ALL_ALIENS = [SHIP_ALIEN_TURRET, SHIP_ALIEN, SHIP_ALIEN_LARGE, SHIP_ALIEN_STEALTH,  SHIP_ALIEN_STAPLE_TURRET, SHIP_ALIEN_FIRE, SHIP_ALIEN_MOTHERSHIP];\nexport const ALL_SHIPS = [SHIP_EXPLORER, SHIP_CARGO, SHIP_FAST, SHIP_SKELETON, SHIP_HEAVY, SHIP_FIGHTER, SHIP_WING, ...ALL_ALIENS];\n\n// This equipment needs to go after the ships (ugh)\nexport const EQUIP_DECOY_DEPLOYER = {\n  name: \"Decoy Deployer\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, coolTime: 25, cool: 0,\n  createShip: {type: SHIP_DECOY, dir: DIR_BEHIND_SHIP},\n  cost: {titanium: 0, gold: 50, uranium: 100},\n  description: \"Drops a fake ship.\"\n};\nexport const EQUIP_TURRET_DEPLOYER = {\n  name: \"Turret Deployer\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, coolTime: 100, cool: 0,\n  createShip: {type: SHIP_TURRET, dir: DIR_BEHIND_SHIP},\n  cost: {titanium: 0, gold: 200, uranium: 100},\n  description: \"Drops a turret with a fast blaster.\",\n};\nexport const EQUIP_STREAM_TURRET_DEPLOYER = {\n  name: \"Stream Turret Deployer\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, coolTime: 100, cool: 0,\n  createShip: {type: SHIP_STREAM_TURRET, dir: DIR_BEHIND_SHIP},\n  cost: {titanium: 100, gold: 400, uranium: 400},\n  description: \"Drops a turret with a stream blaster.\",\n};\n\nexport const EQUIP_MISSILE_LAUNCHER = {\n  name: \"Missile Launcher\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, coolTime: 100, cool: 0,\n  createShip: {type: SHIP_MISSILE, dir: DIR_AHEAD_OF_SHIP},\n  cost: {titanium: 50, gold: 250, uranium: 300},\n  description: \"Fires enemy-seeking missiles.\",\n};\nexport const EQUIP_FRIENDSHIP_GUN = {\n  name: \"Friendship Gun\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, coolTime: 100, cool: 0,\n  createShip: {type: SHIP_FRIENDSHIP_MISSILE, dir: DIR_AHEAD_OF_SHIP},\n  cost: {titanium: 100, gold: 300, uranium: 100},\n  description: \"Fires a missile that turns your enemies into allies.\",\n};\n\n\nexport const EQUIP_UPGRADES = [EQUIP_BRAKE, EQUIP_BLINK_BRAKE, EQUIP_THRUSTER, EQUIP_BLINK_THRUSTER, EQUIP_ARMOR, EQUIP_SPEED_BOOST, EQUIP_TURN_BOOST,\n  EQUIP_STORAGE, EQUIP_ENHANCED_ARMOR, EQUIP_ENHANCED_STORAGE, EQUIP_AUTOLANDER];\nexport const EQUIP_PRIMARY_WEAPONS = [EQUIP_BLASTER, EQUIP_FAST_BLASTER, EQUIP_STREAM_BLASTER, EQUIP_SPRINKLER_BLASTER, EQUIP_MELEE_GUN, EQUIP_SNIPER_RIFLE, EQUIP_ALIEN_BLASTER, EQUIP_STAPLE_GUN, EQUIP_STAPLE_GUN_HEAVY, EQUIP_ALIEN_BLASTER_FAST, EQUIP_ALIEN_BLASTER_LIGHTNING];\nexport const EQUIP_SECONDARY_WEAPONS = [EQUIP_DECOY_DEPLOYER, EQUIP_TURRET_DEPLOYER, EQUIP_STREAM_TURRET_DEPLOYER, EQUIP_MISSILE_LAUNCHER, EQUIP_ALIEN_MISSILE_LAUNCHER, EQUIP_SHIELD, EQUIP_SHIELD_LONG, EQUIP_SHIELD_STRONG, EQUIP_SHIELD_ULTRA, EQUIP_SHIELD_BLINK];\nexport const EQUIP_DROIDS = [EQUIP_R2D2, EQUIP_GUNNERY_DROID, EQUIP_LIGHTING_DROID, EQUIP_SHIELD_DROID];\nexport const ALL_EQUIP = [...EQUIP_UPGRADES, ...EQUIP_PRIMARY_WEAPONS, ...EQUIP_SECONDARY_WEAPONS, ...EQUIP_DROIDS];\n\nexport const XP_LEVELS = {\n  // Mining resources\n  [PLANET_ROCK_FILE]: [\n    {xp: 1, obj: EQUIP_BLASTER},\n    {xp: 10, obj: EQUIP_BRAKE},\n    {xp: 50, obj: SHIP_EXPLORER},\n    {xp: 100, obj: SHIP_CARGO},\n    {xp: 200, obj: EQUIP_ARMOR},\n    {xp: 1000, obj: EQUIP_SPEED_BOOST},\n  ],\n  [PLANET_RED_FILE]: [\n    {xp: 10, obj: EQUIP_STORAGE},\n    {xp: 50, obj: EQUIP_BLINK_BRAKE},\n    {xp: 100, obj: EQUIP_THRUSTER},\n    {xp: 500, obj: SHIP_FAST},\n    {xp: 1000, obj: EQUIP_BLINK_THRUSTER},\n  ],\n  [PLANET_GREEN_FILE]: [\n    {xp: 10, obj: SHIP_SKELETON},\n    {xp: 50, obj: EQUIP_R2D2},\n    {xp: 500, obj: SHIP_HEAVY},\n    {xp: 1000, obj: EQUIP_AUTOLANDER},\n  ],\n  [PLANET_PURPLE_FILE]: [\n    {xp: 10, obj: EQUIP_TURN_BOOST},\n    {xp: 300, obj: EQUIP_SHIELD_STRONG},\n    {xp: 750, obj: EQUIP_GUNNERY_DROID},\n    {xp: 1000, obj: SHIP_FIGHTER},\n    {xp: 2000, obj: EQUIP_SHIELD_BLINK},\n  ],\n  // Killing aliens\n  [SHIP_ALIEN_TURRET.name]: [\n    {xp: 1, obj: EQUIP_FAST_BLASTER},\n    {xp: 5, obj: EQUIP_ALIEN_BLASTER},\n    {xp: 10, obj: EQUIP_ALIEN_BLASTER_FAST},\n  ],\n  [SHIP_ALIEN.name]: [\n    {xp: 1, obj: EQUIP_SHIELD},\n    {xp: 5, obj: EQUIP_DECOY_DEPLOYER},\n    {xp: 10, obj: EQUIP_SHIELD_LONG},\n    {xp: 20, obj: SHIP_ALIEN},\n  ],\n  [SHIP_ALIEN_LARGE.name]: [\n    {xp: 1, obj: EQUIP_STREAM_BLASTER},\n    {xp: 3, obj: EQUIP_TURRET_DEPLOYER},\n    {xp: 7, obj: EQUIP_SNIPER_RIFLE},\n    {xp: 20, obj: EQUIP_STREAM_TURRET_DEPLOYER},\n    {xp: 50, obj: SHIP_ALIEN_LARGE},\n  ],\n  [SHIP_ALIEN_STEALTH.name]: [\n    {xp: 1, obj: EQUIP_MISSILE_LAUNCHER},\n    {xp: 5, obj: EQUIP_SPRINKLER_BLASTER},\n    {xp: 10, obj: EQUIP_FRIENDSHIP_GUN},\n  ],\n  [SHIP_ALIEN_STAPLE_TURRET.name]: [\n    {xp: 1, obj: EQUIP_STAPLE_GUN},\n    {xp: 3, obj: EQUIP_MELEE_GUN},\n    {xp: 7, obj: EQUIP_ENHANCED_STORAGE},\n    {xp: 10, obj: EQUIP_SHIELD_DROID},\n  ],\n  [SHIP_ALIEN_FIRE.name]: [\n    {xp: 1, obj: EQUIP_STAPLE_GUN_HEAVY},\n    {xp: 4, obj: EQUIP_ENHANCED_ARMOR},\n    {xp: 7, obj: EQUIP_SHIELD_ULTRA},\n    {xp: 15, obj: SHIP_ALIEN_FIRE},\n  ],\n  [SHIP_ALIEN_MOTHERSHIP.name]: [\n    {xp: 1, obj: EQUIP_ALIEN_BLASTER_LIGHTNING},\n    {xp: 2, obj: EQUIP_LIGHTING_DROID},\n    {xp: 3, obj: EQUIP_ALIEN_MISSILE_LAUNCHER},\n    {xp: 4, obj: SHIP_WING},\n  ]\n}\n\nexport const PLANET_DENSITY = new Map();\nPLANET_DENSITY.set(PLANET_ROCK_FILE, 0.025)\nPLANET_DENSITY.set(PLANET_RED_FILE, 0.02)\nPLANET_DENSITY.set(PLANET_GREEN_FILE, 0.013)\nPLANET_DENSITY.set(PLANET_PURPLE_FILE, 0.010)\n\n// Universe Rings\nexport const UNIVERSE_RINGS = [\n  {\n    planetCount: 1,\n    minDist: 1, maxDist: 2,\n    minDistToOtherPlanet: 10,\n    minPlanetRadius: 1500, maxPlanetRadius: 1501,\n    planetFiles: [PLANET_PURPLE_FILE],\n    aliens: [{count: 0, file: null}],\n  },\n  {\n    planetCount: 0,\n    minDist: 1700, maxDist: 2500,\n    minDistToOtherPlanet: 10,\n    minPlanetRadius: 10, maxPlanetRadius: 10,\n    planetFiles: [],\n    aliens: [\n      {count: 50, file: SHIP_ALIEN_STEALTH},\n      {count: 60, file: SHIP_ALIEN_FIRE},\n      {count: 30, file: SHIP_ALIEN_STAPLE_TURRET},\n    ],\n  },\n  {\n    planetCount: 200,\n    minDist: 2500, maxDist: 10000,\n    minDistToOtherPlanet: 150,\n    minPlanetRadius: 280, maxPlanetRadius: 500,\n    planetFiles: [PLANET_RED_FILE, PLANET_PURPLE_FILE, PLANET_GREEN_FILE],\n    aliens: [\n      {count: 400, file: SHIP_ALIEN_STAPLE_TURRET},\n      {count: 600, file: SHIP_ALIEN_LARGE},\n      {count: 300, file: SHIP_ALIEN_STEALTH},\n    ],\n  },\n  {\n    planetCount: 0,\n    minDist: 8000, maxDist: 12000,\n    minDistToOtherPlanet: 10,\n    minPlanetRadius: 10, maxPlanetRadius: 10,\n    planetFiles: [PLANET_RED_FILE],\n    aliens: [\n      {count: 100, file: SHIP_ALIEN_STAPLE_TURRET},\n      {count: 400, file: SHIP_ALIEN_STEALTH},\n    ],\n  },\n  {\n    planetCount: 520,\n    minDist: 10000, maxDist: 15000,\n    minDistToOtherPlanet: 150,\n    minPlanetRadius: 180, maxPlanetRadius: 300,\n    planetFiles: [PLANET_ROCK_FILE, PLANET_RED_FILE, PLANET_GREEN_FILE],\n    aliens: [\n      {count: 300, file: SHIP_ALIEN_TURRET},\n      {count: 700, file: SHIP_ALIEN},\n      {count: 300, file: SHIP_ALIEN_LARGE},\n    ],\n  },\n  {\n    planetCount: 2000,\n    minDist: 15000, maxDist: 25000,\n    minDistToOtherPlanet: 200,\n    minPlanetRadius: 150, maxPlanetRadius: 200,\n    planetFiles: [PLANET_ROCK_FILE, PLANET_RED_FILE],\n    aliens: [\n      {count: 1200, file: SHIP_ALIEN_TURRET},\n      {count: 350, file: SHIP_ALIEN}\n    ],\n  },\n  {\n    planetCount: 1000,\n    minDist: 25000, maxDist: 30000,\n    minDistToOtherPlanet: 300,\n    minPlanetRadius: 150, maxPlanetRadius: 180,\n    planetFiles: [PLANET_ROCK_FILE],\n    aliens: [{count: 500, file: SHIP_ALIEN_TURRET}],\n  },\n  {\n    planetCount: 800,\n    minDist: 30000, maxDist: UNIVERSE_RADIUS,\n    minDistToOtherPlanet: 500,\n    minPlanetRadius: 80, maxPlanetRadius: 150,\n    planetFiles: [PLANET_ROCK_FILE],\n    aliens: [],\n  },\n];\n","import {c, fly, manage, utils} from './';\nimport lodash from 'lodash';\n\n/**\n * Creates an empty world object, with only basic properties.\n * This will be populated by setupWorld()\n */\nexport function createEmptyWorld() {\n  return {\n    saveGameName: null, // name of last game saved/loaded\n    ship: null,\n    view: { // global XY for current view (in manage mode, always ship.xy in fly mode)\n      x: 0,\n      y: 0,\n    },\n    ships: [],\n    planets: [],\n    selectedPlanet: {resources: {}},\n    lastPlanetLanded: null,\n    gameTickCount : 0,\n    blueprints: {\n      ship: [],\n      equip: [],\n      xp: {\n        [c.PLANET_ROCK_FILE]: 0,\n        [c.PLANET_RED_FILE]: 0,\n        [c.PLANET_GREEN_FILE]: 0,\n        [c.PLANET_PURPLE_FILE]: 0,\n        [c.SHIP_ALIEN_TURRET.name]: 0,\n        [c.SHIP_ALIEN.name]: 0,\n        [c.SHIP_ALIEN_LARGE.name]: 0,\n        [c.SHIP_ALIEN_STEALTH.name]: 0,\n        [c.SHIP_ALIEN_STAPLE_TURRET.name]: 0,\n        [c.SHIP_ALIEN_FIRE.name]: 0,\n        [c.SHIP_ALIEN_MOTHERSHIP.name]: 0,\n      },\n      xpLevels: lodash.cloneDeep(c.XP_LEVELS),\n    },\n    nextId: 100, // unique ID for sprites, equip, etc...\n    // everything in system is transient and not serialized when saving the game\n    system: {\n      keys: {}, // Global keypress handlers\n      app: null, // Pixi App\n      gameState: c.GAME_STATE.INIT, // Current game state\n      isTyping: false, // used to stop keypress events ('w') when user is typing in input\n      gameLoop: null, // loop function in this state\n      bgSprite: null, // star background\n      explosionSheet: null, // spritesheet for explosions\n      explosions: [], //contains sprites\n      bullets: [], // contains all the bullets\n      nearby: {planets: [], ships: []}, // ships and planets near enough for collision detection and running AI\n      planetSpriteCache: {}, // {\"green_planet.png\" : Map(id:sprite, id:sprite)... }\n      shipSpriteCache: {}, // {\"alien_small.png\" : Map(id:sprite, id:sprite)... }\n      shieldSpriteCache: new Map(), // These sprites are each added to a ship and not reused\n      spriteContainers: {background: null, planets: null, bullets: null, ships: null, minimap: null, explosions:null},\n      screenHeight: c.SCREEN_HEIGHT, // changed based on window size\n      screenScale: 1, // scale due to window sizing\n      miniMapGraphics: null, // used as a canvas for drawing the miniMap\n      initializing: true, // set to false when the game fully running (after first draw)\n    },\n  };\n}\n\nexport function setupWorld() {\n  const world = window.world;\n  setupSpriteContainers();\n  createBackground();\n  createPlanets();\n  // Default selectedPlanet, shouldn't be displayed\n  world.selectedPlanet = world.planets[0];\n  window.world.shipStartX = c.PLAYER_START_X;\n  //window.world.shipStartX = -2500;\n  window.world.shipStartY = c.PLAYER_START_Y;\n  world.ship = createShip(c.SHIP_EXPLORER, c.PLAYER);\n  const shipSprite = getShipSprite(world.ship);\n  shipSprite.visible = true;\n  world.ship.resources = c.PLAYER_STARTING_RESOURCES;\n\n  // DEBUG SHIP\n  // world.ship.armorMax = 55000;\n  // world.ship.armor = 55000;\n  // world.ship.resources = {titanium: 10000, gold: 10000, uranium: 10000};\n  // world.ship.resourcesMax = 100000;\n  // world.ship.equip = [manage.makeEquip(c.EQUIP_BRAKE), manage.makeEquip(c.EQUIP_AUTOLANDER), manage.makeEquip(c.EQUIP_SNIPER_RIFLE),\n  //   manage.makeEquip(c.EQUIP_ALIEN_MISSILE_LAUNCHER),\n  //   manage.makeEquip(c.EQUIP_SHIELD_DROID), manage.makeEquip(c.EQUIP_SHIELD_ULTRA), manage.makeEquip(c.EQUIP_SHIELD_BLINK)];\n  // world.ship.equipMax = world.ship.equip.length;\n  // world.blueprints.equip = [...c.ALL_EQUIP];\n  // world.blueprints.ship = [...c.ALL_SHIPS];\n\n  // DEBUG test alien\n  // createAlien(c.SHIP_ALIEN_TURRET, c.PLAYER_START_X + 450, c.PLAYER_START_Y + 70);\n  // createAlien(c.SHIP_ALIEN_LARGE, c.PLAYER_START_X + 450, c.PLAYER_START_Y - 70);\n\n  // DEBUG Planet\n  // let testPlanet = createPlanet(c.PLANET_ROCK_FILE, \"home\", 100, 200, {\n  //   titanium: 20500,\n  //   gold: 51000,\n  //   uranium: 5000,\n  // });\n  // testPlanet.x = c.PLAYER_START_X - 150;\n  // testPlanet.y = c.PLAYER_START_Y;\n  // testPlanet.resources.stored = {titanium: 10000, gold: 10000, uranium: 10000};\n\n  createAliens();\n  setupMiniMap();\n  setupExplosionSheet();\n}\n\n/**\n * Sets up the sprite containers in the correct display order\n */\nexport function setupSpriteContainers() {\n  let mainStage = window.world.system.app.stage;\n  let spriteContainers = window.world.system.spriteContainers;\n  spriteContainers.background = new window.PIXI.Container();\n  mainStage.addChild(spriteContainers.background);\n\n  spriteContainers.planets = new window.PIXI.Container();\n  mainStage.addChild(spriteContainers.planets);\n\n  spriteContainers.bullets = new window.PIXI.Container();\n  mainStage.addChild(spriteContainers.bullets);\n\n  spriteContainers.ships = new window.PIXI.Container();\n  mainStage.addChild(spriteContainers.ships);\n\n  spriteContainers.explosions = new window.PIXI.Container();\n  mainStage.addChild(spriteContainers.explosions);\n\n  spriteContainers.minimap = new window.PIXI.Container();\n  mainStage.addChild(spriteContainers.minimap);\n}\n\nexport function createBackground() {\n  let container = window.world.system.spriteContainers.background;\n  window.world.system.bgSprite = new window.PIXI.TilingSprite(\n    window.PIXI.Texture.from(c.STAR_BACKGROUND_FILE),\n    c.SCREEN_WIDTH,\n    c.SCREEN_HEIGHT,\n  );\n  container.addChild(window.world.system.bgSprite);\n}\n\nexport function createPlanets() {\n  let container = window.world.system.spriteContainers.planets;\n  for (let ring of c.UNIVERSE_RINGS) {\n    for (let i = 0; i < ring.planetCount; i++) {\n      let fileName = ring.planetFiles[utils.randomInt(0, ring.planetFiles.length - 1)];\n      let name = String.fromCharCode(65 + Math.floor(Math.random() * 26)) + utils.randomInt(1000, 999999);\n      let radius = utils.randomInt(ring.minPlanetRadius, ring.maxPlanetRadius);\n      let mass = radius * radius * c.PLANET_DENSITY.get(fileName);\n      let maxResource = mass * 2 * 0.3;\n      let minResource = mass * 0.15;\n      // Setup the planet\n      let planet = createPlanet(fileName, name, radius, mass, {\n        titanium: utils.randomInt(minResource, maxResource),\n        gold: utils.randomInt(minResource, maxResource),\n        uranium: utils.randomInt(minResource, maxResource),\n      }, container);\n      let {x, y} = getFreeXy(planet, ring.minDistToOtherPlanet, 0, ring.minDist, ring.maxDist);\n      planet.x = x;\n      planet.y = y;\n    }\n  }\n}\n\n/**\n * Distance to the nearest planet that is not equal to origPlanet\n * @return {{nearestPlanetDist: number, nearestPlanet: null}}\n */\nfunction nearestPlanetDistance(origPlanet, x, y) {\n  let minDist = 99999999999;\n  let nearestPlanet = null;\n  for (let planet of window.world.planets) {\n    if (planet !== origPlanet) {\n      let dist = utils.distanceBetween(x, y, planet.x, planet.y) - planet.radius;\n      if (origPlanet) {\n        dist -= origPlanet.radius;\n      }\n      if (!nearestPlanet || (dist < minDist)) {\n        minDist = dist;\n        nearestPlanet = planet;\n      }\n    }\n  } // for planet\n  return {nearestPlanet: nearestPlanet, nearestPlanetDist: minDist};\n}\n\n/**\n * Distance to the nearest alien\n * @return {{nearestAlien: null, nearestAlienDist: number}}\n */\nfunction nearestAlienDistance(x, y) {\n  let minDist = 99999999999;\n  let nearestAlien = null;\n  for (let alien of window.world.system.nearby.ships) {\n    if (alien === window.world.ship) {\n      continue;\n    }\n    // This assumes the calling code alien is the same size\n    let dist = utils.distanceBetween(x, y, alien.x, alien.y) - (alien.radius * 2);\n    if (!nearestAlien || (dist < minDist)) {\n      minDist = dist;\n      nearestAlien = alien;\n    }\n  } // for\n  return {nearestAlien: nearestAlien, nearestAlienDist: minDist};\n}\n\n/**\n * Find a free spot of space to stick something\n * This will recurse until it finds a free spot.\n * @return {{x, y}}\n */\nfunction getFreeXy(planet, minDistToPlanet, minDistToAlien, minDist, maxDist, failCount = 0) {\n  let dir = utils.randomFloat(0, Math.PI * 2);\n  let dist = utils.randomInt(minDist, maxDist);\n  let {x, y} = utils.getPointFrom(0, 0, dir, dist);\n  let np = 9999;\n  if (minDistToPlanet > 0) {\n    let {nearestPlanetDist} = nearestPlanetDistance(planet, x, y);\n    if (nearestPlanetDist < minDistToPlanet) {\n      return getFreeXy(planet, minDistToPlanet, minDistToAlien, minDist, maxDist, ++failCount);\n    }\n    np = nearestPlanetDist;\n  }\n  if (minDistToAlien > 0) {\n    let {nearestAlienDist} = nearestAlienDistance(x, y);\n    if (nearestAlienDist < minDistToAlien) {\n      return getFreeXy(planet, minDistToPlanet, minDistToAlien, minDist, maxDist, ++failCount);\n    }\n  }\n  if (failCount > 200) {\n    console.warn(\"Had a hard time finding a spot, it took \" + failCount + \" tries on ring \" + minDist + \" np=\" + np);\n  }\n  return {x, y};\n}\n\n// Creates and returns a planet (and adds it to the app)\nexport function createPlanet(planetFile, name, radius, mass, resources) {\n  let planet = {};\n  planet.name = name;\n  planet.x = 0; // temp should get reset\n  planet.y = 0; // temp should get reset\n  planet.mass = mass;\n  planet.resources = {\n    stored: {titanium: 0, gold: 0, uranium: 0},\n    raw: resources\n  };\n  planet.ships = []; // stored ships \n  planet.equip = []; // stored equipment\n  planet.buildings = []; // mines, factories\n  planet.radius = radius;\n  planet.lastLandingDir = 0;\n  planet.spriteFile = planetFile;\n  planet.spriteId = null; // no sprite created yet\n  window.world.planets.push(planet);\n  return planet;\n}\n\n/**\n * Finds or creates a planet sprite.\n * This cache works a little different, no sprites are re-used.\n * Once a planetSprite is created the buildings are added and it stays attached to the planet\n * Otherwise we would have to empty out the container and redraw the planet and buildings each time\n */\nexport function getPlanetSprite(planet) {\n  let planetSpriteCache = window.world.system.planetSpriteCache[planet.spriteFile];\n  // No cache for this file yet - create an empty cache\n  if (!planetSpriteCache) {\n    planetSpriteCache = new Map();\n    window.world.system.planetSpriteCache[planet.spriteFile] = planetSpriteCache;\n  }\n  // Lookup the sprite in the cache by ID\n  let planetContainer = planetSpriteCache.get(planet.spriteId);\n  if (planetContainer) {\n    return planetContainer;\n  }\n  // Setup the planet container sprite (contains planet plus buildings)\n  planetContainer = new window.PIXI.Container();\n  planetContainer.x = 0; // will be set on every draw\n  planetContainer.y = 0;\n  planetContainer.visible = true;\n  window.world.system.spriteContainers.planets.addChild(planetContainer);\n\n  // Setup the planet sprite itself\n  const planetSprite = new window.PIXI.Sprite(\n    window.PIXI.loader.resources[c.SPRITESHEET_JSON].textures[planet.spriteFile]);\n  planetSprite.anchor.set(0.5, 0.5);\n  let spriteScale = planet.radius * 2 / planetSprite.width;\n  // Planets with atmosphere are a little smaller than the full image size\n  if ((planet.spriteFile === c.PLANET_PURPLE_FILE) || (planet.spriteFile === c.PLANET_GREEN_FILE)) {\n    spriteScale = spriteScale * 1.08;\n  }\n  planetSprite.scale.set(spriteScale, spriteScale);\n  planetContainer.addChild(planetSprite);\n\n  for (const building of planet.buildings) {\n    manage.makeBuildingSprite(building, planet, planetContainer);\n  }\n\n  // Cache the new sprite\n  planet.spriteId = window.world.nextId++;\n  planetSpriteCache.set(planet.spriteId, planetContainer);\n  return planetContainer;\n}\n\n/**\n * Finds or creates a sprite for the ship\n * NOTE: This will return a non-visible sprite, the calling code is responsible for making the sprite visible\n */\nexport function getShipSprite(ship) {\n  // if (!ship.alive) {\n  //   console.warn('You should not get sprites for dead ships.');\n  //   console.trace();\n  //   window.error(); // does not exist... thus an error!\n  //   return;\n  // }\n  let shipSpriteCache = window.world.system.shipSpriteCache[ship.imageFile];\n  // No cache for this file yet - create an empty cache\n  if (!shipSpriteCache) {\n    shipSpriteCache = new Map();\n    window.world.system.shipSpriteCache[ship.imageFile] = shipSpriteCache;\n  }\n  // Lookup the sprite in the cache by ID\n  let sprite = shipSpriteCache.get(ship.spriteId);\n  if (sprite) {\n    return sprite;\n  }\n  // Lookup a free sprite (dead or off-screen alien)\n  for (let [spriteId, foundSprite] of shipSpriteCache.entries()) {\n    if (!foundSprite.visible) {\n      foundSprite.visible = false;\n      foundSprite.rotation = ship.rotation;\n      foundSprite.scale.set(ship.imageScale, ship.imageScale);\n      ship.spriteWidth = foundSprite.width;\n      ship.spriteHeight = foundSprite.height;\n      ship.radius = foundSprite.width / 2; // used for circular aliens\n      ship.spriteId = spriteId;\n      //console.log('found old sprite '+spriteId+' '+ship.imageFile);\n      return foundSprite;\n    }\n  } // foundSprite\n\n  // No sprite found - create a new one\n  let spriteSheet = window.PIXI.loader.resources[c.SPRITESHEET_JSON];\n  sprite = new window.PIXI.Sprite(spriteSheet.textures[ship.imageFile]);\n  sprite.position.set(c.HALF_SCREEN_WIDTH, c.HALF_SCREEN_HEIGHT);\n  sprite.anchor.set(0.5, 0.5);  // pivot on ship center\n  sprite.scale.set(ship.imageScale, ship.imageScale);\n  sprite.rotation = ship.rotation;\n  sprite.visible = false;\n  ship.spriteWidth = sprite.width;\n  ship.spriteHeight = sprite.height;\n  ship.radius = sprite.width / 2; // used for circular aliens\n  ship.spriteId = window.world.nextId++;\n  shipSpriteCache.set(ship.spriteId, sprite);\n  window.world.system.spriteContainers.ships.addChild(sprite);\n  //console.log('created new ship sprite '+ship.imageFile, sprite);\n  return sprite;\n}\n\n/**\n * @return The original width/height of the sprite before scaling was applied\n *   {width, height}\n */\nexport function getSpriteOrigWithHeight(sprite) {\n  const origWidth = sprite.width;\n  const origHeight = sprite.height;\n  sprite.scale.set(1, 1);\n  const width = sprite.width;\n  const height = sprite.height;\n  sprite.width = origWidth;\n  sprite.height = origHeight;\n  return {width, height};\n}\n\nexport function setShieldRadius(ship, shield, shieldSprite) {\n  const shipSprite = getShipSprite(ship);\n  shieldSprite.anchor.set(0.5, 0.5);  // pivot on center\n  const {width, height} = getSpriteOrigWithHeight(shipSprite);\n  // Radius within the scaled ship sprite\n  const shieldWidth = Math.max(width, height) * 1.5; // 1.5 to make it larger than the ship\n  shieldSprite.width = shieldWidth;\n  shieldSprite.height = shieldWidth;\n  shield.radius = (shieldWidth * ship.imageScale) / 2; // size without ship scaling\n}\n\nexport function getShieldSprite(ship, shield) {\n  const cacheId = ship.id + '~' + shield.spriteFile;\n  // Lookup the sprite in the cache by ID\n  let shieldSprite = window.world.system.shieldSpriteCache.get(cacheId);\n  if (shieldSprite) {\n    setShieldRadius(ship, shield, shieldSprite);\n    return shieldSprite;\n  }\n  // Add a new shield image to the ship\n  const shipSprite = getShipSprite(ship);\n  let spriteSheet = window.PIXI.loader.resources[c.SPRITESHEET_JSON];\n  shieldSprite = new window.PIXI.Sprite(spriteSheet.textures[shield.spriteFile]);\n  setShieldRadius(ship, shield, shieldSprite);\n  shipSprite.addChild(shieldSprite);\n  window.world.system.shieldSpriteCache.set(cacheId, shieldSprite);\n  return shieldSprite;\n}\n\n// Creates and returns a ship object\nexport function createShip(shipType, owner) {\n  let ship = lodash.cloneDeep(shipType);\n  ship.id = window.world.nextId++;\n  ship.selectedSecondaryWeaponIndex = -1;\n  for (let i=0; i<ship.equip.length; i++) {\n    const equip = ship.equip[i];\n    equip.id = window.world.nextId++;\n    if (ship.selectedSecondaryWeaponIndex < 0 && equip.type === c.EQUIP_TYPE_SECONDARY_WEAPON) {\n      ship.selectedSecondaryWeaponIndex = i;\n    }\n  }\n  ship.owner = owner;\n  ship.vx = 0; // velocityX\n  ship.vy = 0; // velocityY\n  ship.x = window.world.shipStartX;\n  ship.y = window.world.shipStartY;\n  ship.spriteId = null; // no sprite yet\n  ship.alive = true; // set to false if it blows up\n  ship.spriteWidth = null; //We won't know until we load the sprite\n  ship.rotation = 0;\n  window.world.system.nearby.ships.push(ship);\n  return ship;\n}\n\nexport function createAlien(shipType, x, y) {\n  let alien = createShip(shipType, c.ALIEN);\n  window.world.ships.push(alien);\n  alien.x = x;\n  alien.y = y;\n  alien.radius = 50; // will be set to a real value when sprite loads\n  return alien;\n}\n\nexport function createAliens() {\n  // Create motherships\n  createAlien(c.SHIP_ALIEN_MOTHERSHIP, 1700, 200);\n  createAlien(c.SHIP_ALIEN_MOTHERSHIP, 0, 1700);\n  createAlien(c.SHIP_ALIEN_MOTHERSHIP, -1700, 0);\n  createAlien(c.SHIP_ALIEN_MOTHERSHIP, 0, -1700);\n\n  for (let ring of c.UNIVERSE_RINGS) {\n    for (const alienInfo of ring.aliens) {\n      for (let i = 0; i < alienInfo.count; i++) {\n        let {x, y} = getFreeXy(null, c.MIN_ALIEN_DIST_TO_PLANET, c.MIN_ALIEN_DIST_TO_ALIEN, ring.minDist, ring.maxDist);\n        createAlien(alienInfo.file, x, y);\n      } // for i\n    } // for alienInfo\n  } // for ring\n}\n\nexport function setupMiniMap() {\n  let container = window.world.system.spriteContainers.minimap;\n  let miniMapContainer = new window.PIXI.Container();\n  container.addChild(miniMapContainer);\n\n  // Mask so drawings don't spill out of the map\n  let mask = new window.PIXI.Graphics();\n  mask.drawRect(0, c.SCREEN_HEIGHT - c.MINIMAP_HEIGHT, c.MINIMAP_WIDTH, c.SCREEN_HEIGHT);\n  mask.renderable = true;\n  mask.cacheAsBitmap = true;\n  miniMapContainer.addChild(mask);\n  miniMapContainer.mask = mask;\n\n  // Graphics for drawing shapes on\n  let g = new window.PIXI.Graphics();\n  miniMapContainer.addChild(g);\n  window.world.system.miniMapGraphics = g;\n}\n\n/**\n * Called when the user clicks on the screen\n */\nexport function click(event) {\n  let x = event.data.global.x;\n  let y = event.data.global.y;\n  const screenScale = window.world.system.screenScale;\n  let scaledX = x / screenScale;\n  let scaledY = y / screenScale;\n  if ((scaledX < c.MINIMAP_WIDTH) && (scaledY > (c.SCREEN_HEIGHT - c.MINIMAP_HEIGHT))) {\n    fly.clickOnMinimap(scaledX, scaledY);\n  }\n}\n\nexport function changeGameState(newState) {\n  const world = window.world;\n  world.system.gameState = newState;\n  if (newState === c.GAME_STATE.FLY) {\n    fly.enterFlyState();\n    world.system.gameLoop = fly.flyLoop;\n  } else if (newState === c.GAME_STATE.MANAGE) {\n    manage.enterManageState();\n    world.system.gameLoop = manage.manageLoop;\n  } else {\n    world.system.gameLoop = null;\n  }\n}\n\n/**\n * Loop to run building, runs in any game mode (fly + manage)\n */\nexport function runBuildings() {\n  const world = window.world;\n  for (let planet of world.planets) {\n    for (let building of planet.buildings) {\n      if (building.type === c.BUILDING_TYPE_MINE) {\n        mineResource(planet, 'titanium', c.MINE_SPEED_TITANIUM);\n        mineResource(planet, 'gold', c.MINE_SPEED_GOLD);\n        mineResource(planet, 'uranium', c.MINE_SPEED_URANIUM);\n      }\n    } // for building\n    // If planet is out of resources stop the mine animations\n    if ((planet.resources.raw.titanium === 0)\n      && (planet.resources.raw.gold === 0)\n      && (planet.resources.raw.uranium === 0)) {\n      const planetSprite = getPlanetSprite(planet);\n      for (const buildingSprite of planetSprite.children) {\n        // all animated sprites stop (this may not be true if new building types are added)\n        if (buildingSprite.animationSpeed) {\n          buildingSprite.animationSpeed = 0;\n        }\n      }\n    }\n  } // for planet\n}\n\nfunction mineResource(planet, resourceType, amount) {\n  if (planet.resources.raw[resourceType] > 0) {\n    planet.resources.raw[resourceType] -= amount;\n    planet.resources.stored[resourceType] += amount;\n    if (planet.resources.raw[resourceType] <= 0) {\n      planet.resources.raw[resourceType] = 0;\n    }\n    addMiningXp(amount, planet);\n  }\n}\n\nfunction addMiningXp(amount, planet) {\n  let blueprints = window.world.blueprints;\n  const xp = blueprints.xp[planet.spriteFile] += amount;\n  let nextLevel = blueprints.xpLevels[planet.spriteFile][0];\n  if (nextLevel && (nextLevel.xp <= xp)) {\n    addBlueprint(nextLevel);\n    // Remove the item\n    blueprints.xpLevels[planet.spriteFile].shift();\n  }\n}\n\nexport function addAlienXp(ship) {\n  let blueprints = window.world.blueprints;\n  let xp = blueprints.xp[ship.name];\n  if (!xp) {\n    xp = 1;\n  }  else {\n    xp += 1;\n  }\n  blueprints.xp[ship.name] = xp;\n  if (blueprints.xpLevels[ship.name]) {\n    let nextLevel = blueprints.xpLevels[ship.name][0];\n    if (nextLevel && (nextLevel.xp <= xp)) {\n      addBlueprint(nextLevel);\n      // Remove the item\n      blueprints.xpLevels[ship.name].shift();\n    }\n  }\n}\n\nexport function addBlueprint(nextLevel) {\n  utils.showToast('New plan: ' + nextLevel.obj.name);\n  let blueprints = window.world.blueprints;\n  if (nextLevel.obj.objType === c.OBJ_EQUIP) {\n    blueprints.equip.push(nextLevel.obj);\n  } else if (nextLevel.obj.objType === c.OBJ_SHIP) {\n    blueprints.ship.push(nextLevel.obj);\n  } else {\n    console.warn(\"Could not find blueprint of type \" + nextLevel.obj.objType + \" nextLevel=\", nextLevel);\n  }\n}\n\n/**\n * Checks if the combined resources of planet and ship can afford the resources\n * Call this before calling payResourceCost\n * @return true if there are enough resources available\n */\nexport function canAfford(planet, ship, resources) {\n  let titanium = 0;\n  let gold = 0;\n  let uranium = 0;\n  if (planet) {\n    titanium += planet.resources.stored.titanium;\n    gold += planet.resources.stored.gold;\n    uranium += planet.resources.stored.uranium;\n  }\n  if (ship) {\n    titanium += ship.resources.titanium;\n    gold += ship.resources.gold;\n    uranium += ship.resources.uranium;\n  }\n  return (titanium >= resources.titanium)\n    && (gold >= resources.gold)\n    && (uranium >= resources.uranium);\n}\n\n/**\n * Pays the cost, taking from the planet and the ship as available\n * NOTE: This will not ensure you have enough resources, you can go into debt if you call this without checking\n * first using canAfford()\n * @param planet planet to get resources from\n * @param ship ship to get resources from\n * @param resources amount to pay\n */\nexport function payResourceCost(planet, ship, resources) {\n  payResource(planet, ship, 'titanium', resources.titanium);\n  payResource(planet, ship, 'gold', resources.gold);\n  payResource(planet, ship, 'uranium', resources.uranium);\n}\n\nexport function payResource(planet, ship, resourceType, amount) {\n  let paid = -amount; // amount owing (overwritten if some payment comes from the planet)\n  if (planet) {\n    paid = planet.resources.stored[resourceType] - amount;\n    if (paid >= 0) {\n      planet.resources.stored[resourceType] -= amount;\n      return;\n    } else {\n      // Planet can't afford this purchase, take some from the ship\n      planet.resources.stored[resourceType] = 0;\n    }\n  }\n  if (ship) {\n    ship.resources[resourceType] = ship.resources[resourceType] + paid;\n    if (ship.resources[resourceType] < 0) {\n      console.warn(\"Ship is in debt \" + ship.resources[resourceType] + \" \" + resourceType);\n    }\n  } else if (paid < 0) {\n    planet.resources.stored[resourceType] = planet.resources.stored[resourceType] + paid;\n    console.warn(\"Planet is in debt \" + planet.resources.stored[resourceType] + \" \" + resourceType);\n  }\n}\n\nexport function setupExplosionSheet() {\n  window.world.system.explosionSheet = window.PIXI.Loader.shared.resources[c.CRASH_JSON].spritesheet;\n  // Preload an explosion sprite animation (these will be cached and reused in world.system.explosions)\n  createExplosionSprite();\n}\n\nexport function createExplosionSprite() {\n  let sprite = new window.PIXI.AnimatedSprite(window.world.system.explosionSheet.animations[c.CRASH]);\n  sprite.animationSpeed = 0.4;\n  sprite.loop = false;\n  sprite.anchor.set(0.5, 0.5);\n  sprite.scale.set(2, 2);\n  sprite.x = c.HALF_SCREEN_WIDTH;\n  sprite.y = c.HALF_SCREEN_WIDTH;\n  sprite.loop = true;\n  sprite.visible = false;\n  window.world.system.explosions.push(sprite);\n  window.world.system.spriteContainers.explosions.addChild(sprite);\n  return sprite;\n}\n","import {ai, c, game, manage, utils} from './';\n\nexport function enterFlyState() {\n  console.log(\"Take off\");\n}\n\n// Main play mode - flying\nexport function flyLoop(delta) {\n  if (delta > 1.005) {\n    console.log('Lagging with delta=' + delta);\n  }\n  let world = window.world;\n  let ship = window.world.ship;\n\n  // Cache all the nearby planets and ships\n  setupNearby();\n\n  // When ship.alive is false the ship is exploding\n  if (ship.alive) {\n    runDroids(ship);\n    // Keypress handling\n    if (world.system.keys.left.isDown || world.system.keys.a.isDown) {\n      turnShip(ship, true);\n    }\n    if (world.system.keys.right.isDown || world.system.keys.d.isDown) {\n      turnShip(ship, false);\n    }\n    if (world.system.keys.up.isDown || world.system.keys.w.isDown) {\n      propelShip(ship);\n    }\n    if (world.system.keys.down.isDown || world.system.keys.s.isDown) {\n      brakeShip(ship);\n    }\n    if (world.system.keys.space.isDown) {\n      firePrimaryWeapon(ship, 0.05);\n    }\n    if (world.system.keys.x.isDown) {\n      fireSecondaryWeapon(ship);\n    }\n    if (world.system.keys.q.isDown) {\n      thrustShip(ship, true);\n    }\n    if (world.system.keys.e.isDown) {\n      thrustShip(ship, false);\n    }\n\n    // Find planets in view\n    let planetsInView = [];\n    for (let planet of world.system.nearby.planets) {\n      if (planetInView(ship, planet)) {\n        planetsInView.push(planet);\n      }\n    }\n\n    // Gravity\n    for (let planet of planetsInView) {\n      let grav = utils.calcGravity(ship.x, ship.y, planet);\n      ship.vx += grav.x;\n      ship.vy += grav.y;\n    }\n\n    // move the ship\n    ship.x += ship.vx;\n    ship.y += ship.vy;\n    world.view.x = ship.x;\n    world.view.y = ship.y;\n\n    let shipSprite = game.getShipSprite(ship);\n    shipSprite.rotation = ship.rotation;\n\n    // Don't detect collisions until all the drawing is done\n    // Pixijs sometimes gets the sprite locations wrong when they haven't been rendered yet\n    if (!world.system.initializing) {\n      // Ship-Planet Collisions\n      for (let planet of planetsInView) {\n        if (detectCollisionWithPlanet(ship, shipSprite, planet)) {\n          landShip(ship, planet);\n          return; // exit loop\n        }\n      } // for planet\n      // Ship-Alien collision\n      for (let alien of world.system.nearby.ships) {\n        if (alien.alive && detectCollisionWithAlien(ship, shipSprite, alien)) {\n          shipsCollide(ship, alien);\n        }\n      }\n    }\n  }\n\n  moveExplosions(); // especially alien explosions\n  moveBackground(ship);\n  drawMiniMap();\n  // first draw is done\n  if (world.system.initializing) {\n    world.system.initializing = false;\n  }\n}\n\n\n/**\n * Creates a cache of all nearby planets and ships\n */\nexport function setupNearby() {\n  const nearby = window.world.system.nearby;\n  const ship = window.world.ship;\n  const minX = ship.x - c.NEARBY_WIDTH / 2;\n  const maxX = ship.x + c.NEARBY_WIDTH / 2;\n  const minY = ship.y - c.NEARBY_HEIGHT / 2;\n  const maxY = ship.y + c.NEARBY_HEIGHT / 2;\n\n  nearby.planets = [];\n  // for every planet\n  for (const planet of window.world.planets) {\n    if ((planet.x + planet.radius >= minX) && (planet.x - planet.radius <= maxX) &&\n      (planet.y + planet.radius >= minY) && (planet.y - planet.radius <= maxY)) {\n      nearby.planets.push(planet);\n    }\n  } // for planet\n\n  // for every ship\n  nearby.ships = [window.world.ship]; // ship is always nearby\n  for (const ship of window.world.ships) {\n    if ((ship.x + ship.radius >= minX) && (ship.x - ship.radius <= maxX) &&\n      (ship.y + ship.radius >= minY) && (ship.y - ship.radius <= maxY)) {\n      nearby.ships.push(ship);\n    }\n  } // for ship\n}\n\n/**\n * Redraw all planets and aliens\n */\nexport function repositionScreen() {\n  const ship = window.world.ship;\n  // Reposition all the planets\n  for (let planet of window.world.planets) {\n    planetInView(ship, planet);\n  }\n  for (const ship of window.world.ships) {\n    if (ship.spriteId) {\n      game.getShipSprite(ship).visible = false;\n      ship.spriteId = null;\n    }\n  }\n  setupNearby();\n  // Reposition all the aliens\n  ai.moveAliens();\n  drawMiniMap();\n}\n\n/**\n * Cools all ship weapons, run in mainLoop\n */\nexport function coolAllWeapons() {\n  // Ship is in nearby\n  for (let ship of window.world.system.nearby.ships) {\n    coolWeapons(ship);\n  }\n}\n\n/**\n * called in flyLoop to cool weapons\n */\nexport function coolWeapons(ship) {\n  for (let equip of ship.equip) {\n    // If equip has a cool time\n    if (equip.cool) {\n      equip.cool -= 1;\n    }\n    // Gunnery Droids are equip with weapons\n    if (equip.weapon && equip.weapon.cool) {\n      equip.weapon.cool -= 1;\n    }\n    if (equip.shield && equip.shield.active) {\n      equip.shield.lifetime -= 1;\n      if (equip.shield.lifetime <= 0) {\n        equip.shield.lifetime = 0;\n        disableShield(ship, equip.shield);\n      }\n    }\n  }\n}\n\nexport function resetWeaponsCool(ship) {\n  for (let equip of ship.equip) {\n    if ((equip.type === c.EQUIP_TYPE_PRIMARY_WEAPON) && (equip.cool > 0)) {\n      equip.cool = 0;\n    }\n  }\n}\n\nexport function runDroids(ship) {\n  for (let droid of ship.equip) {\n    if ((droid.type === c.EQUIP_TYPE_REPAIR_DROID) && (ship.armor < ship.armorMax)) {\n      let cost = {titanium: 0, gold: 0, uranium: 0};\n      if (game.canAfford(null, ship, cost)) {\n        ship.armor += droid.repairSpeed;\n        game.payResourceCost(null, ship, cost);\n      }\n    } else if (droid.type === c.EQUIP_TYPE_GUNNERY_DROID) {\n      shootAtNearestAlien(ship, droid.weapon);\n    }\n    // NOTE: Shield droid runs in checkForBulletCollision\n  } // for\n}\n\n/**\n * Fires the weapon in the direction of the nearest alien (if able to )\n */\nexport function shootAtNearestAlien(ship, weapon) {\n  // If we can't shoot, don't waste our time\n  if (weapon.cool > 0) {\n    return;\n  }\n  let nearestAlien = null;\n  let nearestAlienDist = null;\n  for (let alien of window.world.system.nearby.ships) {\n    if (alien.alive && alien.owner === c.ALIEN) {\n      let dist = utils.distanceBetween(ship.x, ship.y, alien.x, alien.y);\n      if (!nearestAlien || (dist < nearestAlienDist)) {\n        nearestAlien = alien;\n        nearestAlienDist = dist;\n      }\n    }\n  } // for\n  if (nearestAlien && (nearestAlienDist <= weaponRange(weapon))) {\n    const origDir = ship.rotation;\n    ship.rotation = utils.normalizeRadian(Math.atan2(nearestAlien.y - ship.y, nearestAlien.x - ship.x));\n    fireWeapon(weapon, ship, 0.1);\n    ship.rotation = origDir;\n  }\n}\n\nexport function moveBackground(ship) {\n  let bgSprite = window.world.system.bgSprite;\n  bgSprite.tilePosition.x = (100 - ship.x) + c.HALF_SCREEN_WIDTH;\n  bgSprite.tilePosition.y = (100 - ship.y) + c.HALF_SCREEN_HEIGHT;\n}\n\n/**\n * @return true if the planet is in view of the ship, false otherwise\n * NOTE: This will set the sprite.visible and sprite x/y attributes for the planet\n */\nexport function planetInView(ship, planet) {\n  // Right side\n  if ((ship.x + c.HALF_SCREEN_WIDTH + planet.radius < planet.x) || // Right\n    (ship.x - c.HALF_SCREEN_WIDTH - planet.radius > planet.x) || // Left\n    (ship.y + c.HALF_SCREEN_HEIGHT + planet.radius < planet.y) || // Bottom\n    (ship.y - c.HALF_SCREEN_HEIGHT - planet.radius > planet.y)) { // Top\n    // Planet is not currently visible, but if it has an Id then it used to be visible\n    if (planet.spriteId) {\n      const sprite = game.getPlanetSprite(planet);\n      if (sprite.visible) {\n        sprite.visible = false;\n      }\n    }\n    return false;\n  }\n  // Here we know this planet is in view\n  const sprite = game.getPlanetSprite(planet);\n  sprite.visible = true;\n  // Set planet relative to the ship's viewport\n  sprite.x = (planet.x - ship.x) + c.HALF_SCREEN_WIDTH;\n  sprite.y = (planet.y - ship.y) + c.HALF_SCREEN_HEIGHT;\n  return true;\n}\n\n/**\n * @return the first active shield the ship is equipped with\n * NOTE: This returns equip.shield (NOT the full equip object)\n */\nexport function getActiveShield(ship) {\n  for (const equip of ship.equip) {\n    if (equip.shield && equip.shield.active) {\n      return equip.shield;\n    }\n  }\n  return null;\n}\n\n/**\n * @returns The first shield that is not currently used and cooled enough to re-use\n * NOTE: This returns the whole equip (not just the shield)\n */\nexport function getAvailableShieldEquip(ship) {\n  for (const equip of ship.equip) {\n    if (equip.shield && !equip.shield.active && equip.cool === 0) {\n      return equip;\n    }\n  }\n  return null;\n}\n\n/**\n * @returns true if the ship is equipped with a shield droid\n */\nexport function hasShieldDroid(ship) {\n  for (const equip of ship.equip) {\n    if (equip.type === c.EQUIP_TYPE_SHIELD_DROID) {\n      return equip;\n    }\n  }\n  return null;\n}\n\n/**\n * @return the first active shield equip in the ship, and if none are active, returns the first shield it finds.\n * returns an equip (not equip.shield like getActiveShield)\n */\nexport function getEquippedShield(ship) {\n  let shield = null;\n  for (const equip of ship.equip) {\n    if (equip.shield) {\n      shield = equip;\n      if (equip.shield.active) {\n        return shield;\n      }\n    }\n  } // for equip\n  return shield;\n}\n\n// Returns true if there is a collision and false otherwise\nexport function detectCollisionWithPlanet(ship, shipSprite, planet) {\n  const shield = getActiveShield(ship);\n  if (shield) {\n    // shield collision is round\n    return utils.distanceBetween(ship.x, ship.y, planet.x, planet.y) < (planet.radius + shield.radius);\n  }\n  // [[x,y],[x,y]]\n  let collisionPoints = utils.getVertexData(ship.x, ship.y, shipSprite);\n  for (let point of collisionPoints) {\n    let dist = utils.distanceBetween(point[0], point[1], planet.x, planet.y);\n    if (dist < planet.radius - c.ALLOWED_OVERLAP) {\n      return true;\n    }\n  }\n  return false;\n}\n\n// Returns true if there is a collision and false otherwise\nexport function detectCollisionWithAlien(ship, shipSprite, alien) {\n  if (ship === alien) {\n    return false;\n  }\n  const shield = getActiveShield(ship);\n  if (shield) {\n    // shield collision is round\n    return utils.distanceBetween(ship.x, ship.y, alien.x, alien.y) < (alien.radius + shield.radius);\n  }\n  let collisionPoints = utils.getVertexData(ship.x, ship.y, shipSprite);\n  for (let point of collisionPoints) {\n    // Only works with circular aliens (need different logic for squares)\n    if (alien.radius) {\n      let dist = utils.distanceBetween(point[0], point[1], alien.x, alien.y);\n      if (dist < alien.radius - c.ALLOWED_OVERLAP) {\n        return true;\n      }\n    }\n  }\n  return false;\n}\n\n/**\n * Land the ship on the planet\n * NOTE: This will cause damage to the ship attempting to land (side-effects)\n */\nfunction landShip(ship, planet) {\n  // atan2 has parameters (y,x)\n  let planetDir = utils.normalizeRadian(Math.atan2(ship.y - planet.y, ship.x - planet.x));\n  let dirDiff = Math.abs(ship.rotation - planetDir);\n  let speed = Math.abs(ship.vx) + Math.abs(ship.vy);\n  // 0 and PI*2 are right beside each other, so large values are very close to small values\n  let success = ((dirDiff < ship.crashAngle) || (dirDiff > (Math.PI * 2 - ship.crashAngle))) &&\n                (speed < ship.crashSpeed);\n  const hasAutolander = !!getEquip(ship, c.EQUIP_TYPE_AUTOLANDER);\n  // Stop moving\n  ship.vx = 0;\n  ship.vy = 0;\n  if (!success && !hasAutolander) {\n    // The landing was rough - do damage\n    let speedDiff = Math.max(speed - ship.crashSpeed, 0); // 0 if negative\n    let dirDiffAdj = Math.max(dirDiff - ship.crashAngle, 0); // 0 if negative\n    if (dirDiffAdj > Math.PI) {\n      dirDiffAdj = (Math.PI * 2) - dirDiff - ship.crashAngle;\n    }\n    let dmgPct = (speedDiff / 3) + dirDiffAdj;\n    let dmg = dmgPct * ship.armorMax;\n    damageShip(ship, dmg, resetGame);\n  }\n  // Disable shields when landing\n  const shield = getActiveShield(ship);\n  if (shield) {\n    disableShield(ship, shield);\n  }\n  // If the ship survived the landing\n  if (ship.armor > 0) {\n    window.world.selectedPlanet = planet; // currently selected planet (for manage UI)\n    window.world.lastPlanetLanded = planet; // last planet landed on\n    //Set ship position and angle on the planet surface\n    let dir = utils.directionTo(planet.x, planet.y, ship.x, ship.y)\n    let r = planet.radius + ship.spriteWidth / 2;\n    let {xAmt, yAmt} = utils.dirComponents(dir, r);\n    ship.x = planet.x + xAmt;\n    ship.y = planet.y + yAmt;\n    ship.rotation = dir;\n    planet.lastLandingDir = dir;\n    game.getShipSprite(ship).rotation = dir;\n    repositionScreen();\n    game.changeGameState(c.GAME_STATE.MANAGE);\n  }\n}\n\nexport function getExplosionSprite(ship) {\n  let sprite = null;\n  for (let explosionSprite of window.world.system.explosions) {\n    if (!explosionSprite.visible) {\n      sprite = explosionSprite;\n      break;\n    }\n  }\n  if (!sprite) {\n    sprite = game.createExplosionSprite();\n  }\n  let playerShip = window.world.ship;\n  sprite.visible = true;\n  sprite.globalX = ship.x;\n  sprite.globalY = ship.y;\n  sprite.x = (ship.x - playerShip.x) + c.HALF_SCREEN_WIDTH;\n  sprite.y = (ship.y - playerShip.y) + c.HALF_SCREEN_HEIGHT;\n  return sprite\n}\n\n/**\n * Destroys the ship playing an explosion animation\n * @param ship: the one to explode\n * @param afterExplosion: function to run after exploding (or null if nothing to do)\n */\nexport function destroyShip(ship, afterExplosion) {\n  if (ship.owner === c.ALIEN) {\n    game.addAlienXp(ship);\n  }\n  let explosionSprite = getExplosionSprite(ship);\n  const shipSprite = game.getShipSprite(ship);\n  shipSprite.visible = false;\n  ship.alive = false;\n  ship.spriteId = null;\n  explosionSprite.play();\n  // This function runs after the animation finishes a loop\n  explosionSprite.onLoop = () => {\n    explosionSprite.stop(); // pause until we crash again\n    explosionSprite.visible = false;\n    if (afterExplosion) {\n      afterExplosion();\n    }\n  };\n}\n\nfunction resetGame() {\n  // loadNewShip will setup a new ship but not position it\n  let ship = window.world.ship;\n  let planet = window.world.selectedPlanet;\n  // The current ship is gone\n  ship.resourcesMax = 0;\n  ship.resources = {titanium: 0, gold: 0, uranium: 0};\n  ship.equip = [];\n  ship.armorMax = 0;\n  ship.armor = 0;\n\n  // If the most recently used planet doesn't have any buildings\n  if (!planet || (planet.buildings.length === 0)) {\n    // find a planet with a mine\n    for (let planet of window.world.planets) {\n      if (planet.buildings.length > 0) {\n        window.world.selectedPlanet = planet;\n        break;\n      }\n    }\n    // No buildings on any planet- game over! \n    if (!planet) {\n      window.world.selectedPlanet = window.world.planets[0];\n    }\n  }\n  let {x, y, rotation} = manage.getAvailablePlanetXY(planet, ship, planet.lastLandingDir, 20, 0);\n  ship.x = x;\n  ship.y = y;\n  ship.vx = 0;\n  ship.vy = 0;\n  ship.rotation = rotation;\n  repositionScreen();\n  game.changeGameState(c.GAME_STATE.MANAGE);\n}\n\n/**\n * Explosion position update on screen as ship moves\n * This is called in the fly loop\n */\nfunction moveExplosions() {\n  let ship = window.world.ship;\n  for (let sprite of window.world.system.explosions) {\n    sprite.x = (sprite.globalX - ship.x) + c.HALF_SCREEN_WIDTH;\n    sprite.y = (sprite.globalY - ship.y) + c.HALF_SCREEN_HEIGHT;\n  }\n}\n\nfunction turnShip(ship, left) {\n  let turnSpeed = ship.turnSpeed;\n  let turnBooster = getEquip(ship, c.EQUIP_TYPE_TURN);\n  if (turnBooster) {\n    turnSpeed += turnBooster.boostSpeed;\n  }\n  ship.rotation = utils.normalizeRadian(ship.rotation + turnSpeed * (left ? -1 : 1));\n}\n\nfunction propelShip(ship) {\n  let propulsion = ship.propulsion;\n  let booster = getEquip(ship, c.EQUIP_TYPE_SPEED);\n  if (booster) {\n    propulsion += booster.boostSpeed;\n  }\n  ship.vx += propulsion * Math.cos(ship.rotation);\n  ship.vy += propulsion * Math.sin(ship.rotation);\n}\n\nfunction brakeShip(ship) {\n  let brake = getEquip(ship, c.EQUIP_TYPE_BRAKE);\n  if (brake) {\n    if (brake.brakeSpeedPct > 0) {\n      ship.vx -= ship.vx * brake.brakeSpeedPct;\n      ship.vy -= ship.vy * brake.brakeSpeedPct;\n    } else {\n      // Blink brake pct is 0, immediate stop (no momentum)\n      ship.vx = 0;\n      ship.vy = 0;\n    }\n  }\n}\n\nfunction thrustShip(ship, left) {\n  let thruster = getEquip(ship, c.EQUIP_TYPE_THRUSTER);\n  if (thruster) {\n    let dir = utils.normalizeRadian(ship.rotation + ((left ? -1 : 1) * Math.PI / 2)); // 90 deg turn\n    const thrustX = thruster.thrustSpeed * Math.cos(dir);\n    const thrustY = thruster.thrustSpeed * Math.sin(dir);\n    if (thruster.thrustType === c.THRUST_MOMENTUM) {\n      ship.vx += thrustX;\n      ship.vy += thrustY\n    } else if (thruster.thrustType === c.THRUST_BLINK) {\n      ship.x += thrustX;\n      ship.y += thrustY;\n    } else {\n      console.warn(\"Unable to use thruster with type \" + thruster.thrustType);\n    }\n  }\n}\n\n/**\n * Fires the weapon from the location and direction of the ship\n */\nexport function fireWeapon(weapon, ship, jitter) {\n  if (weapon && (weapon.cool <= 0)) {\n    fireBullet(ship, weapon, jitter);\n    weapon.cool = weapon.coolTime; // this is decremented in coolWeapons\n  }\n}\n\nexport function firePrimaryWeapon(ship, jitter) {\n  let gun = getEquip(ship, c.EQUIP_TYPE_PRIMARY_WEAPON);\n  if (gun) {\n    fireWeapon(gun, ship, gun.jitter ? gun.jitter : jitter);\n  }\n}\n\nexport function getSecondaryWeapon(ship) {\n  if (!ship.selectedSecondaryWeaponIndex || ship.selectedSecondaryWeaponIndex < 0) {\n    // Just find any secondary weapon - none was selected\n    return getEquip(ship, c.EQUIP_TYPE_SECONDARY_WEAPON);\n  }\n  // Find the equipped weapon\n  const equip = ship.equip[ship.selectedSecondaryWeaponIndex];\n  if (equip.type !== c.EQUIP_TYPE_SECONDARY_WEAPON) {\n    manage.selectFirstSecondaryWeapon(ship);\n    return getEquip(ship, c.EQUIP_TYPE_SECONDARY_WEAPON);\n  }\n  return equip;\n}\n\nexport function fireSecondaryWeapon(ship) {\n  let weapon = getSecondaryWeapon(ship);\n  if (weapon && (weapon.cool <= 0)) {\n    if (weapon.createShip) {\n      if (!game.canAfford(null, ship, weapon.createShip.type.cost)) {\n        // We don't fire the weapon - we can't afford it\n        return;\n      }\n      game.payResourceCost(null, ship, weapon.createShip.type.cost);\n      const child = game.createShip(weapon.createShip.type, ship.owner);\n      const childSprite = game.getShipSprite(child);\n      const shipRadius = ship.spriteWidth || (ship.radius * 2);\n      const childDistFromShip = (shipRadius / 2) + (child.spriteWidth / 2) + 20;\n      const dir = weapon.createShip.dir === c.DIR_AHEAD_OF_SHIP ? utils.normalizeRadian(ship.rotation - Math.PI) : ship.rotation;\n      const {xAmt, yAmt} = utils.dirComponents(dir, childDistFromShip);\n      child.x = ship.x - xAmt;\n      child.y = ship.y - yAmt;\n      if (child.propulsion) {\n        child.vx = ship.vx;\n        child.vy = ship.vy;\n      }\n      child.rotation = utils.normalizeRadian(dir - Math.PI);\n      childSprite.x = (child.x - window.world.ship.x) + c.HALF_SCREEN_WIDTH;\n      childSprite.y = (child.y - window.world.ship.y) + c.HALF_SCREEN_HEIGHT;\n      childSprite.visible = true;\n      window.world.ships.push(child);\n      // Since it may not move we need to check if it collides with anything\n      ai.checkForCollisionWithPlanet(child);\n      ai.checkForCollisionWithShip(child);\n    }\n    if (weapon.shield) {\n      // If another shield is already in use - we won't reset the cool\n      if (getActiveShield(ship) !== null) {\n        return;\n      }\n      enableShield(ship, weapon.shield);\n    }\n    weapon.cool = weapon.coolTime; // this is decremented in coolWeapons\n  }\n}\n\n/**\n * Called to enable a ship's shield.\n * This will add a shield sprite to the ship and set it to visible\n */\nexport function enableShield(ship, shield) {\n  if (getActiveShield(ship) !== null) {\n    console.log('not enabling shield, as there is already one enabled')\n    return;\n  }\n  const shieldSprite = game.getShieldSprite(ship, shield);\n  shieldSprite.visible = true;\n  shield.active = true;\n  shield.lifetime = shield.lifetimeMax;\n  shield.armor = shield.armorMax;\n  // Increase the ship size to the size of the shield\n  ship.spriteWidth = shield.radius * 2;\n  ship.spriteHeight = shield.radius * 2;\n}\n\n/**\n * Called to disable, and stop drawing a shield on a ship\n */\nexport function disableShield(ship, shield) {\n  const shieldSprite = game.getShieldSprite(ship, shield);\n  shieldSprite.visible = false;\n  shield.active = false;\n  // Reset the ship size back to regular\n  const shipSprite = game.getShipSprite(ship);\n  ship.spriteWidth = shipSprite.width;\n  ship.spriteHeight = shipSprite.height;\n}\n\n/**\n * Fires a bullet from the ship\n */\nexport function fireBullet(ship, gun, jitter) {\n  let bullet = findOrCreateBullet(gun.bulletFile);\n  bullet.lifetime = gun.lifetime;\n  bullet.damage = gun.damage;\n  const jitterAmt = jitter ? (jitter * Math.random() * (utils.randomBool() ? -1 : 1)) : 0;\n  const rotation = ship.rotation + jitterAmt;\n  bullet.vx = ship.vx + gun.speed * Math.cos(rotation);\n  bullet.vy = ship.vy + gun.speed * Math.sin(rotation);\n  bullet.x = ship.x + Math.sqrt(ship.spriteWidth * ship.spriteWidth + ship.spriteHeight * ship.spriteHeight) / 2 * Math.cos(rotation);\n  bullet.y = ship.y + Math.sqrt(ship.spriteWidth * ship.spriteWidth + ship.spriteHeight * ship.spriteHeight) / 2 * Math.sin(rotation);\n}\n\n/**\n * Gets the next available bullet (one that is not visible)\n */\nfunction findOrCreateBullet(bulletFile) {\n  for (let bullet of window.world.system.bullets) {\n    if (!bullet.active && (bullet.fileName === bulletFile)) {\n      bullet.active = true;\n      bullet.sprite.visible = true;\n      return bullet;\n    }\n  }\n  // Create a new bullet\n  let bullet = {active: true, damage: 0, x: 0, y: 0, vx: 0, vy: 0, lifetime: 1, fileName: bulletFile};\n  // Setup sprite\n  let spritesheet = window.PIXI.loader.resources[c.SPRITESHEET_JSON];\n  let sprite = new window.PIXI.Sprite(spritesheet.textures[bulletFile]);\n  sprite.x = -100;\n  sprite.y = -100;\n  sprite.anchor.set(0.5, 0.5);\n  sprite.scale.set(0.5, 0.5);\n  window.world.system.spriteContainers.bullets.addChild(sprite);\n  bullet.sprite = sprite;\n  window.world.system.bullets.push(bullet);\n  return bullet;\n}\n\nfunction killBullet(bullet) {\n  bullet.active = false;\n  bullet.sprite.visible = false;\n  bullet.sprite.x = -100;\n  bullet.sprite.y = -100;\n  bullet.vx = 0;\n  bullet.vy = 0;\n}\n\n/**\n * Moves all the bullets (called every draw cycle from app.js mainLoop)\n */\nexport function moveBullets() {\n  let ship = window.world.ship;\n  for (let bullet of window.world.system.bullets) {\n    if (bullet.active) {\n      bullet.x = bullet.x + bullet.vx;\n      bullet.y = bullet.y + bullet.vy;\n      bullet.sprite.x = (bullet.x - ship.x) + c.HALF_SCREEN_WIDTH;\n      bullet.sprite.y = (bullet.y - ship.y) + c.HALF_SCREEN_HEIGHT;\n      bullet.lifetime = bullet.lifetime - 1;\n      if (bullet.lifetime <= 0) {\n        killBullet(bullet);\n      }\n      checkForBulletCollision(bullet);\n    }\n  } // for bullet\n}\n\nfunction checkForBulletCollision(bullet) {\n  let ship = window.world.ship;\n  // Collision with planet\n  for (let planet of window.world.system.nearby.planets) {\n    if (utils.distanceBetween(planet.x, planet.y, bullet.x, bullet.y) < planet.radius) {\n      killBullet(bullet);\n    }\n  }\n  // Collision with ship\n  if (ship.alive &&\n      // Initial check to see if the bullet is anywhere near the ship (before we do more expensive collision checks))\n      (bullet.x < ship.x + ship.radius*2) &&\n      (bullet.x > ship.x - ship.radius*2) &&\n      (bullet.y < ship.y + ship.radius*2) &&\n      (bullet.y > ship.y - ship.radius*2)\n      ) {\n    const shipSprite = game.getShipSprite(ship);\n    const bulletWillHitShip = utils.pointInSprite(ship.x, ship.y, shipSprite, bullet.x, bullet.y);\n    let shield = getActiveShield(ship);\n    if (!shield && hasShieldDroid(ship)) {\n      const shieldEquip = getAvailableShieldEquip(ship);\n      if (shieldEquip && bulletWillHitShip) {\n        shieldEquip.cool = shieldEquip.coolTime;\n        enableShield(ship, shieldEquip.shield);\n        shield = shieldEquip.shield;\n      }\n    }\n    if (shield && utils.distanceBetween(ship.x, ship.y, bullet.x, bullet.y) < shield.radius) {\n      bulletHitShip(bullet, ship, resetGame);\n    } else if (bulletWillHitShip) {\n      bulletHitShip(bullet, ship, resetGame);\n    }\n  }\n  // Collision with alien ship\n  for (let alien of window.world.system.nearby.ships) {\n    if ((alien !== ship) && alien.alive && alien.radius &&\n      // Initial check to see if the bullet is anywhere near the alien (before we do more expensive collision checks))\n      (bullet.x < alien.x + alien.radius+10) &&\n      (bullet.x > alien.x - alien.radius+10) &&\n      (bullet.y < alien.y + alien.radius+10) &&\n      (bullet.y > alien.y - alien.radius+10)\n    ) {\n      const shield = getActiveShield(alien);\n      if ((shield && utils.distanceBetween(alien.x, alien.y, bullet.x, bullet.y) < shield.radius) || // hit alien shield\n        (utils.distanceBetween(alien.x, alien.y, bullet.x, bullet.y) <= alien.radius)) { // hit alien ship\n        bulletHitShip(bullet, alien, null);\n      }\n    }\n  } // for alien\n}\n\n/**\n * Apply damage from bullet to ship, also kills the bullet\n */\nfunction bulletHitShip(bullet, ship, afterExplosion) {\n  damageShip(ship, bullet.damage, afterExplosion);\n  killBullet(bullet);\n}\n\n/**\n * applies damage to the ship, destroying the ship if needed\n */\nexport function damageShip(ship, damage, afterExplosion) {\n  const shield = getActiveShield(ship);\n  if (shield) {\n    shield.armor -= damage;\n    if (shield.armor <= 0) {\n      shield.armor = 0;\n      disableShield(ship, shield);\n    }\n  } else { // no shield\n    ship.armor = ship.armor - damage;\n    if (ship.armor <= 0) {\n      ship.armor = 0;\n      destroyShip(ship, afterExplosion);\n    }\n  }\n}\n\n/**\n * collision between player ship and alien (sometimes alien and alien)\n */\nexport function shipsCollide(ship, alien) {\n  if (ship === alien) {\n    return; // can't collide with yourself\n  }\n  let shipDamage = ship.armor;\n  let alienDamage = alien.armor;\n  damageShip(alien, shipDamage, (window.world.ship === alien) ? resetGame : null);\n  damageShip(ship, alienDamage, (window.world.ship === ship) ? resetGame : null);\n  // If you died hitting an alien, stop moving\n  if (!ship.alive) {\n    ship.vx = 0;\n    ship.vy = 0;\n  }\n}\n\n/**\n * @return matching acc equipment type if it is found, null otherwise\n */\nexport function getEquip(ship, equipType) {\n  for (let equip of ship.equip) {\n    if (equip.type === equipType) {\n      return equip;\n    }\n  }\n  return null;\n}\n\nexport function drawMiniMap() {\n  let g = window.world.system.miniMapGraphics;\n  let view = window.world.view;\n  let l = 0;\n  let t = c.SCREEN_HEIGHT - c.MINIMAP_HEIGHT;\n  let r = c.MINIMAP_WIDTH;\n  let b = c.SCREEN_HEIGHT;\n  g.clear();\n  // Background\n  g.beginFill(c.MINIMAP_BACKGROUND_COLOR);\n  g.lineStyle(1, c.MINIMAP_BORDER_COLOR);\n  g.drawRect(l, t, r, b);\n  g.endFill();\n  // Planets\n  for (let planet of window.world.planets) {\n    if (planetOnMap(view, planet)) {\n      let x = l + c.HALF_MINIMAP_WIDTH + ((planet.x - view.x) * c.MINIMAP_SCALE_X);\n      let y = t + c.HALF_MINIMAP_HEIGHT + ((planet.y - view.y) * c.MINIMAP_SCALE_Y);\n      const planetColor = window.world.selectedPlanet === planet ? c.MINIMAP_SELECTED_PLANET_COLOR : c.MINIMAP_PLANET_COLOR;\n      g.lineStyle(2, planetColor);\n      g.drawCircle(x, y, planet.radius * c.MINIMAP_SCALE_X);\n      // Buildings\n      for (let building of planet.buildings) {\n        let buildingX = l + c.HALF_MINIMAP_WIDTH + ((building.x - view.x) * c.MINIMAP_SCALE_X) - 1.5;\n        let buildingY = t + c.HALF_MINIMAP_HEIGHT + ((building.y - view.y) * c.MINIMAP_SCALE_Y) - 1.5;\n        g.lineStyle(1, c.MINIMAP_BUILDING_COLOR);\n        g.drawRect(buildingX, buildingY, 2, 2);\n      }\n    }\n  }\n  // Ship\n  g.lineStyle(1, c.MINIMAP_SHIP_COLOR);\n  const x = l + c.HALF_MINIMAP_WIDTH + ((window.world.ship.x - view.x) * c.MINIMAP_SCALE_X);\n  const y = t + c.HALF_MINIMAP_HEIGHT + ((window.world.ship.y - view.y) * c.MINIMAP_SCALE_Y);\n  g.drawCircle(x, y, 2);\n}\n\n/**\n * Handles clicks on the minimap\n */\nexport function clickOnMinimap(clickX, clickY) {\n  if (window.world.system.gameState === c.GAME_STATE.MANAGE) {\n    const view = window.world.view\n    let globalX = view.x + ((clickX - c.HALF_MINIMAP_WIDTH) * (1 / c.MINIMAP_SCALE_X));\n    let globalY = view.y + (((clickY - (c.SCREEN_HEIGHT - c.MINIMAP_HEIGHT)) - c.HALF_MINIMAP_HEIGHT) * (1 / c.MINIMAP_SCALE_X));\n    for (let planet of window.world.planets) {\n      if (utils.distanceBetween(globalX, globalY, planet.x, planet.y) <= planet.radius) {\n        window.world.selectedPlanet = planet;\n      }\n    }\n    view.x = globalX;\n    view.y = globalY;\n    drawMiniMap();\n  }\n}\n\nfunction planetOnMap(view, planet) {\n  // Right side\n  return !((view.x + c.HALF_MINIMAP_VIEW_WIDTH + planet.radius < planet.x) || // Right\n    (view.x - c.HALF_MINIMAP_VIEW_WIDTH - planet.radius > planet.x) || // Left\n    (view.y + c.HALF_MINIMAP_VIEW_HEIGHT + planet.radius < planet.y) || // Bottom\n    (view.y - c.HALF_MINIMAP_VIEW_HEIGHT - planet.radius > planet.y));\n}\n\n/**\n * @return the max range of the weapon\n */\nexport function weaponRange(weapon) {\n  if (!weapon) {\n    return 0;\n  }\n  // Not sure what the fudge factor is, but the range seems a little short without it\n  return weapon.speed * weapon.lifetime * 1.4;\n}\n\n/**\n * @return the max range of the primary weapon on the ship\n */\nexport function primaryWeaponRange(ship) {\n  let gun = getEquip(ship, c.EQUIP_TYPE_PRIMARY_WEAPON);\n  return weaponRange(gun);\n}","import { c, utils, fly, game } from './';\nimport lodash from 'lodash';\nimport {EQUIP_TYPE_BRAKE, EQUIP_TYPE_PRIMARY_WEAPON, EQUIP_TYPE_THRUSTER} from \"./constants\";\n\nexport function enterManageState() {\n  console.log(\"enter manage state\");\n}\n\n// When managing planet resources - loop runs 60/s\nexport function manageLoop(delta) {\n  if ((window.world.system.keys.up.isDown || window.world.system.keys.w.isDown)) {\n    if (window.world.ship.alive && !window.world.system.isTyping) {\n      takeOff();\n    }\n  }\n}\n\nfunction takeOff() {\n  let world = window.world;\n  let ship = world.ship;\n  game.changeGameState(c.GAME_STATE.FLY);\n  let gravity = utils.calcGravity(ship.x, ship.y, world.selectedPlanet);\n  ship.vx = gravity.x * -c.TAKEOFF_SPEED;\n  ship.vy = gravity.y * -c.TAKEOFF_SPEED;\n}\n\n/**\n * @return Correct set of constants for the building type.\n * Maybe these constants could be moved into a variable or something\n */\nfunction getBuildingInfo(buildingType) {\n  if (buildingType === c.BUILDING_TYPE_FACTORY) {\n    return {spriteScale:c.FACTORY_SCALE, spriteFile:c.FACTORY_FILE, animation:false};\n  } else if (buildingType === c.BUILDING_TYPE_MINE) {\n    return {spriteScale:c.MINE_SCALE, spriteFile:c.MINE_FILE, animation:true};\n  }\n  console.warn('Unknown building type ', buildingType);\n  return {}\n}\n\n/**\n * Creates a factory sprite and adds it to the planet container using the factory x,y and rotation\n * NOTE: The building x,y,rot need to be set before calling this\n * @param building building to build\n * @param planet planet to build on\n * @param planetSprite optional, if null this will lookup the sprite using getPlanetSprite()\n */\nexport function makeBuildingSprite(building, planet, planetSprite = null) {\n  const { spriteScale, spriteFile, animation } = getBuildingInfo(building.type);\n  let spritesheet = window.PIXI.Loader.shared.resources[c.SPRITESHEET_JSON].spritesheet;\n  let buildingSprite;\n  if (animation) {\n    buildingSprite = new window.PIXI.AnimatedSprite(spritesheet.animations[spriteFile]);\n    buildingSprite.animationSpeed = c.MINE_ANIMATION_SPEED;\n    buildingSprite.play();\n  } else {\n    buildingSprite = new window.PIXI.Sprite(spritesheet.textures[spriteFile]);\n  }\n  buildingSprite.anchor.set(0.5, 0.5);\n  buildingSprite.scale.set(spriteScale, spriteScale);\n  buildingSprite.rotation = building.rotation;\n  buildingSprite.x = (building.x - planet.x);\n  buildingSprite.y = (building.y - planet.y);\n  buildingSprite.visible = true;\n  if (!planetSprite) {\n    planetSprite = game.getPlanetSprite(planet);\n  }\n  planetSprite.addChild(buildingSprite);\n}\n\nexport function buildMine() {\n  let world = window.world;\n  let mine = {type: c.BUILDING_TYPE_MINE};\n  let planet = world.selectedPlanet;\n  let ship = world.ship;\n  // Place the mine (to the right of the ship)\n  const initRotation = getBuildingPlacementRotation(ship, planet, c.MINE_WIDTH);\n  // Calculate an X,Y point near the ship on surface of the planet\n  // NOTE: we use sprite.height for width because all sprites face to the right (0 rotation)\n  let {x,y,rotation} = getAvailablePlanetXY(planet, ship, initRotation, c.MINE_WIDTH, 0);\n  if (x === null) {\n    console.warn(\"Unable to place mine\");\n    return;\n  }\n  mine.width = c.MINE_WIDTH;\n  mine.x = x;\n  mine.y = y;\n  mine.rotation = rotation;\n  // Setup the graphics\n  makeBuildingSprite(mine, planet);\n  game.payResourceCost(planet, ship, c.MINE_COST);\n  planet.buildings.push(mine);\n  fly.drawMiniMap(); // add building to minimap\n}\n\n/**\n * @return the rotation direction of a place some distance to the right of the ship\n */\nexport function getBuildingPlacementRotation(ship, planet, distanceFromShip) {\n  let deg = ship.rotation + Math.PI/2; // 90 deg (right of the ship)\n  let degX = ship.x + distanceFromShip  * Math.cos(deg); // Some point Xpx to the right of the ship\n  let degY = ship.y + distanceFromShip * Math.sin(deg);\n  // Calculate the rotation direction to get to that point\n  return utils.normalizeRadian(Math.atan2(degY - planet.y, degX - planet.x));\n\n}\n\n/**\n * @return {x,y} for the next free space to the right of the ship on the planet circumfrence \n */\nexport function getAvailablePlanetXY(planet, ship, rotation, buildingWidth, count) {\n  if (buildingFits(planet, ship, rotation, buildingWidth)) {\n    let x = planet.x + ((planet.radius + 10) * Math.cos(rotation));\n    let y = planet.y + ((planet.radius + 10) * Math.sin(rotation));\n    return {x,y, rotation};\n  }\n  // If we have done a full circle then give up\n  if (count > (Math.PI*2 / c.BUILDING_PLACEMENT_ROTATION_INCREMENT)) {\n    return {x:null, y:null, rotation:null};\n  }\n  return getAvailablePlanetXY(planet, ship, rotation+c.BUILDING_PLACEMENT_ROTATION_INCREMENT\n    , buildingWidth, ++count);\n}\n\nexport function buildingFits(planet, ship, rotation, buildingWidth) {\n  let x = planet.x + ((planet.radius + 10) * Math.cos(rotation));\n  let y = planet.y + ((planet.radius + 10) * Math.sin(rotation));\n  // Min distance to building\n  let minDist = utils.distanceBetween(x,y, ship.x, ship.y);\n  let minBuildingWidth = buildingWidth;\n  for (let building of planet.buildings) {\n     let dist = utils.distanceBetween(x,y, building.x, building.y);\n     if (dist < minDist) {\n       minDist = dist;\n       minBuildingWidth = building.width;\n     }\n  } \n  return (minDist > (buildingWidth/2 + minBuildingWidth/2 + 15));\n}\n\n/**\n * Move a resource ship <-> planet \n */\nexport function transferResource(source, target, resourceType, requestedAmtStr, maxCapacity) {\n  let requestedAmt = Number(requestedAmtStr);\n  if (isNaN(requestedAmt)) {\n    requestedAmt = 0;\n  }\n  let amt = requestedAmt;\n  // requesting '' is requesting the entire source (same as requesting too much)\n  if (requestedAmtStr === '' || (source[resourceType] - requestedAmt < 0)) {\n    amt = source[resourceType];\n  }\n  // Cap to max capacity of target\n  if (maxCapacity !== null) {\n    let spaceLeft = maxCapacity - (target.titanium + target.gold + target.uranium);\n    if (spaceLeft < amt) {\n      amt = spaceLeft;\n    }\n  }\n  target[resourceType] += amt;\n  source[resourceType] -= amt;\n}\n\n/**\n * Move all resources to the planet\n */\nexport function unloadShip(ship, planet) {\n  transferResource(ship.resources, planet.resources.stored, 'titanium', ship.resources.titanium, null);\n  transferResource(ship.resources, planet.resources.stored, 'gold', ship.resources.gold, null);\n  transferResource(ship.resources, planet.resources.stored, 'uranium', ship.resources.uranium, null);\n}\n\n/**\n * Choose some default resources to resupply the ship with.\n * This is for quick restocking of resources\n * NOTE: This may need to do multiple passes to fill up the space properly especially when planets are low on uranium\n */\nexport function resupplyShip(ship, planet) {\n  const desiredAmt = Math.floor(ship.resourcesMax / 3);\n  let freeAmt = ship.resourcesMax - (ship.resources.titanium + ship.resources.gold + ship.resources.uranium);\n  if (freeAmt <= 0) {\n    // no space for more resources\n    return;\n  }\n  // 20 is the min required to build a mine - you probably want at least 20\n  const desiredTitanium = desiredAmt >= 20 ? desiredAmt : 20;\n  if (ship.resources.titanium < desiredTitanium) {\n    transferResource(planet.resources.stored, ship.resources, 'titanium', desiredTitanium - ship.resources.titanium, ship.resourcesMax);\n  }\n  if (ship.resources.gold < desiredAmt) {\n    transferResource(planet.resources.stored, ship.resources, 'gold', desiredAmt - ship.resources.gold, ship.resourcesMax);\n  }\n  // Fill up the rest of the space with uranium (it's the rarest)\n  freeAmt = ship.resourcesMax - (ship.resources.titanium + ship.resources.gold + ship.resources.uranium);\n  if (ship.resources.uranium < freeAmt) {\n    transferResource(planet.resources.stored, ship.resources, 'uranium', freeAmt, ship.resourcesMax);\n  }\n}\n\nexport function buildFactory() {\n  let world = window.world;\n  let planet = world.selectedPlanet;\n  let ship = world.ship;\n  let factory = {type: c.BUILDING_TYPE_FACTORY};\n\n  // Place the mine (to the right of the ship)\n  const initialRotation = getBuildingPlacementRotation(ship, planet, c.FACTORY_WIDTH);\n  // Calculate an X,Y point near the ship on surface of the planet\n  // NOTE: we use sprite.height for width because all sprites face to the right (0 rotation)\n  let {x,y,rotation} = getAvailablePlanetXY(planet, ship, initialRotation, c.FACTORY_WIDTH, 0);\n  if (x === null) {\n    console.warn(\"Unable to place factory\");\n    return;\n  }\n  factory.width = c.MINE_WIDTH;\n  factory.x = x;\n  factory.y = y;\n  factory.rotation = rotation;\n  planet.buildings.push(factory);\n\n  // Setup the graphics\n  makeBuildingSprite(factory, planet);\n\n  game.payResourceCost(planet, ship, c.FACTORY_COST);\n  fly.drawMiniMap(); // add to minimap\n}\n\n/**\n * Called when the factory finishes building a new ship \n */\nexport function buildShip(shipTemplate) {\n  let world = window.world;\n  let planet = world.selectedPlanet;\n  let newShip = game.createShip(shipTemplate, c.PLAYER);\n  planet.ships.push(newShip);\n}\n\n/**\n * Called when the user clicks to switch to a new ship \n * NOTE: the new ship should already be created and stored in a planet\n */\nexport function switchToShip(newShip) {\n  let oldShip = window.world.ship;\n  let selectedPlanet = window.world.selectedPlanet;\n  let lastPlanetLanded = window.world.lastPlanetLanded;\n  if (!removeShipFromStorage(newShip, selectedPlanet)) {\n    console.warn(\"Unable to remove ship from planet \",newShip,\" planet=\",selectedPlanet);\n    return;\n  }\n  addShipToStorage(oldShip, lastPlanetLanded);\n\n  window.world.ship = newShip;\n  // check to ensure oldShip is not destroyed\n  if (oldShip && oldShip.alive && oldShip.spriteId) {\n    fly.resetWeaponsCool(oldShip);\n    const oldShipSprite = game.getShipSprite(oldShip);\n    oldShipSprite.visible = false;\n    oldShip.spriteId = null;\n  }\n  // Get the new sprite (adds it to the container)\n  const newShipSprite = game.getShipSprite(newShip);\n  newShipSprite.visible = true;\n  newShip.rotation = selectedPlanet.lastLandingDir;\n  newShipSprite.rotation = newShip.rotation;\n  newShipSprite.position.set(c.HALF_SCREEN_WIDTH, c.HALF_SCREEN_HEIGHT);\n\n  let r = selectedPlanet.radius + (newShip.spriteWidth / 2);\n  newShip.x = selectedPlanet.x + (r * Math.cos(newShip.rotation));\n  newShip.y = selectedPlanet.y + (r * Math.sin(newShip.rotation));\n  window.world.lastPlanetLanded = selectedPlanet;\n  fly.repositionScreen();\n}\n\n/**\n * Removes a ship from the planet, returns null if no matching ship was found\n */\nexport function removeShipFromStorage(ship, planet) {\n  let ships = planet.ships.filter((s) => s !== ship);\n  let removedShip = ships.length < planet.ships.length;\n  planet.ships = ships;\n  return removedShip;\n}\n\nexport function addShipToStorage(ship, planet) {\n  // If the ship is not visible (and armorMax is zero) it has been destroyed\n  // Some ships might be non-visible because they are not currently being used\n  if (ship.alive && ship.armorMax > 0) {\n    planet.ships.push(ship);\n  }\n}\n\n/**\n * @return true if the planet has a factory for the player\n */\nexport function hasFactory(planet) {\n  for (let building of planet.buildings) {\n    if (building.type === c.BUILDING_TYPE_FACTORY) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Create a new piece of equipment from the template\n */\nexport function makeEquip(equipTemplate) {\n  let equip = lodash.cloneDeep(equipTemplate);\n  equip.id = window.world.nextId++;\n  return equip;\n}\n\nexport function buildEquip(equipTemplate) {\n  let planet = window.world.selectedPlanet;\n  planet.equip.push(makeEquip(equipTemplate));\n}\n\nexport function costToRepair(ship) {\n  const damageToRepair = ship.armorMax - ship.armor;\n  return {titanium:(damageToRepair / 5), gold:0, uranium:0};\n}\n\nexport function repairShip(ship, planet) {\n  let cost = costToRepair(ship);\n  let addArmor = ship.armorMax - ship.armor; // armor needed\n  if (!game.canAfford(planet, ship, cost)) {\n    let titaniumOnHand = planet.resources.stored.titanium + ship.resources.titanium;\n    cost.titanium = titaniumOnHand;\n    addArmor = titaniumOnHand;\n  } \n  game.payResourceCost(planet, ship, cost);\n  ship.armor += addArmor;\n}\n\nexport function addEquip(ship, newEquip) {\n  if (newEquip.type === c.EQUIP_TYPE_ARMOR) {\n    // Only add armor if the ship is in full repair\n    if (ship.armor === ship.armorMax) {\n      ship.armor += newEquip.armorAmt;\n    }\n    ship.armorMax += newEquip.armorAmt;\n  } else if (newEquip.type === c.EQUIP_TYPE_STORAGE) {\n    ship.resourcesMax += newEquip.storageAmount;\n  }\n}\n\nexport function selectFirstSecondaryWeapon(ship) {\n  for (let i=0; i< ship.equip.length; i++) {\n    if (ship.equip[i].type === c.EQUIP_TYPE_SECONDARY_WEAPON) {\n      ship.selectedSecondaryWeaponIndex = i;\n      return;\n    }\n  } // for\n  // Couldn't find a secondary weapon\n  ship.selectedSecondaryWeaponIndex = -1;\n}\n\nexport function moveEquipFromPlanetToShip(ship, planet, equipToMove) {\n  // Remove from the planet\n  ship.equip.push(equipToMove);\n  addEquip(ship, equipToMove);\n  // Remove the oldEquip from the planet\n  lodash.remove(planet.equip, (e) => e.id === equipToMove.id);\n  selectFirstSecondaryWeapon(ship);\n}\n\nexport function moveEquipFromShipToPlanet(ship, planet, equipToMove) {\n  // Add to the planet\n  planet.equip.push(equipToMove);\n  if (equipToMove.type === c.EQUIP_TYPE_ARMOR) {\n    ship.armorMax -= equipToMove.armorAmt;\n    if (ship.armor > ship.armorMax) {\n      ship.armor = ship.armorMax;\n    }\n  } else if (equipToMove.type === c.EQUIP_TYPE_STORAGE) {\n    ship.resourcesMax -= equipToMove.storageAmount;\n    let shipResources = ship.resources.titanium + ship.resources.gold + ship.resources.uranium;\n    if (shipResources > ship.resourcesMax) {\n      let owing = this.removeResource(ship, 'titanium', (shipResources - ship.resourcesMax));\n      if (owing > 0) {\n        owing = this.removeResource(ship, 'gold', owing);\n      }\n      if (owing > 0) {\n        owing = this.removeResource(ship, 'uranium', owing);\n      }\n      if (owing > 0) {\n        console.warn(\"Cannot remove more resources from ship still owing \"+owing);\n      }\n    }\n  }\n  // Remove the oldEquip from the ship (no new equipment added)\n  lodash.remove(ship.equip, (e) => e.id === equipToMove.id);\n  selectFirstSecondaryWeapon(ship);\n}\n\n/**\n * Destroys unwanted equipment and recovers some material cost\n * @param planet location resources will be added to\n * @param equip to destroy\n */\nexport function salvageEquip(planet, equip) {\n  planet.resources.stored['titanium'] += equip.cost.titanium * c.SALVAGE_RATE;\n  planet.resources.stored['gold'] += equip.cost.gold * c.SALVAGE_RATE;\n  planet.resources.stored['uranium'] += equip.cost.uranium * c.SALVAGE_RATE;\n  // Remove the equip from the planet\n  lodash.remove(planet.equip, (e) => e.id === equip.id);\n}\n\n/**\n * Destroys unwanted ships and recovers some material cost\n * @param planet location resources will be added to\n * @param ship to destroy\n */\nexport function salvageShip(planet, ship) {\n  // First salvage all equipment on the ship\n  for (const equip of ship.equip) {\n    salvageEquip(planet, equip);\n  }\n  // Salvage the ship itself\n  planet.resources.stored['titanium'] += ship.cost.titanium * c.SALVAGE_RATE;\n  planet.resources.stored['gold'] += ship.cost.gold * c.SALVAGE_RATE;\n  planet.resources.stored['uranium'] += ship.cost.uranium * c.SALVAGE_RATE;\n  removeShipFromStorage(ship, planet);\n  // If ship is currently being used - stop using it!\n  if (ship === window.world.ship) {\n    const shipSprite = game.getShipSprite(ship);\n    shipSprite.visible = false;\n    ship.alive = false;\n    ship.spriteId = null;\n  }\n}\n\n\n/**\n * Removes the resource from the ship\n * @return the amount still owing after removing\n */\nexport function removeResource(ship, resourceType, amount) {\n  ship.resources[resourceType] -= amount;\n  if (ship.resources[resourceType] < 0) {\n    let owing = Math.abs(ship.resources[resourceType]);\n    ship.resources[resourceType] = 0;\n    return owing;\n  }\n  return 0;\n}\n\n/**\n * @return true if the equip can be added to the ship\n */\nexport function canEquip(ship, equip) {\n  if (!ship || !ship.equip || !equip) {\n    return false;\n  }\n  // No more space\n  if (ship.equip.length >= ship.equipMax) {\n    return false;\n  }\n  // Some equip you can only have one\n  if ([EQUIP_TYPE_BRAKE, EQUIP_TYPE_PRIMARY_WEAPON, EQUIP_TYPE_THRUSTER].includes(equip.type)) {\n    if (ship.equip.find((eq) => eq.type === equip.type)) {\n      return false;\n    }\n  }\n  return true;\n}\n\n","import {c, fly, utils} from './';\nimport {getShipSprite} from \"./game\";\n\nexport function moveAliens() {\n  let ship = window.world.ship;\n  for (let alien of window.world.system.nearby.ships) {\n    if (!alien.alive || ship === alien) {\n      continue;\n    }\n    let hasMoved = false;\n    if (alien.aiType === c.ALIEN_AI_CREEPER) {\n      hasMoved = creeperAi(alien, false);\n    } else if (alien.aiType === c.ALIEN_AI_KAMIKAZI) {\n      hasMoved = creeperAi(alien, true);\n    } else if (alien.aiType === c.EQUIP_AI_TURRET) {\n      hasMoved = turretAi(alien, 0.7);\n    } else if (alien.aiType === c.ALIEN_AI_TURRET) {\n      hasMoved = turretAi(alien, 0.25);\n    } else if (alien.aiType === c.EQUIP_AI_MISSILE) {\n      hasMoved = missileAi(alien);\n    } else if (alien.aiType === c.ALIEN_AI_MOTHERSHIP) {\n      mothershipAi(alien);\n    }\n    if (hasMoved) {\n      checkForCollisionWithPlanet(alien);\n      checkForCollisionWithShip(alien);\n    }\n\n    // If alien is in the viewport\n    if ((ship.x + c.HALF_SCREEN_WIDTH + alien.radius >= alien.x) && // Right\n      (ship.x - c.HALF_SCREEN_WIDTH - alien.radius <= alien.x) && // Left\n      (ship.y + c.HALF_SCREEN_HEIGHT + alien.radius >= alien.y) && // Bottom\n      (ship.y - c.HALF_SCREEN_HEIGHT - alien.radius <= alien.y)) { // Top\n      // alien may have died in a collision\n      if (alien.alive) {\n        // Set alien ship relative to the ship's viewport\n        const alienSprite = getShipSprite(alien);\n        alienSprite.visible = true;\n        alienSprite.rotation = alien.rotation;\n        alienSprite.x = (alien.x - ship.x) + c.HALF_SCREEN_WIDTH;\n        alienSprite.y = (alien.y - ship.y) + c.HALF_SCREEN_HEIGHT;\n      }\n    } else { // alien is not in view\n      // Release the sprite if the alien is not in the view\n      if (alien.spriteId) {\n        const alienSprite = getShipSprite(alien);\n        alienSprite.visible = false;\n        alien.spriteId = null;\n      }\n    }\n  } // for alien\n}\n\n/**\n * Fire primary weapon in the direction of x,y\n * @ship ship with gun to fire\n * @x/y  the location to aim at\n * @jitter amount (in radians) of randomness added to direction component\n *         0 - shoots directly at player\n *         PI - shoot completely randomly\n */\nexport function shootAt(shooter, x, y, jitter) {\n  shooter.rotation = utils.normalizeRadian(Math.atan2(y - shooter.y, x - shooter.x));\n  fly.firePrimaryWeapon(shooter, jitter);\n}\n\nexport function turretAi(turretShip, jitter) {\n  const {target, dist} = getNearestOpponentTarget(turretShip);\n  if (!target || !target.alive) {\n    return false;\n  }\n  if (dist < fly.primaryWeaponRange(turretShip)) {\n    shootAt(turretShip, target.x, target.y, jitter);\n  }\n  return false;\n}\n\nexport function mothershipAi(alien) {\n  let ship = window.world.ship;\n  if (!ship.alive) {\n    return;\n  }\n  const distanceToPlayer = utils.distanceBetween(alien.x, alien.y, ship.x, ship.y);\n  if (distanceToPlayer < fly.primaryWeaponRange(alien)) {\n    shootAt(alien, ship.x, ship.y, 0.3);\n  }\n  if (distanceToPlayer < c.SCREEN_WIDTH*3) {\n    fly.fireSecondaryWeapon(alien);\n  }\n  if (alien.armor < alien.armorMax) {\n    enableShieldIfNeeded(alien);\n  }\n}\n\n/**\n * Finds the nearest ship on the other team\n * @param ship ship to determine x,y and player\n */\nexport function getNearestOpponentTarget(ship) {\n  return (ship.owner === c.PLAYER)\n    ? getNearestAlienTarget(ship.x, ship.y, ship.id)\n    : getNearestPlayerTarget(ship.x, ship.y, ship.id);\n}\n\n/**\n * Finds the nearest ship on the same team\n * @param ship ship to determine x,y and player\n */\nexport function getNearestFriendlyTarget(ship) {\n  return (ship.owner === c.PLAYER)\n    ? getNearestPlayerTarget(ship.x, ship.y, ship.id)\n    : getNearestAlienTarget(ship.x, ship.y, ship.id);\n}\n\n/**\n * Simple AI for missiles - find nearest target and move toward it attempting to crash\n */\nexport function missileAi(missile) {\n  const {target, dist} = getNearestOpponentTarget(missile);\n  // Missiles don't track targets really far away\n  if (target && dist < c.SCREEN_WIDTH) {\n    let dirToTarget = utils.directionTo(missile.x, missile.y, target.x, target.y);\n    let {xAmt, yAmt} = utils.dirComponents(dirToTarget, missile.propulsion);\n    missile.vx += xAmt;\n    missile.vy += yAmt;\n    missile.x += missile.vx;\n    missile.y += missile.vy;\n    return true;\n  }\n  // Don't move if there's nobody to move towards\n  return false;\n}\n\n/**\n * AI for aliens that move toward the player and shoots\n * @return true if alien moved false otherwise\n */\nexport function creeperAi(alien, crashIntoPlayer=false) {\n  let ship = window.world.ship;\n  if (!ship.alive) {\n    return;\n  }\n  const viewRange = alien.viewRange || c.SCREEN_WIDTH;\n  let moved = false;\n  const {target:playerTarget, dist:distToOpponent} = getNearestOpponentTarget(alien);\n  if (!playerTarget) {\n    return;\n  }\n  if (distToOpponent < viewRange) {\n    let dirToTarget = utils.directionTo(alien.x, alien.y, playerTarget.x, playerTarget.y);\n    let {xAmt, yAmt} = utils.dirComponents(dirToTarget, 25 * alien.propulsion);\n    // Check if we are too close to a planet (need to move around the planet)\n    for (let planet of window.world.system.nearby.planets) {\n      if (utils.distanceBetween(alien.x + xAmt, alien.y + yAmt, planet.x, planet.y) < (planet.radius + alien.radius + 10)) {\n        const dirToPlanet = utils.directionTo(alien.x, alien.y, planet.x, planet.y);\n        let dirDiff = dirToPlanet - dirToTarget;\n        let rightLeft = (dirDiff >= 0) ? -1 : 1;\n        if (Math.abs(dirDiff) > Math.PI) {\n          rightLeft = rightLeft * -1;\n        }\n        const turnDir = dirToPlanet + (rightLeft * Math.PI / 2);\n        ({xAmt, yAmt} = utils.dirComponents(turnDir, 20 * alien.propulsion));\n      }\n    } // for planet\n    // Too close to player, don't move closer\n    if (!crashIntoPlayer && distToOpponent < (ship.spriteWidth + alien.radius + 20)) {\n      xAmt = 0;\n      yAmt = 0;\n    }\n    // Don't crash into friends\n    const {target: alienTarget, dist: alienDist} = getNearestFriendlyTarget(alien);\n    if (alienTarget && (alienDist < (alien.radius + alienTarget.radius + 10))) {\n      xAmt = 0;\n      yAmt = 0;\n    }\n    if (alien.armor < alien.armorMax) {\n      enableShieldIfNeeded(alien);\n    }\n    alien.x += xAmt;\n    alien.y += yAmt;\n    alien.rotation = dirToTarget;\n    moved = true;\n  }\n  if (distToOpponent < fly.primaryWeaponRange(alien)) {\n    shootAt(alien, playerTarget.x, playerTarget.y, 0.15);\n  }\n  return moved;\n}\n\n/**\n * Finds the nearest alien target to the x,y location\n * @shipId : any alien except the one with a matching shipId\n * returns {target:X, dist:Y }  x and y will be null if no living targets are found\n */\nexport function getNearestAlienTarget(x, y, shipId = 'none') {\n  let target = null;\n  let minDist = null;\n  for (let alien of window.world.system.nearby.ships) {\n    if (alien.alive && alien.owner === c.ALIEN && alien.id !== shipId) {\n      let dist = utils.distanceBetween(x, y, alien.x, alien.y);\n      if (!target || (dist < minDist)) {\n        target = alien;\n        minDist = dist;\n      }\n    }\n  } // for\n  return {target: target, dist: minDist};\n}\n\n/**\n * Finds the nearest player target to the x,y location\n * @shipId : any ship except the one matching shipId\n * returns {target:X, dist:Y }  x and y will be null if no living targets are found\n */\nexport function getNearestPlayerTarget(x, y, shipId='none') {\n  const ship = window.world.ship;\n  let target = ship;\n  let minDist = ship.id !== shipId ? utils.distanceBetween(x, y, ship.x, ship.y) : 99999999999;\n  for (let ship of window.world.system.nearby.ships) {\n    if (ship.alive && ship.owner === c.PLAYER && ship.id !== shipId) {\n      let dist = utils.distanceBetween(x, y, ship.x, ship.y);\n      if (!target || (dist < minDist)) {\n        target = ship;\n        minDist = dist;\n      }\n    }\n  } // for\n  return {target: target, dist: minDist};\n}\n\n\nexport function checkForCollisionWithPlanet(alien) {\n  for (let planet of window.world.system.nearby.planets) {\n    let dist = utils.distanceBetween(alien.x, alien.y, planet.x, planet.y);\n    if (dist <= (alien.radius + planet.radius)) {\n      fly.destroyShip(alien, null);\n    }\n  } // for\n}\n\nexport function checkForCollisionWithShip(ship) {\n  for (let otherShip of window.world.system.nearby.ships) {\n    if (otherShip.alive && ship !== otherShip) {\n      let dist = utils.distanceBetween(ship.x, ship.y, otherShip.x, otherShip.y);\n      if (dist <= (ship.radius + otherShip.radius)) {\n        fly.shipsCollide(ship, otherShip);\n        if (ship.name === c.SHIP_FRIENDSHIP_MISSILE.name && otherShip.owner !== ship.owner) {\n          otherShip.owner = ship.owner;\n        }\n      }\n    }\n  } // for\n}\n\nexport function enableShieldIfNeeded(ship) {\n  const shieldEquip = getShield(ship);\n  if (!shieldEquip || shieldEquip.cool > 0) {\n    return;\n  }\n  fly.enableShield(ship, shieldEquip.shield);\n  shieldEquip.cool = shieldEquip.coolTime;\n}\n\nexport function getShield(ship) {\n  for (let i = 0; i < ship.equip.length; i++) {\n    const equip = ship.equip[i];\n    if ((equip.type === c.EQUIP_TYPE_SECONDARY_WEAPON) && equip.shield) {\n      return equip;\n    }\n  } // for\n  return null;\n}","import {fly, game, utils} from './';\nimport lodash from 'lodash';\n\n// IndexedDB constants\nconst WORLD_STORE = 'world';\nconst DB_NAME = 'astrominer';\nconst DB_VERSION = 1;\n\n/** Saves an object in localstorage.\n * @param key key to store/retrieve\n * @param objToSave: should be an Object or Array, NOT a primitive as the JSON.parse will fail\n */\nexport function saveLocalStorage(key, objToSave) {\n  const existing = localStorage.getItem(key);\n  if (existing) {\n    localStorage.removeItem(key);\n  }\n  localStorage.setItem(key, JSON.stringify(objToSave));\n}\n\n/**\n *  Loads an object from localstorage.\n * NOTE: The item stored must be an Object or Array as primitives will fail the JSON.parse\n */\nexport function loadLocalStorage(key) {\n  if (!key) {\n    console.warn('Unable to from localStorage without a key');\n    return;\n  }\n  const objString = localStorage.getItem(key)\n  //console.log('loaded objString ='+objString);\n  if (!objString) {\n    return null;\n  }\n  return JSON.parse(objString);\n}\n\nfunction upgradeDB(event) {\n  let db = event.target.result;\n  if (event.oldVersion >= 1) {\n    db.deleteObjectStore(WORLD_STORE);\n  }\n  db.createObjectStore(WORLD_STORE, {keyPath: \"saveGameName\"});\n}\n\n/**\n * Start using a newWorld, the old world and it's state will be discarded.\n * param key:  storage key where the world is kept\n */\nexport function loadWorld(key) {\n  let dbRequest = indexedDB.open(DB_NAME, DB_VERSION);\n  dbRequest.onerror = function (event) {\n    console.log('error ', event);\n  };\n  dbRequest.onupgradeneeded = upgradeDB;\n  dbRequest.onsuccess = function (event) {\n    let db = event.target.result;\n    let transaction = db.transaction([WORLD_STORE]);\n    let objectStore = transaction.objectStore(WORLD_STORE);\n    let request = objectStore.get(key);\n    request.onerror = function (event) {\n      console.log('Request error loading:', event);\n    };\n    request.onsuccess = function (event) {\n      const newWorld = request.result;\n      const oldSystem = window.world.system;\n      window.world = newWorld;\n      window.world.system = oldSystem;\n\n      // Clear the old containers of whatever they had\n      window.world.system.spriteContainers.planets.removeChildren();\n      window.world.system.planetSpriteCache = {};\n      window.world.system.spriteContainers.ships.removeChildren();\n      window.world.system.shipSpriteCache = {};\n      window.world.system.shieldSpriteCache = new Map();\n      window.world.system.bullets = []; // remove all active bullets from the screen\n      window.world.system.spriteContainers.bullets.removeChildren();\n\n      // Reset/Redraw all the sprites\n      window.world.ship.spriteId = null;\n      const shipSprite = game.getShipSprite(window.world.ship);\n      shipSprite.visible = true;\n      fly.repositionScreen();\n      utils.showToast('Loaded game');\n    };\n  }\n\n}\n\nexport function saveWorld(key) {\n  const worldToStore = lodash.cloneDeep(lodash.omit(window.world, ['system']));\n  worldToStore.saveGameName = key;\n\n  let dbRequest = indexedDB.open(DB_NAME, DB_VERSION);\n  dbRequest.onerror = function (event) {\n    console.log('DB Request Error:', event);\n  };\n  dbRequest.onupgradeneeded = upgradeDB;\n  dbRequest.onsuccess = function (event) {\n    let db = event.target.result;\n    let transaction = db.transaction([WORLD_STORE], \"readwrite\");\n    let objectStore = transaction.objectStore(WORLD_STORE);\n    let objectStoreRequest = objectStore.put(worldToStore);\n    objectStoreRequest.onsuccess = function (event) {\n      utils.showToast('Saved game');\n    };\n    objectStoreRequest.onerror = function (event) {\n      console.log('failed to save ', event.target);\n    }\n  }\n}\n\nexport function deleteWorld(key) {\n  let dbRequest = indexedDB.open(DB_NAME, DB_VERSION);\n  dbRequest.onerror = function (event) {\n    console.log('DB Request Error:', event);\n  };\n  dbRequest.onupgradeneeded = upgradeDB;\n  dbRequest.onsuccess = function (event) {\n    let db = event.target.result;\n    let transaction = db.transaction([WORLD_STORE], \"readwrite\");\n    let objectStore = transaction.objectStore(WORLD_STORE);\n    let objectStoreRequest = objectStore.delete(key);\n    objectStoreRequest.onsuccess = function (event) {\n      utils.showToast('Deleted game ' + key);\n    };\n    objectStoreRequest.onerror = function (event) {\n      console.log('failed to delete ', event.target);\n    }\n  }\n}\n","import React from 'react';\nimport './Heatbar.css';\n\nconst IMG_HEIGHT = 100;\nconst IMG_WIDTH = 24;\n\nexport const HEATBAR = {\n  GREEN : 'heatbar-green.png',\n  RED: 'heatbar-red.png',\n  COLOR: 'heatbar-color.png'\n};\n\nexport function Heatbar({type, curr, max}) {\n  if (type !== HEATBAR.GREEN &&\n    type !== HEATBAR.RED &&\n    type !== HEATBAR.COLOR) {\n    console.warn('unknown heatbar type '+type);\n    return <span />;\n  }\n\n  const pct = curr / max;\n  const topFree = 100 - (pct * IMG_HEIGHT );\n\n  // Use red or green as the base\n  let colorImgSrc = 'images/'+(type === HEATBAR.RED ? HEATBAR.RED : HEATBAR.GREEN);\n\n  // Multicolor is based off green\n  if (type === HEATBAR.COLOR && (topFree > 60)) {\n    colorImgSrc = 'images/heatbar-color.png'\n  }\n\n  return (\n    <span className='heatbar-container' style={{width:IMG_WIDTH+'px',  height:IMG_HEIGHT+'px'}}>\n      <span className='heatbar-base'>\n        <img src='images/heatbar-base.png' width={IMG_WIDTH+'px'} height={IMG_HEIGHT+'px'} alt='heat' />\n      </span>\n      <span className='heatbar-color'>\n        <img src={colorImgSrc} width={IMG_WIDTH+'px'} height={IMG_HEIGHT+'px'} alt='heat' style={{\n          clipPath: 'inset('+topFree+'px 0px 00px 0px)'\n        }}\n        />\n      </span>\n    </span>);\n}\n\n","import React from 'react';\nimport './PushButton.css';\n\nconst IMG_HEIGHT = 26;\nconst IMG_WIDTH = 44;\n\nexport function PushButton({selected, onChange}) {\n  const imgFile = selected ? 'images/button_push_on.png' : 'images/button_push_off.png';\n  return (\n    <img src={imgFile} width={IMG_WIDTH + 'px'} height={IMG_HEIGHT + 'px'} alt='button' onClick={() => {\n      onChange();\n    }}/>\n  );\n}\n","import React from 'react';\nimport './StatusButton.css';\n\nconst IMG_HEIGHT = 24;\nconst IMG_WIDTH = 48;\n// pct at which red turns into yellow\nconst YELLOW_PCT = 0.7; // pct to change to yellow at\nconst BORDER = 5; // width of button border (non drawing part of button)\n\nconst BUTTON = {\n  GREEN: 'button_long_green.png',\n  RED: 'button_long_red.png',\n  YELLOW: 'button_long_yellow.png',\n  BLACK: 'button_long_black.png'\n};\n\nfunction getStatus(curr, max) {\n  if (!max || max <= 0) {\n    return {rightFree: 0, colorImgSrc: 'images/' + BUTTON.BLACK};\n  }\n  if (curr >= max) {\n    return {rightFree: 0, colorImgSrc: 'images/' + BUTTON.GREEN};\n  }\n  // Red\n  if (curr / max < YELLOW_PCT) {\n    const pct = curr / (max * YELLOW_PCT);\n    const rightFree = IMG_WIDTH - (BORDER + pct * (IMG_WIDTH - (2 * BORDER)));\n    return {rightFree, colorImgSrc: 'images/' + BUTTON.RED};\n  }\n  // Yellow\n  const pct = (curr - (max * YELLOW_PCT)) / (max * (1 - YELLOW_PCT));\n  const rightFree = IMG_WIDTH - (BORDER + pct * (IMG_WIDTH - (2 * BORDER)));\n  return {rightFree, colorImgSrc: 'images/' + BUTTON.YELLOW};\n}\n\n\nexport function StatusButton({curr, max}) {\n\n  const {rightFree, colorImgSrc} = getStatus(curr, max);\n\n  return (\n    <span className='statusbutton-container' style={{width: IMG_WIDTH + 'px', height: IMG_HEIGHT + 'px'}}>\n      <span className='statusbutton-base'>\n        <img src={'images/' + BUTTON.BLACK} width={IMG_WIDTH + 'px'} height={IMG_HEIGHT + 'px'} alt='status'/>\n      </span>\n      <span className='statusbutton-color'>\n        <img src={colorImgSrc} width={IMG_WIDTH + 'px'} height={IMG_HEIGHT + 'px'} alt='heat' style={{\n          clipPath: 'inset(0px ' + rightFree + 'px 0px 0px)'\n        }}\n        />\n      </span>\n    </span>);\n}\n\n","import React from 'react';\nimport {c, fly} from '../functions';\nimport './InfoFly.css';\nimport {HEATBAR, Heatbar} from \"./Heatbar\";\nimport {PushButton} from \"./PushButton\";\nimport {StatusButton} from \"./StatusButton\";\n\nexport function InfoFly() {\n  const ship = window.world.ship;\n  const shield = fly.getEquippedShield(ship);\n\n  return (\n    <div className='section'\n         style={{backgroundImage: 'url(\"images/metalbackground.png\")', backgroundSize: 'cover', height: '100%'}}>\n      <div>{ship.name}</div>\n\n      <table>\n        <thead>\n        <tr>\n          <th style={{paddingRight: '10px'}}>Armor</th>\n          <th>Shield</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr>\n          <td style={{textAlign: 'center'}}>\n            <Heatbar type={HEATBAR.COLOR} curr={ship.armor} max={ship.armorMax}/>\n          </td>\n          <td>\n            {shield && shield.shield.active &&\n            <span>\n                <Heatbar type={HEATBAR.RED} curr={shield.shield.lifetime} max={shield.shield.lifetimeMax}/>\n                <Heatbar type={HEATBAR.COLOR} curr={shield.shield.armor} max={shield.shield.armorMax}/>\n              </span>\n            }\n          </td>\n        </tr>\n        <tr>\n          <td>\n            {Math.floor(ship.armor)} / {ship.armorMax}\n          </td>\n          <td> </td>\n          <td> </td>\n        </tr>\n        </tbody>\n      </table>\n\n      <div className='section'>Equip (max {ship.equipMax})\n        <table>\n          <tbody>\n          {ship.equip.map((equip, i) => {\n            return <tr key={i} className='equip'>\n              <td>\n                {equip.type === c.EQUIP_TYPE_SECONDARY_WEAPON &&\n                <PushButton selected={i === ship.selectedSecondaryWeaponIndex} onChange={() => {\n                  ship.selectedSecondaryWeaponIndex = i;\n                }}/>}\n              </td>\n              <td>\n                <StatusButton curr={equip.coolTime - equip.cool} max={equip.coolTime}/>\n              </td>\n              <td>\n                {equip.name}\n              </td>\n            </tr>\n          })}\n          </tbody>\n        </table>\n      </div>\n\n      <div className='section'>\n        <table>\n          <tbody>\n          <tr>\n            <td className='bluescreen-container'>\n              <div className='bluescreen-background'>\n                <img src='images/blue_screen.png' className='stretch' alt='bluescreen'/>\n              </div>\n              <div className='bluescreen-text'>\n                <table cellPadding='4'>\n                  <thead>\n                  <tr>\n                    <th colSpan='100%'>Resources</th>\n                  </tr>\n                  </thead>\n                  <tbody>\n                  <tr>\n                    <td>Titatium</td>\n                    <td>{Math.floor(ship.resources.titanium)}</td>\n                  </tr>\n                  <tr>\n                    <td>Gold</td>\n                    <td>{Math.floor(ship.resources.gold)}</td>\n                  </tr>\n                  <tr>\n                    <td>Uranium</td>\n                    <td>{Math.floor(ship.resources.uranium)}</td>\n                  </tr>\n                  </tbody>\n                </table>\n              </div>\n            </td>\n          </tr>\n          </tbody>\n        </table>\n      </div>\n\n    </div>\n  );\n}\n\n\n","import React, {useState} from 'react';\nimport {c, game, manage} from '../functions';\nimport './ManagePlanet.css';\nimport 'font-awesome/css/font-awesome.min.css';\n\nexport function ManagePlanet() {\n  const [titaniumAmt, setTitaniumAmt] = useState('');\n  const [goldAmt, setGoldAmt] = useState('');\n  const [uraniumAmt, setUraniumAmt] = useState('');\n\n  let world = window.world;\n  let planet = window.world.selectedPlanet;\n  let ship = window.world.ship;\n  let shipOnPlanet = ((planet === window.world.lastPlanetLanded) && ship.alive);\n  return (\n    <div className='planet-info'>\n      <div className='section'><b>Planet Name: </b> {world.selectedPlanet.name}</div>\n      <div className='build-button'>\n        <button\n          disabled={!game.canAfford(planet, (shipOnPlanet ? ship : null), c.MINE_COST)}\n          onClick={() => manage.buildMine()}>Build Mine\n        </button>\n        Cost: T:{c.MINE_COST.titanium} G:{c.MINE_COST.gold}\n      </div>\n      <div className='build-button'>\n        <button\n          disabled={!game.canAfford(planet, (shipOnPlanet ? ship : null), c.FACTORY_COST)}\n          onClick={() => manage.buildFactory()}>Build Factory\n        </button>\n        Cost: T:{c.FACTORY_COST.titanium} G:{c.FACTORY_COST.gold} U:{c.FACTORY_COST.uranium}\n      </div>\n\n      <div style={{display:ship.alive?'block':'none'}} className='build-button'>\n        <div className='section'><b>Ship</b> ({Math.round(ship.armor) +' / '+ ship.armorMax}) </div>\n        <button style={{marginLeft:'10px'}}\n                onClick={() => manage.unloadShip(ship, planet)}>\n          Unload\n        </button>\n        <button style={{marginLeft:'10px'}}\n                onClick={() => manage.resupplyShip(ship, planet)}>\n            Resupply\n        </button>\n        <button style={{marginLeft:'10px'}}\n                onClick={() => manage.repairShip(ship, planet)}\n                disabled={ship.armorMax <= ship.armor}>\n          Repair\n        </button>\n      </div>\n\n      <div className='section'>\n        <b>Resources</b>\n      </div>\n      <div className=\"row-item\">Titanium {Math.floor(planet.resources.raw.titanium)}</div>\n      <div className=\"row-item\">Gold {Math.floor(planet.resources.raw.gold)}</div>\n      <div className=\"row-item\">Uranium {Math.floor(planet.resources.raw.uranium)}</div>\n\n      {shipOnPlanet && <table  className=\"row-item\">\n        <thead>\n        <tr>\n          <th>Resource</th>\n          <th>Planet</th>\n          <th>Transfer</th>\n          <th>Ship ({ship.resourcesMax})</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr>\n          <td>Titanium</td>\n          <td>{Math.floor(planet.resources.stored.titanium)}</td>\n          <td>\n              <span className='transfer-button'\n                    onClick={() => manage.transferResource(ship.resources, planet.resources.stored,\n                      'titanium', titaniumAmt, c.PLANET_RESOURCE_MAX)}><i className=\"fa fa-arrow-left\"> </i></span>\n            <input type='text' className='transfer-input'\n                   defaultValue={titaniumAmt}\n                   onChange={(event) => setTitaniumAmt(event.target.value)}/>\n            <span className='transfer-button'\n                  onClick={() => manage.transferResource(planet.resources.stored, ship.resources,\n                    'titanium', titaniumAmt, ship.resourcesMax)}><i className=\"fa fa-arrow-right\"> </i></span>\n          </td>\n          <td>{Math.floor(ship.resources.titanium)}</td>\n        </tr>\n        <tr>\n          <td>Gold</td>\n          <td>{Math.floor(planet.resources.stored.gold)}</td>\n          <td>\n              <span className='transfer-button'\n                    onClick={() => manage.transferResource(ship.resources, planet.resources.stored,\n                      'gold', goldAmt, c.PLANET_RESOURCE_MAX)}><i className=\"fa fa-arrow-left\"> </i></span>\n            <input type='text' className='transfer-input'\n                   defaultValue={goldAmt}\n                   onChange={(event) => setGoldAmt(event.target.value)}/>\n            <span className='transfer-button'\n                  onClick={() => manage.transferResource(planet.resources.stored, ship.resources,\n                    'gold', goldAmt, ship.resourcesMax)}><i className=\"fa fa-arrow-right\"> </i></span>\n          </td>\n          <td>{Math.floor(ship.resources.gold)}</td>\n        </tr>\n        <tr>\n          <td>Uranium</td>\n          <td>{Math.floor(planet.resources.stored.uranium)}</td>\n          <td>\n              <span className='transfer-button'\n                    onClick={() => manage.transferResource(ship.resources, planet.resources.stored,\n                      'uranium', uraniumAmt, c.PLANET_RESOURCE_MAX)}><i className=\"fa fa-arrow-left\"> </i></span>\n            <input type='text' className='transfer-input'\n                   defaultValue={uraniumAmt}\n                   onChange={(event) => setUraniumAmt(event.target.value)}/>\n            <span className='transfer-button'\n                  onClick={() => manage.transferResource(planet.resources.stored, ship.resources,\n                    'uranium', uraniumAmt, ship.resourcesMax)}><i className=\"fa fa-arrow-right\"> </i></span>\n          </td>\n          <td>{Math.floor(ship.resources.uranium)}</td>\n        </tr>\n        </tbody>\n      </table>}\n\n      {!shipOnPlanet &&\n      <table>\n        <thead>\n        <tr>\n          <th>Resource</th>\n          <th>Planet</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr>\n          <td>Titanium</td>\n          <td>{Math.floor(planet.resources.stored.titanium)}</td>\n        </tr>\n        <tr>\n          <td>Gold</td>\n          <td>{Math.floor(planet.resources.stored.gold)}</td>\n        </tr>\n        <tr>\n          <td>Uranium</td>\n          <td>{Math.floor(planet.resources.stored.uranium)}</td>\n        </tr>\n        </tbody>\n      </table>}\n    </div>);\n}\n\n","import React from 'react';\nimport { c, manage, game} from '../../functions';\nimport './FactoryButtonRow.css';\n\nexport function FactoryButtonRow({template}) {\n  const world = window.world;\n  const planet = world.selectedPlanet;\n  const ship = world.ship;\n  let existingInventory = (template.objType === c.OBJ_SHIP) ?\n    planet.ships.filter(s=> s.name === template.name).length:\n    planet.equip.filter(e=> e.name === template.name).length;\n\n  // Calculate the description\n  let description = template.description;\n  if (!description && template.damage) {\n    description = `${Math.round(template.damage * (60 / template.coolTime))} dmg/s Range ${template.speed * template.lifetime} Speed ${template.speed} `;\n  }\n  if (!description && template.shield) {\n    const shield = template.shield;\n    description = `${shield.armorMax}dmg for ${Math.round(shield.lifetimeMax/60)}s every ${Math.round(template.coolTime/60)}s`;\n  }\n  if (template.createShip) {\n    const newShip = template.createShip.type;\n    description += ` Cost (${newShip.cost.titanium}T ${newShip.cost.gold}G ${newShip.cost.uranium}U)`;\n  }\n\n  // We pretend the current ship is in storage in the planet\n  if (ship.alive && template.name === ship.name) {\n    existingInventory += 1;\n  }\n\n  function build(templateArg) {\n    if (templateArg.objType === c.OBJ_SHIP) {\n      manage.buildShip(templateArg);\n    } else if (templateArg.objType === c.OBJ_EQUIP) {\n      manage.buildEquip(templateArg);\n    }\n  }\n\n  return (\n    <tr>\n      <td className=\"factory-row\">\n        {existingInventory}\n      </td>\n      <td className=\"factory-row\">\n      <button className=\"factory-button\"\n        disabled={!manage.hasFactory(planet) || !game.canAfford(planet, ship, template.cost)}\n        onClick={() => build(template)}>{template.name}</button>\n      </td>\n      <td className=\"factory-row\">\n        <span className='cost'>{template.cost.titanium}T {template.cost.gold}G {template.cost.uranium}U</span>\n      </td>\n      <td className=\"factory-row\">\n        {description}\n      </td>\n    </tr>);\n}\n\n","import React from 'react';\nimport { c } from '../../functions/';\nimport './FactoryTab.css';\nimport {FactoryButtonRow} from \"./FactoryButtonRow\";\n\nexport function FactoryTab({type, templateList}) {\n  return (\n    <div className='container factory-tab' style={{maxHeight: (c.SCREEN_HEIGHT - 200), minWidth:'400px'}}>\n      <table>\n        <tbody>\n          {templateList.map((template, i) => {\n            return <FactoryButtonRow key={type+i} template={template} />;\n          })}\n        </tbody>\n      </table>\n    </div>);\n}\n\n","import React from 'react';\nimport { c } from '../../functions/';\nimport './ManageFactory.css';\nimport {Tab, Tabs} from \"react-bootstrap\";\nimport {FactoryTab} from \"./FactoryTab\";\n\n\nexport function FactoryTabs() {\n  const equip = window.world.blueprints.equip;\n\n  const upgrades =  equip.filter((e) => c.EQUIP_UPGRADES.find(u => u.name === e.name));\n  const primaryWeapons = equip.filter((e) => c.EQUIP_PRIMARY_WEAPONS.find(p => p.name === e.name));\n  const secondaryWeapons = equip.filter((e) => c.EQUIP_SECONDARY_WEAPONS.find(s => s.name === e.name));\n  const droids = equip.filter((e) => c.EQUIP_DROIDS.find(d => d.name === e.name));\n\n  return (\n    <div className='factory-info'>\n      <Tabs defaultActiveKey='ships' id='factory-tabs' className=\"flex-nowrap\">\n        <Tab eventKey='ships' title=\"Ships\">\n          <FactoryTab type='ship' templateList={window.world.blueprints.ship} />\n        </Tab>\n\n        {upgrades && upgrades.length > 0 &&\n        <Tab eventKey='upgrades' title=\"Upgrades\">\n          <FactoryTab type='equip' templateList={upgrades} />\n        </Tab>\n        }\n\n        {primaryWeapons && primaryWeapons.length > 0 &&\n        <Tab eventKey='primaryWeapons' title=\"Primary Weapons\">\n          <FactoryTab type='equip' templateList={primaryWeapons} />\n        </Tab>\n        }\n\n        {secondaryWeapons && secondaryWeapons.length > 0 &&\n        <Tab eventKey='secondaryWeapons' title=\"Secondary Weapons\">\n          <FactoryTab type='equip' templateList={secondaryWeapons} />\n        </Tab>\n        }\n\n        {droids && droids.length > 0 &&\n        <Tab eventKey='droids' title=\"Droids\">\n          <FactoryTab type='equip' templateList={droids} />\n        </Tab>\n        }\n\n      </Tabs>\n    </div>);\n}\n\n","import React, {useState} from 'react';\nimport {manage} from '../functions';\nimport './ManageStorage.css';\n\nexport function ManageStorage() {\n  const [selectedShip, setSelectedShip] = useState();\n  let world = window.world;\n  let planet = world.selectedPlanet;\n  let currentShip = world.ship;\n  let shipOnPlanet = ((planet === window.world.lastPlanetLanded) && currentShip.alive);\n\n  function viewShip(ship) {\n    setSelectedShip(ship);\n  }\n\n  function startUsingShip() {\n    manage.switchToShip(selectedShip);\n    setSelectedShip(null);\n  }\n\n  function salvageShip(selectedShip) {\n    manage.salvageShip(planet, selectedShip);\n    setSelectedShip(null);\n  }\n\n  // Default to selecting the current ship\n  if (!selectedShip && shipOnPlanet) {\n    setSelectedShip(currentShip);\n  }\n\n  let selectedShipEquip = [];\n  if (selectedShip) {\n    for (let equip of selectedShip.equip) {\n      selectedShipEquip.push(\n        <div className=\"item\" key={equip.id}>\n          {equip.name} &nbsp;\n          <button onClick={() => manage.moveEquipFromShipToPlanet(selectedShip, planet, equip)}>Remove</button>\n        </div>);\n    }\n  }\n\n  return (\n    <div>\n      <div className='storage-section'>\n        <div className='title'>Ships</div>\n        <span className='item-list'>\n          {(shipOnPlanet ? [currentShip] : []).concat(planet.ships).map((ship, i) => {\n            return <div key={i}\n                        onClick={() => viewShip(ship)}\n                        className={`ship ${selectedShip === ship ? 'selected-item' : 'non-selected-item'}`}>{ship.name}</div>\n          })}\n        </span>\n        <span className='item-details'>\n          {selectedShip != null && // exclude this block if no ship selected\n          <div>\n            <div className='item-attr'>\n              <button onClick={() => startUsingShip()} disabled={selectedShip === currentShip}>Use Ship</button>\n              <button onClick={() => salvageShip(selectedShip)} style={{marginLeft:'10px'}}>Salvage</button>\n            </div>\n            <div className='item-attr'><b>Name</b> {selectedShip.name} {selectedShip.id}</div>\n            <div className='item-attr'>\n              <b>Engine</b> Propulsion:{Math.floor(selectedShip.propulsion * 100)} Turn:{Math.floor(selectedShip.turnSpeed * 100)}\n            </div>\n            <div className='item-attr'>\n              <b>Landing</b> Speed:{Math.floor(selectedShip.crashSpeed)} Angle:{Math.floor(selectedShip.crashAngle * 10)}\n            </div>\n            <div className='item-attr'><b>Armor</b> &nbsp;\n              {Math.floor(selectedShip.armor)} of {Math.floor(selectedShip.armorMax)}&nbsp;\n              <button onClick={() => manage.repairShip(selectedShip, planet)}\n                      disabled={selectedShip.armorMax <= selectedShip.armor}> Repair\n              </button>\n              &nbsp; Cost {Math.floor(manage.costToRepair(selectedShip).titanium)} titanium\n            </div>\n            <div className='item-attr'><b>Resources Max</b>{Math.floor(selectedShip.resourcesMax)}</div>\n            <div className='item-attr'><b>Equip</b> (Max {selectedShip.equipMax})\n              {selectedShipEquip}\n            </div>\n          </div>\n          }\n        </span>\n      </div>\n\n      <div className='storage-section'>\n        <div className='title'>Equipment</div>\n        <span className='equip-list'>\n          {planet.equip.map((equip, i) => {\n            return <div key={i} className='item'>\n              {equip.name} &nbsp;\n              <button onClick={() => manage.moveEquipFromPlanetToShip(selectedShip, planet, equip)}\n                      disabled={!manage.canEquip(selectedShip, equip)}\n              >Equip\n              </button>\n              <button onClick={() => manage.salvageEquip(planet, equip)} style={{marginLeft:'10px'}}>Salvage</button>\n            </div>\n          })}\n        </span>\n      </div>\n    </div>);\n}\n\n","import React, {useRef} from 'react';\nimport {c, savegame} from '../functions';\nimport './ManageSystem.css';\nimport lodash from 'lodash';\nimport {showToast} from \"../functions/utils\";\n\nexport function ManageSystem() {\n  const world = window.world;\n  const nameInput = useRef();\n  let gameNames = savegame.loadLocalStorage(c.LOCALSTORAGE_GAME_NAMES_KEY);\n\n  function setCurrentGame(newName) {\n    nameInput.current.value = newName;\n    world.saveGameName = newName;\n    console.log('new name ' + newName);\n  }\n\n  /**\n   * Adds a game name to the list of saved game names.\n   */\n  function addGameName(newGameName) {\n    if (newGameName && !gameNames.includes(newGameName)) {\n      gameNames.push(newGameName)\n    }\n    savegame.saveLocalStorage(c.LOCALSTORAGE_GAME_NAMES_KEY, gameNames);\n  }\n\n  // If no games are saved, setup an empty list of game names\n  if (!gameNames) {\n    gameNames = [];\n    addGameName(null);\n  }\n\n  function saveGame() {\n    const saveGameName = nameInput.current.value;\n    if (!saveGameName) {\n      showToast('Cannot save game without name');\n      return;\n    }\n    // Save the world in indexedDB\n    savegame.saveWorld(saveGameName);\n    // Save the game name in localStorage\n    addGameName(saveGameName);\n    setCurrentGame(saveGameName);\n  }\n\n  function loadGame(gameName) {\n    savegame.loadWorld(gameName);\n    setCurrentGame(gameName);\n  }\n\n  function deleteGame(gameName) {\n    if (!window.confirm(\"Are you sure you want to delete \" + gameName + \"?\")) {\n      return;\n    }\n    savegame.deleteWorld(gameName);\n    gameNames = lodash.remove(gameNames, (name) => name !== gameName);\n    savegame.saveLocalStorage(c.LOCALSTORAGE_GAME_NAMES_KEY, gameNames);\n    if (world.saveGameName === gameName) {\n      world.saveGameName = null;\n    }\n    if (nameInput.current.value === gameName) {\n      nameInput.current.value = '';\n    }\n  }\n\n  return (\n    <div>\n      <div className='system-section'>\n        <div className='section'><b>Current Game</b></div>\n        <input type='text' defaultValue={world.saveGameName} onFocus={() => world.system.isTyping = true}\n               onBlur={() => world.system.isTyping = false} ref={nameInput}/>\n        <button name=\"Save\" onClick={() => saveGame()}>Save</button>\n        <div className='section'><b>Saved Game</b></div>\n        {gameNames.map(gameName => (\n          <div key={gameName} className={'game-list-row ' + (world.saveGameName === gameName ? 'selected-game' : '')}>\n            <span className='game-list-item'><button onClick={() => loadGame(gameName)}>Load </button></span>\n            <span className='game-list-item'><button onClick={() => deleteGame(gameName)}>Delete</button></span>\n            <span className='game-list-item'>{gameName}</span>\n          </div>\n        ))}\n      </div>\n    </div>);\n}\n\n","import React from 'react';\nimport {c} from '../functions';\nimport './ManageLog.css';\n\nexport function ManageLog() {\n  const xp = window.world.blueprints.xp;\n\n  const gameTickCount = window.world.gameTickCount;\n  let timeSpentMin = Math.floor((gameTickCount / 360))/10;\n  let timeSpentHr = 0;\n  if (timeSpentMin > 60) {\n    timeSpentHr = Math.floor(timeSpentMin / 60);\n    timeSpentMin = Math.floor(timeSpentMin - (timeSpentHr * 60));\n  }\n\n  const translations = {\n    [c.PLANET_ROCK_FILE]: 'Rock Planet',\n    [c.PLANET_RED_FILE]: 'Red Planet',\n    [c.PLANET_GREEN_FILE]: 'Green Planet',\n    [c.PLANET_PURPLE_FILE]: 'Purple Planet',\n  }\n\n  return (\n    <div>\n      <div className='system-section'>\n        <div className='section'><b>Experience Log</b></div>\n        <div>\n          <table className=\"log-table\">\n            <tbody>\n            {Object.entries(xp).map((entry) => {\n              const [key, value] = entry;\n              if (value) {\n                return <tr key={key}>\n                  <td><b>{translations[key] || key}</b></td>\n                  <td>{Math.round(value)}</td>\n                </tr>;\n              }\n              return <tr key={key}/>;\n              })}\n            </tbody>\n          </table>\n          <div className=\"tick-count\">\n            Total time spent : {timeSpentHr ? timeSpentHr + ' hour'+(timeSpentHr > 1 ? 's ': ' ') : ''} {timeSpentMin} min\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n","import React from 'react';\nimport { ManagePlanet } from './ManagePlanet';\nimport './ManageTabs.css';\nimport { FactoryTabs } from './factory/FactoryTabs';\nimport { ManageStorage } from './ManageStorage';\nimport {ManageSystem} from \"./ManageSystem\";\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport {Tab, Tabs} from \"react-bootstrap\";\nimport {ManageLog} from \"./ManageLog\";\n\nexport function ManageTabs() {\n\n  return (\n    <Tabs defaultActiveKey='planet' id='manage-tabs' mountOnEnter unmountOnExit className=\"flex-nowrap\">\n      <Tab eventKey='planet' title='Planet'>\n        <ManagePlanet/>\n      </Tab>\n\n      <Tab eventKey='factory' title='Factory'>\n        <FactoryTabs/>\n      </Tab>\n\n      <Tab eventKey='storage' title='Storage'>\n        <ManageStorage/>\n      </Tab>\n\n      <Tab eventKey='log' title='Log'>\n        <ManageLog/>\n      </Tab>\n\n      <Tab eventKey='system' title='System'>\n        <ManageSystem/>\n      </Tab>\n    </Tabs>);\n}\n\n","import React from 'react';\nimport { c } from './functions';\nimport './InfoPanel.css';\nimport { InfoFly } from './fly/InfoFly';\nimport { ManageTabs } from './manage/ManageTabs';\n\nexport class InfoPanel extends React.Component {\n  render() {\n    let world = window.world;\n    if (world.system.gameState === c.GAME_STATE.MANAGE) {\n      return (<ManageTabs/>);\n    } else if (world.system.gameState === c.GAME_STATE.FLY) {\n      return (<InfoFly/>);\n    }\n    return (<div>...</div>);\n  }\n}\n\n","import React from 'react';\nimport './App.css';\nimport {InfoPanel} from './InfoPanel';\nimport {ai, c, fly, game, utils} from './functions';\n\nexport default class App extends React.Component {\n\n  constructor(props) {\n    super(props);\n    window.world = game.createEmptyWorld();\n    this.pixiRef = React.createRef();\n  }\n\n  componentDidMount() {\n    this.createPixiApp();\n  }\n\n  render() {\n    return (\n      <table className='root-app' width='100%'>\n        <tbody>\n        <tr>\n          <td>\n            <div className='viewport' ref={this.pixiRef}/>\n          </td>\n          <td className='info-panel' width='100%' height={(window.world.system.screenHeight || c.SCREEN_HEIGHT) + 'px'}>\n            <div className='scroll-box'>\n              <InfoPanel/>\n            </div>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    );\n  }\n\n  createPixiApp = () => {\n    let app = new window.PIXI.Application({width: c.SCREEN_WIDTH, height: c.SCREEN_HEIGHT});\n    app.renderer.backgroundColor = c.BLACK;\n    this.pixiRef.current.appendChild(app.view);\n    window.PIXI.loader\n      .add(c.SPRITESHEET_JSON)\n      .add(c.CRASH_JSON)\n      .load(this.setupGame);\n    window.world.system.app = app;\n  }\n\n  // Setup the App\n  setupGame = () => {\n    game.setupWorld();\n    this.setupKeyboardListeners();\n    this.setupWindowResizeListener();\n    game.changeGameState(c.GAME_STATE.FLY);\n    window.world.system.app.renderer.plugins.interaction.on('pointerdown', (event) => {\n      game.click(event);\n    });\n    window.world.system.app.ticker.add(delta => this.mainLoop(delta));\n  }\n\n  // Main loop runs 60 times per sec\n  mainLoop = (delta) => {\n    if (window.world.system.gameLoop) {\n      window.world.gameTickCount += 1;\n      game.runBuildings();\n      fly.moveBullets();\n      fly.coolAllWeapons();\n      ai.moveAliens();\n      window.world.system.gameLoop(delta);\n    }\n    // Redraw react HTML\n    this.forceUpdate();\n  }\n\n  setupKeyboardListeners = () => {\n    window.world.system.keys.left = utils.keyboardListener(\"ArrowLeft\");\n    window.world.system.keys.right = utils.keyboardListener(\"ArrowRight\");\n    window.world.system.keys.up = utils.keyboardListener(\"ArrowUp\");\n    window.world.system.keys.down = utils.keyboardListener(\"ArrowDown\");\n    window.world.system.keys.space = utils.keyboardListener(\" \");\n    window.world.system.keys.w = utils.keyboardListener(\"w\"); // up\n    window.world.system.keys.a = utils.keyboardListener(\"a\"); // left\n    window.world.system.keys.s = utils.keyboardListener(\"s\"); // down\n    window.world.system.keys.d = utils.keyboardListener(\"d\"); // right\n    window.world.system.keys.q = utils.keyboardListener(\"q\"); // thrust left\n    window.world.system.keys.e = utils.keyboardListener(\"e\"); // thrust right\n    window.world.system.keys.x = utils.keyboardListener(\"x\"); // secondary weapon\n  }\n\n  setupWindowResizeListener() {\n    window.addEventListener('resize', resizeScreenToWindow);\n    resizeScreenToWindow();\n  }\n}\n\nfunction resizeScreenToWindow() {\n  const app = window.world.system.app;\n  const h = Math.max(window.innerHeight - 10, 550);\n  const scale = h / 1000;\n  window.world.system.app.stage.scale.set(scale);\n  app.renderer.resize(h, h);\n  window.world.system.screenHeight = h;\n  window.world.system.screenScale = scale;\n}\n\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n    <App />,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}