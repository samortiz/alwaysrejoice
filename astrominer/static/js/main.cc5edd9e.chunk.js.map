{"version":3,"sources":["functions/utils.js","functions/constants.js","functions/game.js","functions/fly.js","functions/manage.js","functions/ai.js","functions/savegame.js","fly/Heatbar.js","fly/PushButton.js","fly/StatusButton.js","fly/InfoFly.js","manage/ManagePlanet.js","manage/factory/FactoryButtonRow.js","manage/factory/FactoryTab.js","manage/factory/FactoryTabs.js","manage/ManageStorage.js","manage/ManageSystem.js","manage/ManageLog.js","manage/ManageTabs.js","InfoPanel.js","App.js","serviceWorker.js","index.js"],"names":["distanceBetween","ax","ay","bx","by","Math","sqrt","pow","midPoint","a","b","normalizeRadian","radians","retVal","PI","calcGravity","x","y","planet","distance","gravityDirection","atan2","c","GRAVITATIONAL_CONST","mass","sin","cos","dir","directionTo","x1","y1","x2","y2","dirComponents","amount","xAmt","yAmt","randomInt","minP","maxP","min","ceil","max","floor","random","randomFloat","randomBool","getPointFrom","startX","startY","getVertexData","sprite","calculateVertices","vertices","vertexData","map","p","window","world","system","screenScale","collisionPoints","push","toGlobal","globalX","globalY","spriteX","spriteY","HALF_SCREEN_WIDTH","HALF_SCREEN_HEIGHT","pointInSprite","pX","pY","topLeft","topRight","bottomLeft","AB","toVector","AD","AM","dotAMAB","dot","dotABAB","dotAMAD","dotADAD","p1","p2","u","v","keyboardListener","value","key","isDown","isUp","press","undefined","release","downHandler","event","upHandler","downListener","bind","upListener","addEventListener","unsubscribe","removeEventListener","showToast","text","Swal","fire","title","timer","position","showConfirmButton","toast","width","SCREEN_WIDTH","showClass","popup","hideClass","then","APP_VERSION","BLACK","YELLOW","BLUE","WHITE","DARK_GREY","LIGHT_GREY","GREY","RED","GREEN","PURPLE","GAME_STATE","INIT","FLY","MANAGE","LOCALSTORAGE_GAME_NAMES_KEY","SCREEN_HEIGHT","NEARBY_WIDTH","NEARBY_HEIGHT","MINIMAP_WIDTH","MINIMAP_HEIGHT","HALF_MINIMAP_WIDTH","HALF_MINIMAP_HEIGHT","MINIMAP_VIEW_WIDTH","MINIMAP_VIEW_HEIGHT","HALF_MINIMAP_VIEW_WIDTH","HALF_MINIMAP_VIEW_HEIGHT","MINIMAP_SCALE_X","MINIMAP_SCALE_Y","SPRITESHEET_JSON","ALIEN_SHIP_BLACK_FILE","ALIEN_SHIP_BLUE_FILE","ALIEN_SHIP_BLUE_LARGE_FILE","ALIEN_SHIP_BLUE_SMALL_FILE","ALIEN_SHIP_FIRE_FILE","ALIEN_SHIP_GREEN_FILE","ALIEN_SHIP_GREEN_SMALL_FILE","ALIEN_SHIP_GREEN_LARGE_FILE","ALIEN_SHIP_RED_FILE","ALIEN_SHIP_RED_SMALL_FILE","ALIEN_SHIP_RED_LARGE_FILE","BULLET_FILE","BULLET_BLUE_FILE","BULLET_WHITE_FILE","FACTORY_FILE","MINE_FILE","PLANET_GREEN_FILE","PLANET_PURPLE_FILE","PLANET_RED_FILE","PLANET_ROCK_FILE","SHIELD_BLUE_FILE","SHIELD_GREEN_FILE","SHIELD_WHITE_FILE","SHIP_BALL_FILE","SHIP_CARGO_FILE","SHIP_EXPLORER_FILE","SHIP_FAST_FILE","SHIP_FIGHTER_FILE","SHIP_HEAVY_FILE","SHIP_MISSILE_FILE","SHIP_RED_WINGS_FILE","SHIP_SKELETON_FILE","STAR_BACKGROUND_FILE","CRASH_JSON","CRASH","UNIVERSE_RADIUS","OUTER_RING_MIN","OUTER_RING_MAX","PLAYER","ALIEN","PLAYER_STARTING_RESOURCES","titanium","gold","uranium","ALLOWED_OVERLAP","TAKEOFF_SPEED","PLANET_RESOURCE_MAX","PLAYER_START_X","PLAYER_START_Y","MIN_ALIEN_DIST_TO_PLANET","MIN_ALIEN_DIST_TO_ALIEN","MINIMAP_BORDER_COLOR","MINIMAP_BACKGROUND_COLOR","MINIMAP_BUILDING_COLOR","MINIMAP_SHIP_COLOR","MINIMAP_PLANET_COLOR","MINIMAP_SELECTED_PLANET_COLOR","PLANET_COLORS","BUILDING_PLACEMENT_ROTATION_INCREMENT","BUILDING_TYPE_MINE","MINE_SCALE","MINE_WIDTH","MINE_ANIMATION_SPEED","MINE_SPEED_TITANIUM","MINE_SPEED_GOLD","MINE_SPEED_URANIUM","MINE_COST","SALVAGE_RATE","BUILDING_TYPE_FACTORY","FACTORY_COST","FACTORY_WIDTH","FACTORY_SCALE","EQUIP_TYPE_BRAKE","EQUIP_TYPE_PRIMARY_WEAPON","EQUIP_TYPE_SECONDARY_WEAPON","EQUIP_TYPE_THRUSTER","EQUIP_TYPE_ARMOR","EQUIP_TYPE_REPAIR_DROID","EQUIP_TYPE_GUNNERY_DROID","EQUIP_TYPE_SHIELD_DROID","EQUIP_TYPE_SPEED","EQUIP_TYPE_TURN","EQUIP_TYPE_STORAGE","EQUIP_TYPE_AUTOLANDER","THRUST_MOMENTUM","THRUST_BLINK","OBJ_EQUIP","OBJ_SHIP","ALIEN_AI_TURRET","ALIEN_AI_CREEPER","ALIEN_AI_MOTHERSHIP","ALIEN_AI_KAMIKAZI","EQUIP_AI_MINE","EQUIP_AI_TURRET","EQUIP_AI_MISSILE","DIR_AHEAD_OF_SHIP","DIR_BEHIND_SHIP","EQUIP_BRAKE","name","objType","type","brakeSpeedPct","cost","description","EQUIP_BLINK_BRAKE","EQUIP_SPEED_BOOST","boostSpeed","EQUIP_TURN_BOOST","EQUIP_STORAGE","storageAmount","EQUIP_ENHANCED_STORAGE","EQUIP_ARMOR","armorAmt","EQUIP_ENHANCED_ARMOR","EQUIP_THRUSTER","thrustSpeed","thrustType","EQUIP_BLINK_THRUSTER","EQUIP_AUTOLANDER","EQUIP_BLASTER","coolTime","cool","damage","speed","lifetime","jitter","bulletFile","EQUIP_FAST_BLASTER","EQUIP_SPRINKLER_BLASTER","EQUIP_STREAM_BLASTER","EQUIP_MELEE_GUN","EQUIP_SNIPER_RIFLE","EQUIP_ALIEN_BLASTER","EQUIP_ALIEN_BLASTER_FAST","EQUIP_ALIEN_BLASTER_LIGHTNING","EQUIP_STAPLE_GUN","EQUIP_STAPLE_GUN_HEAVY","EQUIP_SHIELD","shield","active","armor","armorMax","lifetimeMax","spriteFile","radius","EQUIP_SHIELD_LONG","EQUIP_SHIELD_STRONG","EQUIP_SHIELD_ULTRA","EQUIP_SHIELD_BLINK","SHIP_RED_MISSILE","propulsion","turnSpeed","resourcesMax","resources","equipMax","equip","crashSpeed","crashAngle","imageScale","imageFile","viewRange","aiType","EQUIP_ALIEN_MISSILE_LAUNCHER","createShip","EQUIP_R2D2","repairSpeed","EQUIP_GUNNERY_DROID","weapon","EQUIP_LIGHTING_DROID","EQUIP_SHIELD_DROID","SHIP_EXPLORER","SHIP_CARGO","SHIP_FAST","SHIP_SKELETON","SHIP_HEAVY","SHIP_FIGHTER","SHIP_WING","SHIP_ALIEN_TURRET","SHIP_ALIEN","SHIP_ALIEN_LARGE","SHIP_ALIEN_STAPLE_TURRET","SHIP_ALIEN_FIRE","SHIP_ALIEN_STEALTH","SHIP_ALIEN_MOTHERSHIP","SHIP_DECOY","SHIP_TURRET","SHIP_STREAM_TURRET","SHIP_MISSILE","SHIP_FRIENDSHIP_MISSILE","ALL_ALIENS","ALL_SHIPS","EQUIP_DECOY_DEPLOYER","EQUIP_TURRET_DEPLOYER","EQUIP_STREAM_TURRET_DEPLOYER","EQUIP_MISSILE_LAUNCHER","EQUIP_FRIENDSHIP_GUN","EQUIP_UPGRADES","EQUIP_PRIMARY_WEAPONS","EQUIP_SECONDARY_WEAPONS","EQUIP_DROIDS","ALL_EQUIP","XP_LEVELS","xp","obj","PLANET_DENSITY","Map","set","UNIVERSE_RINGS","planetCount","minDist","maxDist","minDistToOtherPlanet","minPlanetRadius","maxPlanetRadius","planetFiles","aliens","count","file","createEmptyWorld","saveGameName","ship","view","ships","planets","selectedPlanet","lastPlanetLanded","gameTickCount","nextId","introDialogShown","blueprints","xpLevels","lodash","cloneDeep","keys","app","gameState","isTyping","gameLoop","bgSprite","explosionSheet","explosions","bullets","nearby","planetSpriteCache","shipSpriteCache","shieldSpriteCache","spriteContainers","background","minimap","screenHeight","miniMapGraphics","initializing","setupWorld","setupSpriteContainers","createBackground","createPlanets","shipStartX","shipStartY","getShipSprite","visible","createAliens","setupMiniMap","setupExplosionSheet","mainStage","stage","PIXI","Container","addChild","container","TilingSprite","Texture","from","ring","i","fileName","utils","length","String","fromCharCode","get","maxResource","minResource","createPlanet","getFreeXy","nearestPlanetDistance","origPlanet","nearestPlanet","dist","nearestPlanetDist","nearestAlienDistance","nearestAlien","alien","nearestAlienDist","minDistToPlanet","minDistToAlien","failCount","console","warn","planetFile","stored","raw","buildings","lastLandingDir","spriteId","getPlanetSprite","planetContainer","planetSprite","Sprite","loader","textures","anchor","spriteScale","scale","building","manage","makeBuildingSprite","entries","foundSprite","rotation","spriteWidth","spriteHeight","height","spriteSheet","getSpriteOrigWithHeight","origWidth","origHeight","setShieldRadius","shieldSprite","shipSprite","shieldWidth","getShieldSprite","cacheId","id","shipType","owner","selectedSecondaryWeaponIndex","vx","vy","alive","createAlien","alienInfo","miniMapContainer","mask","Graphics","drawRect","renderable","cacheAsBitmap","g","click","data","global","scaledX","scaledY","fly","clickOnMinimap","changeGameState","newState","enterFlyState","flyLoop","enterManageState","manageLoop","runBuildings","mineResource","children","buildingSprite","animationSpeed","resourceType","nextLevel","addBlueprint","shift","addMiningXp","addAlienXp","canAfford","payResourceCost","payResource","paid","Loader","shared","spritesheet","createExplosionSprite","AnimatedSprite","animations","loop","log","delta","setupNearby","runDroids","left","turnShip","right","d","up","w","propelShip","down","s","brake","getEquip","brakeShip","space","firePrimaryWeapon","fireSecondaryWeapon","q","thrustShip","e","planetsInView","planetInView","grav","game","detectCollisionWithPlanet","landShip","detectCollisionWithAlien","shipsCollide","moveExplosions","moveBackground","drawMiniMap","minX","maxX","minY","maxY","repositionScreen","ai","moveAliens","coolAllWeapons","coolWeapons","disableShield","resetWeaponsCool","droid","shootAtNearestAlien","weaponRange","origDir","fireWeapon","tilePosition","getActiveShield","getAvailableShieldEquip","hasShieldDroid","getEquippedShield","point","planetDir","dirDiff","abs","success","hasAutolander","speedDiff","dirDiffAdj","damageShip","resetGame","r","getExplosionSprite","explosionSprite","playerShip","destroyShip","afterExplosion","play","onLoop","stop","getAvailablePlanetXY","thruster","thrustX","thrustY","fireBullet","gun","getSecondaryWeapon","selectFirstSecondaryWeapon","child","childSprite","childDistFromShip","checkForCollisionWithPlanet","checkForCollisionWithShip","enableShield","bullet","findOrCreateBullet","jitterAmt","killBullet","moveBullets","checkForBulletCollision","bulletWillHitShip","shieldEquip","bulletHitShip","shipDamage","alienDamage","equipType","t","clear","beginFill","lineStyle","endFill","planetOnMap","planetColor","drawCircle","buildingX","buildingY","clickX","clickY","primaryWeaponRange","gravity","takeOff","getBuildingInfo","buildingType","animation","buildMine","mine","getBuildingPlacementRotation","distanceFromShip","deg","degX","degY","buildingWidth","buildingFits","minBuildingWidth","transferResource","source","target","requestedAmtStr","maxCapacity","requestedAmt","Number","isNaN","amt","spaceLeft","unloadShip","resupplyShip","desiredAmt","freeAmt","desiredTitanium","buildFactory","factory","buildShip","shipTemplate","newShip","switchToShip","oldShip","removeShipFromStorage","addShipToStorage","newShipSprite","filter","removedShip","hasFactory","makeEquip","equipTemplate","buildEquip","costToRepair","repairShip","addArmor","titaniumOnHand","addEquip","newEquip","moveEquipFromPlanetToShip","equipToMove","remove","moveEquipFromShipToPlanet","shipResources","owing","this","removeResource","salvageEquip","salvageShip","canEquip","includes","find","eq","hasMoved","creeperAi","turretAi","missileAi","mothershipAi","alienSprite","shootAt","shooter","turretShip","getNearestOpponentTarget","distanceToPlayer","enableShieldIfNeeded","getNearestAlienTarget","getNearestPlayerTarget","getNearestFriendlyTarget","missile","dirToTarget","crashIntoPlayer","moved","playerTarget","distToOpponent","dirToPlanet","rightLeft","turnDir","friend","shipId","otherShip","getShield","saveLocalStorage","objToSave","localStorage","getItem","removeItem","setItem","JSON","stringify","loadLocalStorage","objString","parse","upgradeDB","db","result","oldVersion","deleteObjectStore","createObjectStore","keyPath","loadWorld","dbRequest","indexedDB","open","onerror","onupgradeneeded","onsuccess","request","transaction","objectStore","newWorld","oldSystem","removeChildren","saveWorld","worldToStore","omit","objectStoreRequest","put","deleteWorld","delete","HEATBAR","Heatbar","curr","topFree","colorImgSrc","className","style","IMG_WIDTH","IMG_HEIGHT","src","alt","clipPath","PushButton","selected","onChange","imgFile","onClick","BUTTON","StatusButton","rightFree","getStatus","InfoFly","backgroundImage","backgroundSize","paddingRight","textAlign","paddingLeft","cellPadding","colSpan","display","ManagePlanet","useState","titaniumAmt","setTitaniumAmt","goldAmt","setGoldAmt","uraniumAmt","setUraniumAmt","shipOnPlanet","disabled","round","marginLeft","defaultValue","FactoryButtonRow","template","existingInventory","templateArg","FactoryTab","templateList","maxHeight","minWidth","FactoryTabs","upgrades","primaryWeapons","secondaryWeapons","droids","Tabs","defaultActiveKey","Tab","eventKey","ManageStorage","selectedShip","setSelectedShip","currentShip","selectedShipEquip","concat","viewShip","ManageSystem","nameInput","useRef","gameNames","savegame","setCurrentGame","newName","current","addGameName","newGameName","onFocus","onBlur","ref","saveGame","gameName","loadGame","confirm","deleteGame","color","ManageLog","timeSpentMin","timeSpentHr","translations","Object","entry","ManageTabs","mountOnEnter","unmountOnExit","InfoPanel","React","Component","App","props","createPixiApp","Application","renderer","backgroundColor","pixiRef","appendChild","add","load","setupGame","setupKeyboardListeners","setupWindowResizeListener","plugins","interaction","on","ticker","mainLoop","forceUpdate","createRef","resizeScreenToWindow","h","innerHeight","resize","Boolean","location","hostname","match","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.cc5edd9e.chunk.js","sourcesContent":["import { c } from './';\nimport Swal from \"sweetalert2\";\n\n/**\n * Returns the distance between two points \n */\nexport function distanceBetween(ax, ay, bx, by) {\n  return Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\n}\n  \n/**\n * Returns array with [x,y] of midpoint between two points\n * Both params should be [x,y]\n */\nexport function midPoint(a, b) {\n  return [(a[0]+b[0])/2, (a[1]+b[1])/2];\n}\n\n/**\n * Convert the angle to 0 <= rad <= 2*PI \n */\nexport function normalizeRadian(radians) {\n  let retVal = radians;\n  if (retVal < 0) {\n    retVal += Math.PI * 2;\n  }\n  if (retVal > Math.PI * 2) {\n    retVal -= Math.PI * 2;\n  }\n  return retVal;\n}\n  \n/**\n * Calc gravity for point.\n * @return {x,y,dir} This will be the x and y forces applied to the object (not a point)\n */\nexport function calcGravity(x, y, planet) {\n  let distance = distanceBetween(x, y, planet.x, planet.y);\n  if (distance < 10) {\n    distance = 10;\n  }\n  let gravityDirection = Math.atan2(x - planet.x, y - planet.y);\n  let gravityX = c.GRAVITATIONAL_CONST * planet.mass / Math.pow(distance, 2) * -Math.sin(gravityDirection);\n  let gravityY = c.GRAVITATIONAL_CONST * planet.mass / Math.pow(distance, 2) * -Math.cos(gravityDirection);\n  return {x:gravityX, y:gravityY, dir:gravityDirection};\n}\n\n/**\n * @return the angle x1,y1 would need to face to point directly at x2,y2\n */\nexport function directionTo(x1,y1, x2,y2) {\n  return normalizeRadian(Math.atan2(y2 - y1, x2 - x1));\n}\n\n/**\n * @return {xAmt, yAmt} splitting the dir and amount into x,y portions\n */\nexport function dirComponents(dir, amount) {\n  let xAmt = amount * Math.cos(dir);\n  let yAmt = amount * Math.sin(dir);\n  return {xAmt, yAmt};\n}\n\n/**\n * @return an int between min and max inclusive\n */\nexport function randomInt(minP, maxP) {\n  let min = Math.ceil(minP);\n  let max = Math.floor(maxP);\n  return Math.floor(Math.random() * (max - min +1) + min); \n}\n\n/**\n * @return a random floating point number between min and max\n */\nexport function randomFloat(min, max) {\n  return min + (Math.random() * (max - min));\n}\n\n/**\n * @return true 50% of the time\n */\nexport function randomBool() {\n  return Math.random() > 0.5;\n}\n\n/**\n * @return add distance in direction to startX,startY \n */\nexport function getPointFrom(startX, startY, dir, distance) {\n  let x = startX + (distance * Math.cos(dir));\n  let y = startY + (distance * Math.sin(dir));\n  return {x,y};\n}\n\n/**\n * return a collection of points [[x,y],[x,y]] on a rectangular sprite that can be used for collision detection\n * param x,y global x,y position of sprite (on main map, not in viewport)\n * NOTE: This will scale based on the scaleFactor set by the window size\n */\nexport function getVertexData(x,y, sprite) {\n  sprite.calculateVertices();\n  const vertices = sprite.vertexData.map(p => p / window.world.system.screenScale);\n  let collisionPoints = []; // [[x,y],[x,y]]\n  collisionPoints.push(toGlobal(x, y, vertices[0], vertices[1])); // top left\n  collisionPoints.push(toGlobal(x, y, vertices[2], vertices[3])); // top right\n  collisionPoints.push(toGlobal(x, y, vertices[4], vertices[5])); // bottom right\n  collisionPoints.push(toGlobal(x, y, vertices[6], vertices[7])); // bottom left\n  // Add a few points between to help with border collisions (these have already been converted to global)\n  collisionPoints.push(midPoint(collisionPoints[0], collisionPoints[1]));\n  collisionPoints.push(midPoint(collisionPoints[1], collisionPoints[2]));\n  collisionPoints.push(midPoint(collisionPoints[2], collisionPoints[3]));\n  collisionPoints.push(midPoint(collisionPoints[3], collisionPoints[0]));\n  return collisionPoints;\n}\n\n/**\n * Converts the local sprite-based x,y to global based on ship's position\n * @return [x,y] in global map coordinates\n */\nexport function toGlobal(globalX,globalY, spriteX,spriteY) {\n  return [globalX + (spriteX - c.HALF_SCREEN_WIDTH), globalY+ (spriteY - c.HALF_SCREEN_HEIGHT)];\n}\n\n\n/**\n * return true if the pX,pY (global positions) is inside the sprite at x,y\n * param x,y global x,y position of sprite (on main map, not in viewport)\n */\nexport function pointInSprite(x,y, sprite, pX, pY) {\n  sprite.calculateVertices();\n  // scale the vertices for the screen scaling\n  const vertices = sprite.vertexData.map(p => p / window.world.system.screenScale);\n  const topLeft = (toGlobal(x, y, vertices[0], vertices[1])); // top left\n  const topRight = (toGlobal(x, y, vertices[2], vertices[3])); // top right\n  const bottomLeft = (toGlobal(x, y, vertices[6], vertices[7])); // bottom right\n  // Complicated math stuff\n  const AB = toVector(topLeft, topRight);\n  const AD = toVector(topLeft, bottomLeft);\n  const AM = toVector(topLeft, [pX, pY]);\n  const dotAMAB = dot(AM, AB);\n  const dotABAB = dot(AB, AB);\n  const dotAMAD = dot(AM, AD);\n  const dotADAD = dot(AD, AD);\n  return 0 <= dotAMAB && dotAMAB <= dotABAB && 0 <= dotAMAD && dotAMAD <= dotADAD;\n}\n\n// p1 and p2 are [x,y]\nfunction toVector(p1, p2) {\n  return [(p2[0] - p1[0]), (p2[1] - p1[1])];\n}\n\n// u and v are [x,y]\nfunction dot(u, v) {\n  return (u[0] * v[0]) + (u[1] * v[1]);\n}\n\n/**\n * Sets up a keyboard listener\n */\nexport function keyboardListener(value) {\n  let key = {};\n  key.value = value;\n  key.isDown = false;\n  key.isUp = true;\n  key.press = undefined;\n  key.release = undefined;\n  //The `downHandler`\n  key.downHandler = event => {\n    if (event.key === key.value) {\n      if (key.isUp && key.press) key.press();\n      key.isDown = true;\n      key.isUp = false;\n    }\n  };\n  //The `upHandler`\n  key.upHandler = event => {\n    if (event.key === key.value) {\n      if (key.isDown && key.release) key.release();\n      key.isDown = false;\n      key.isUp = true;\n    }\n  };\n  //Attach event listeners\n  const downListener = key.downHandler.bind(key);\n  const upListener = key.upHandler.bind(key);\n  window.addEventListener(\n    \"keydown\", downListener, false\n  );\n  window.addEventListener(\n    \"keyup\", upListener, false\n  );\n  // Detach event listeners\n  key.unsubscribe = () => {\n    window.removeEventListener(\"keydown\", downListener);\n    window.removeEventListener(\"keyup\", upListener);\n  };\n  return key;\n}\n\nexport function showToast(text) {\n  Swal.fire({\n    title: text,\n    timer: 5000,\n    position:'top-left',\n    showConfirmButton: false,\n    toast:true,\n    width: Math.floor(c.SCREEN_WIDTH/2)+'px',\n    showClass: {\n      popup: 'animate__animated animate__slideInDown'\n    },\n    hideClass: {\n      popup: 'animate__animated animate__slideOutUp'\n    }\n  }).then();\n}","// Main Version\nexport const APP_VERSION = \"0.05a\";\n// Colors\nexport const BLACK = 0X000000;\nexport const YELLOW = 0xFFCC55;\nexport const BLUE = 0x00AAFF;\nexport const WHITE = 0xFFFFFF;\nexport const DARK_GREY = 0x303030;\nexport const LIGHT_GREY = 0x909090;\nexport const GREY = 0x808080;\nexport const RED = 0x500000;\nexport const GREEN = 0x005000;\nexport const PURPLE = 0x500050;\n\nexport const GAME_STATE = {\n  INIT: \"init\",\n  FLY: \"fly\",\n  MANAGE: \"manage\"\n};\n\n// Saved games\nexport const LOCALSTORAGE_GAME_NAMES_KEY = 'saved-game-names';\n\n// Screen Layout\nexport const SCREEN_WIDTH = 1000;\nexport const SCREEN_HEIGHT = 1000;\nexport const HALF_SCREEN_WIDTH = SCREEN_WIDTH / 2;\nexport const HALF_SCREEN_HEIGHT = SCREEN_HEIGHT / 2;\nexport const NEARBY_WIDTH = SCREEN_WIDTH * 3;\nexport const NEARBY_HEIGHT = SCREEN_HEIGHT * 3;\n// size of minimap on screen\nexport const MINIMAP_WIDTH = 250;\nexport const MINIMAP_HEIGHT = 250;\nexport const HALF_MINIMAP_WIDTH = MINIMAP_WIDTH / 2;\nexport const HALF_MINIMAP_HEIGHT = MINIMAP_HEIGHT / 2;\n// how far the minimap can view\nexport const MINIMAP_VIEW_WIDTH = 8000;\nexport const MINIMAP_VIEW_HEIGHT = 8000;\nexport const HALF_MINIMAP_VIEW_WIDTH = MINIMAP_VIEW_WIDTH / 2;\nexport const HALF_MINIMAP_VIEW_HEIGHT = MINIMAP_VIEW_HEIGHT / 2;\n// convert minimap pixels to real pixels\nexport const MINIMAP_SCALE_X = MINIMAP_WIDTH / MINIMAP_VIEW_WIDTH;\nexport const MINIMAP_SCALE_Y = MINIMAP_HEIGHT / MINIMAP_VIEW_HEIGHT;\n\n// Files\nexport const SPRITESHEET_JSON = \"images/spritesheet.json\";\nexport const ALIEN_SHIP_BLACK_FILE = \"alien_black.png\";\nexport const ALIEN_SHIP_BLUE_FILE = \"alien_blue.png\";\nexport const ALIEN_SHIP_BLUE_LARGE_FILE = \"alien_blue_large.png\";\nexport const ALIEN_SHIP_BLUE_SMALL_FILE = \"alien_blue_small.png\";\nexport const ALIEN_SHIP_FIRE_FILE = \"alien_fire.png\";\nexport const ALIEN_SHIP_GREEN_FILE = \"alien_green.png\";\nexport const ALIEN_SHIP_GREEN_SMALL_FILE = \"alien_green_small.png\";\nexport const ALIEN_SHIP_GREEN_LARGE_FILE = \"alien_green_large.png\";\nexport const ALIEN_SHIP_RED_FILE = \"alien_red.png\";\nexport const ALIEN_SHIP_RED_SMALL_FILE = \"alien_red_small.png\";\nexport const ALIEN_SHIP_RED_LARGE_FILE = \"alien_red_large.png\";\nexport const BULLET_FILE = \"bullet.png\";\nexport const BULLET_BLUE_FILE = \"bullet_blue.png\";\nexport const BULLET_WHITE_FILE = \"bullet_white.png\";\nexport const FACTORY_FILE = \"factory.png\";\nexport const MINE_FILE = \"mine\"; // animation name in json\nexport const PLANET_GREEN_FILE = \"planet_green.png\";\nexport const PLANET_PURPLE_FILE = \"planet_purple.png\";\nexport const PLANET_RED_FILE = \"planet_red.png\";\nexport const PLANET_ROCK_FILE = \"planet_rock.png\";\nexport const SHIELD_BLUE_FILE = \"shield_blue.png\";\nexport const SHIELD_GREEN_FILE = \"shield_green.png\";\nexport const SHIELD_WHITE_FILE = \"shield_white.png\";\nexport const SHIP_BALL_FILE = \"ship_ball.png\";\nexport const SHIP_CARGO_FILE = \"ship_cargo.png\";\nexport const SHIP_EXPLORER_FILE = \"ship_explorer.png\";\nexport const SHIP_FAST_FILE = \"ship_fast.png\";\nexport const SHIP_FIGHTER_FILE = \"ship_fighter.png\";\nexport const SHIP_HEAVY_FILE = \"ship_heavy.png\";\nexport const SHIP_MISSILE_FILE = \"ship_missile.png\";\nexport const SHIP_RED_WINGS_FILE = \"ship_red_wings.png\";\nexport const SHIP_SKELETON_FILE = \"ship_skeleton.png\";\nexport const STAR_BACKGROUND_FILE = \"images/stars.png\";\nexport const CRASH_JSON = \"images/crash.json\";\nexport const CRASH = \"crash\"; // animation name in json\n\n// Misc\nexport const UNIVERSE_RADIUS = 40000;\nexport const OUTER_RING_MIN = 50000; // This is where we dump extra planets and aliens that won't fit into the universe\nexport const OUTER_RING_MAX = 70000;\nexport const PLAYER = \"player\";\nexport const ALIEN = \"alien\";\nexport const PLAYER_STARTING_RESOURCES = {titanium: 30, gold: 20, uranium: 0};\nexport const GRAVITATIONAL_CONST = 2;\nexport const ALLOWED_OVERLAP = 2; // overlap for fudging collision detection\nexport const TAKEOFF_SPEED = 10; // in units of planet gravity\nexport const PLANET_RESOURCE_MAX = 99999999;\nexport const PLAYER_START_X = -(UNIVERSE_RADIUS + 1000); // left of the universe\nexport const PLAYER_START_Y = 0;\nexport const MIN_ALIEN_DIST_TO_PLANET = 50;\nexport const MIN_ALIEN_DIST_TO_ALIEN = 3;\n\n// MiniMap colors\nexport const MINIMAP_BORDER_COLOR = LIGHT_GREY;\nexport const MINIMAP_BACKGROUND_COLOR = DARK_GREY;\nexport const MINIMAP_BUILDING_COLOR = BLUE;\nexport const MINIMAP_SHIP_COLOR = WHITE;\nexport const MINIMAP_PLANET_COLOR = LIGHT_GREY;\nexport const MINIMAP_SELECTED_PLANET_COLOR = YELLOW;\nexport const PLANET_COLORS = {\n  [PLANET_ROCK_FILE]: GREY,\n  [PLANET_RED_FILE]: RED,\n  [PLANET_GREEN_FILE]: GREEN,\n  [PLANET_PURPLE_FILE]: PURPLE\n};\n\n// Buildings\nexport const BUILDING_PLACEMENT_ROTATION_INCREMENT = 0.05;\n// Mine\nexport const BUILDING_TYPE_MINE = \"mine\";\nexport const MINE_SCALE = 1;\nexport const MINE_WIDTH = 52;\nexport const MINE_ANIMATION_SPEED = 0.5;\nexport const MINE_SPEED_TITANIUM = 0.0166; // 1 every sec\nexport const MINE_SPEED_GOLD = 0.0083;  // 1 every 2 sec\nexport const MINE_SPEED_URANIUM = 0.0033; // 1 every 5 sec\nexport const MINE_COST = {titanium: 20, gold: 10, uranium: 0};\nexport const SALVAGE_RATE = 0.5; // amount returned when salvaging equipment or ships\n// Factory\nexport const BUILDING_TYPE_FACTORY = \"factory\";\nexport const FACTORY_COST = {titanium: 50, gold: 20, uranium: 10};\nexport const FACTORY_WIDTH = 91;\nexport const FACTORY_SCALE = 0.8;\n\n// Equipment\nexport const EQUIP_TYPE_BRAKE = \"Brake\";\nexport const EQUIP_TYPE_PRIMARY_WEAPON = \"Primary Weapon\";\nexport const EQUIP_TYPE_SECONDARY_WEAPON = \"Secondary Weapon\";\nexport const EQUIP_TYPE_THRUSTER = \"Thruster\";\nexport const EQUIP_TYPE_ARMOR = \"Armor\";\nexport const EQUIP_TYPE_REPAIR_DROID = \"Repair Droid\";\nexport const EQUIP_TYPE_GUNNERY_DROID = \"Gunnery Droid\";\nexport const EQUIP_TYPE_SHIELD_DROID = \"Shield Droid\";\nexport const EQUIP_TYPE_SPEED = \"Speed\";\nexport const EQUIP_TYPE_TURN = \"Turn\";\nexport const EQUIP_TYPE_STORAGE = \"Storage\";\nexport const EQUIP_TYPE_AUTOLANDER = \"Autolander\";\n\nexport const THRUST_MOMENTUM = \"Thrust Momentum\";\nexport const THRUST_BLINK = \"Thrust Blink\";\n\nexport const OBJ_EQUIP = \"Equip\";\nexport const OBJ_SHIP = \"Ship\";\n\nexport const ALIEN_AI_TURRET = \"ALIEN_AI_TURRET\";\nexport const ALIEN_AI_CREEPER = \"ALIEN_AI_CREEPER\";\nexport const ALIEN_AI_MOTHERSHIP = \"ALIEN_AI_MOTHERSHIP\";\nexport const ALIEN_AI_KAMIKAZI = \"ALIEN_AI_KAMIKAZI\";\nexport const EQUIP_AI_MINE = \"EQUIP_AI_MINE\";\nexport const EQUIP_AI_TURRET = \"EQUIP_AI_TURRET\";\nexport const EQUIP_AI_MISSILE = \"EQUIP_AI_MISSILE\";\n\nexport const DIR_AHEAD_OF_SHIP = \"ahead\";\nexport const DIR_BEHIND_SHIP = \"behind\";\n\n// Ship Upgrades\n// brakeSpeedPct is best between 0.02 - 0.1 (higher is ok)\nexport const EQUIP_BRAKE = {\n  name: \"Brake\", objType: OBJ_EQUIP, type: EQUIP_TYPE_BRAKE, brakeSpeedPct: 0.04,\n  cost: {titanium: 20, gold: 10, uranium: 0},\n  description: \"Slows your ship down.\",\n};\nexport const EQUIP_BLINK_BRAKE = {\n  name: \"Blink Brake\", objType: OBJ_EQUIP, type: EQUIP_TYPE_BRAKE, brakeSpeedPct: 0,\n  cost: {titanium: 50, gold: 50, uranium: 30},\n  description: \"Stops your ship immediately.\",\n};\nexport const EQUIP_SPEED_BOOST = {\n  name: \"Speed Booster\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SPEED, boostSpeed: 0.075,\n  cost: {titanium: 0, gold: 20, uranium: 10},\n  description: \"Increase the ship's acceleration. Helps slow ships take off of large planets.\",\n};\nexport const EQUIP_TURN_BOOST = {\n  name: \"Turn Booster\", objType: OBJ_EQUIP, type: EQUIP_TYPE_TURN, boostSpeed: 0.04,\n  cost: {titanium: 0, gold: 10, uranium: 20},\n  description: \"Increase turning speed.\",\n};\nexport const EQUIP_STORAGE = {\n  name: \"Storage\", objType: OBJ_EQUIP, type: EQUIP_TYPE_STORAGE, storageAmount: 100,\n  cost: {titanium: 30, gold: 0, uranium: 0},\n  description: \"100 more resource storage.\",\n};\nexport const EQUIP_ENHANCED_STORAGE = {\n  name: \"Enhanced Storage\", objType: OBJ_EQUIP, type: EQUIP_TYPE_STORAGE, storageAmount: 300,\n  cost: {titanium: 200, gold: 0, uranium: 0},\n  description: \"300 more resources.\",\n};\nexport const EQUIP_ARMOR = {\n  name: \"Armor Plate\", objType: OBJ_EQUIP, type: EQUIP_TYPE_ARMOR, armorAmt: 100,\n  cost: {titanium: 50, gold: 0, uranium: 0},\n  description: \"Increase armor by 100.\",\n};\nexport const EQUIP_ENHANCED_ARMOR = {\n  name: \"Enhanced Armor\", objType: OBJ_EQUIP, type: EQUIP_TYPE_ARMOR, armorAmt: 300,\n  cost: {titanium: 300, gold: 0, uranium: 0},\n  description: \"Increase armor by 300.\",\n};\nexport const EQUIP_THRUSTER = {\n  name: \"Thruster\", objType: OBJ_EQUIP, type: EQUIP_TYPE_THRUSTER, thrustSpeed: 0.08, thrustType: THRUST_MOMENTUM,\n  cost: {titanium: 40, gold: 40, uranium: 10},\n  description: \"Enable lateral movement. Use 'q' and 'e' keys.\",\n};\n// blink thrustSpeed is good from 2 to 10\nexport const EQUIP_BLINK_THRUSTER = {\n  name: \"Blink Thruster\", objType: OBJ_EQUIP, type: EQUIP_TYPE_THRUSTER, thrustSpeed: 2.5, thrustType: THRUST_BLINK,\n  cost: {titanium: 60, gold: 50, uranium: 10},\n  description: \"Lateral movement without momentum. Use 'q' and 'e' keys.\",\n};\nexport const EQUIP_AUTOLANDER = {\n  name: \"Auto Lander\", objType: OBJ_EQUIP, type: EQUIP_TYPE_AUTOLANDER,\n  cost: {titanium: 60, gold: 50, uranium: 10},\n  description: \"Never crash into a planet again!\",\n};\n\n\n// Primary Weapons\nexport const EQUIP_BLASTER = {\n  name: \"Blaster\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 25,\n  cool: 0,\n  damage: 10,\n  speed: 2.5,\n  lifetime: 100,\n  jitter: 0.05,\n  bulletFile: BULLET_FILE,\n  cost: {titanium: 0, gold: 0, uranium: 10}\n};\nexport const EQUIP_FAST_BLASTER = {\n  name: \"Fast Blaster\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 10,\n  cool: 0,\n  damage: 10,\n  speed: 4,\n  lifetime: 80,\n  jitter: 0.05,\n  bulletFile: BULLET_FILE,\n  cost: {titanium: 20, gold: 20, uranium: 40}\n};\nexport const EQUIP_SPRINKLER_BLASTER = {\n  name: \"Sprinkler Blaster\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 2,\n  cool: 0,\n  damage: 8,\n  speed: 2.5,\n  lifetime: 150,\n  jitter: 1,\n  bulletFile: BULLET_FILE,\n  cost: {titanium: 10, gold: 10, uranium: 80}\n};\nexport const EQUIP_STREAM_BLASTER = {\n  name: \"Stream Blaster\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 4,\n  cool: 0,\n  damage: 8,\n  speed: 7,\n  lifetime: 70,\n  jitter: 0.04,\n  bulletFile: BULLET_FILE,\n  cost: {titanium: 0, gold: 50, uranium: 150}\n};\nexport const EQUIP_MELEE_GUN = {\n  name: \"Melee Gun\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 3,\n  cool: 0,\n  damage: 12,\n  speed: 3,\n  lifetime: 40,\n  jitter: 0.25,\n  bulletFile: BULLET_FILE,\n  cost: {titanium: 0, gold: 150, uranium: 200}\n};\nexport const EQUIP_SNIPER_RIFLE = {\n  name: \"Sniper Rifle\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 100,\n  cool: 0,\n  damage: 160,\n  speed: 9,\n  lifetime: 90,\n  jitter: 0.0,\n  bulletFile: BULLET_FILE,\n  cost: {titanium: 0, gold: 200, uranium: 300}\n};\nexport const EQUIP_ALIEN_BLASTER = {\n  name: \"Alien Blaster\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 20,\n  cool: 0,\n  damage: 5,\n  speed: 2,\n  lifetime: 120,\n  jitter: 0.12,\n  bulletFile: BULLET_BLUE_FILE,\n  cost: {titanium: 0, gold: 0, uranium: 5}\n};\nexport const EQUIP_ALIEN_BLASTER_FAST = {\n  name: \"Alien Fast Blaster\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 10,\n  cool: 0,\n  damage: 12,\n  speed: 5,\n  lifetime: 110,\n  jitter: 0.1,\n  bulletFile: BULLET_BLUE_FILE,\n  cost: {titanium: 0, gold: 50, uranium: 80}\n};\nexport const EQUIP_ALIEN_BLASTER_LIGHTNING = {\n  name: \"Alien Lighting Blaster\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 10,\n  cool: 0,\n  damage: 25,\n  speed: 12,\n  lifetime: 50,\n  jitter: 0.08,\n  bulletFile: BULLET_BLUE_FILE,\n  cost: {titanium: 0, gold: 300, uranium: 500}\n};\nexport const EQUIP_STAPLE_GUN = {\n  name: \"Staple Gun\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 3,\n  cool: 0,\n  damage: 5,\n  speed: 3,\n  lifetime: 250,\n  jitter: 0.2,\n  bulletFile: BULLET_WHITE_FILE,\n  cost: {titanium: 0, gold: 50, uranium: 200}\n};\nexport const EQUIP_STAPLE_GUN_HEAVY = {\n  name: \"Heavy Staple Gun\",\n  objType: OBJ_EQUIP,\n  type: EQUIP_TYPE_PRIMARY_WEAPON,\n  coolTime: 3,\n  cool: 0,\n  damage: 6,\n  speed: 3,\n  lifetime: 250,\n  jitter: 0.15,\n  bulletFile: BULLET_WHITE_FILE,\n  cost: {titanium: 0, gold: 250, uranium: 400}\n};\n\n// Secondary (more at end of file after the ships)\nexport const EQUIP_SHIELD = {\n  name: \"Force Shield\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, cool: 0, coolTime: 600,\n  shield: {\n    active: false,\n    armor: 500,\n    armorMax: 500,\n    lifetime: 300,\n    lifetimeMax: 300,\n    spriteFile: SHIELD_BLUE_FILE,\n    radius: 0\n  },\n  cost: {titanium: 0, gold: 100, uranium: 10}\n};\nexport const EQUIP_SHIELD_LONG = {\n  name: \"Long Shield\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, cool: 0, coolTime: 1200,\n  shield: {\n    active: false,\n    armor: 500,\n    armorMax: 500,\n    lifetime: 1100,\n    lifetimeMax: 1100,\n    spriteFile: SHIELD_WHITE_FILE,\n    radius: 0\n  },\n  cost: {titanium: 0, gold: 200, uranium: 10}\n};\nexport const EQUIP_SHIELD_STRONG = {\n  name: \"Strong Shield\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, cool: 0, coolTime: 1000,\n  shield: {\n    active: false,\n    armor: 1500,\n    armorMax: 1500,\n    lifetime: 400,\n    lifetimeMax: 400,\n    spriteFile: SHIELD_GREEN_FILE,\n    radius: 0\n  },\n  cost: {titanium: 0, gold: 200, uranium: 10}\n};\nexport const EQUIP_SHIELD_ULTRA = {\n  name: \"Ultra Shield\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, cool: 0, coolTime: 1000,\n  shield: {\n    active: false,\n    armor: 1200,\n    armorMax: 1200,\n    lifetime: 800,\n    lifetimeMax: 800,\n    spriteFile: SHIELD_BLUE_FILE,\n    radius: 0\n  },\n  cost: {titanium: 0, gold: 300, uranium: 100}\n};\nexport const EQUIP_SHIELD_BLINK = {\n  name: \"Blink Shield\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, cool: 0, coolTime: 600,\n  shield: {\n    active: false,\n    armor: 900,\n    armorMax: 900,\n    lifetime: 500,\n    lifetimeMax: 500,\n    spriteFile: SHIELD_BLUE_FILE,\n    radius: 0\n  },\n  cost: {titanium: 0, gold: 500, uranium: 100}\n};\n\nexport const SHIP_RED_MISSILE = {\n  name: \"Alien Missile\",\n  objType: OBJ_SHIP,\n  propulsion: 0.08,\n  turnSpeed: 0.3,\n  resourcesMax: 0,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 0,\n  equip: [],\n  armorMax: 200,\n  armor: 200,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 0.8,\n  imageFile: ALIEN_SHIP_RED_SMALL_FILE,\n  cost: {titanium: 5, gold: 5, uranium: 10},\n  viewRange: SCREEN_WIDTH * 3,\n  aiType: ALIEN_AI_KAMIKAZI,\n};\n\nexport const EQUIP_ALIEN_MISSILE_LAUNCHER = {\n  name: \"Alien Missile Launcher\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, coolTime: 100, cool: 100,\n  createShip: {type: SHIP_RED_MISSILE, dir: DIR_AHEAD_OF_SHIP},\n  cost: {titanium: 150, gold: 150, uranium: 200},\n  description: \"Fires red alien missiles that persistently follow enemies.\",\n};\n\n// Droids\nexport const EQUIP_R2D2 = {\n  name: \"R2D2 Repair Droid\", objType: OBJ_EQUIP, type: EQUIP_TYPE_REPAIR_DROID, repairSpeed: 0.2,\n  cost: {titanium: 50, gold: 300, uranium: 100},\n  description: \"Repairs your ship while you are flying.\"\n};\nexport const EQUIP_GUNNERY_DROID = {\n  name: \"Gunnery Droid\", objType: OBJ_EQUIP, type: EQUIP_TYPE_GUNNERY_DROID,\n  weapon: EQUIP_FAST_BLASTER, cost: {titanium: 100, gold: 400, uranium: 200},\n  description: \"Fires a fast blaster at the nearest enemy.\",\n};\nexport const EQUIP_LIGHTING_DROID = {\n  name: \"Lightning Droid\", objType: OBJ_EQUIP, type: EQUIP_TYPE_GUNNERY_DROID,\n  weapon: EQUIP_ALIEN_BLASTER_LIGHTNING, cost: {titanium: 100, gold: 500, uranium: 300},\n  description: \"Fires a lightning blaster at the nearest enemy.\",\n};\nexport const EQUIP_SHIELD_DROID = {\n  name: \"Shield Droid\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SHIELD_DROID,\n  cost: {titanium: 50, gold: 600, uranium: 50},\n  description: \"Deploys your shields automatically when bullets are flying.\",\n};\n\n// Ships\nexport const SHIP_EXPLORER = {\n  name: \"Explorer\",\n  objType: OBJ_SHIP,\n  propulsion: 0.05, // best between 0.02 - 0.1\n  turnSpeed: 0.05, // // best between 0.3 - 0.07\n  resourcesMax: 50,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 4,\n  equip: [EQUIP_BRAKE, EQUIP_BLASTER],\n  armorMax: 50,\n  armor: 50,\n  crashSpeed: 2,\n  crashAngle: 0.5,\n  imageScale: 0.6,\n  imageFile: SHIP_EXPLORER_FILE,\n  cost: {titanium: 40, gold: 20, uranium: 10},\n  description: \"A basic ship with good handling and 4 slots.\",\n};\n\nexport const SHIP_CARGO = {\n  name: \"Cargo\",\n  objType: OBJ_SHIP,\n  propulsion: 0.025, // best between 0.02 - 0.1\n  turnSpeed: 0.02, // // best between 0.3 - 0.07\n  resourcesMax: 750,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 3,\n  equip: [EQUIP_BRAKE],\n  armorMax: 20,\n  armor: 20,\n  crashSpeed: 1.2,\n  crashAngle: 0.3,\n  imageScale: 1,\n  imageFile: SHIP_CARGO_FILE,\n  cost: {titanium: 100, gold: 50, uranium: 50},\n  description: \"A large, slow ship that can carry 750 resources, but only has 3 slots.\",\n};\n\nexport const SHIP_FAST = {\n  name: \"Fast\",\n  objType: OBJ_SHIP,\n  propulsion: 0.1, // best between 0.02 - 0.1\n  turnSpeed: 0.07, // // best between 0.3 - 0.07\n  resourcesMax: 40,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 5,\n  equip: [EQUIP_BRAKE],\n  armorMax: 50,\n  armor: 50,\n  crashSpeed: 2,\n  crashAngle: 0.5,\n  imageScale: 0.6,\n  imageFile: SHIP_FAST_FILE,\n  cost: {titanium: 200, gold: 100, uranium: 50},\n  description: \"A fast ship with good handling and 5 slots.\",\n};\n\nexport const SHIP_SKELETON = {\n  name: \"Skeleton\",\n  objType: OBJ_SHIP,\n  propulsion: 0.03, // best between 0.02 - 0.1\n  turnSpeed: 0.03, // // best between 0.3 - 0.07\n  resourcesMax: 30,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 8,\n  equip: [],\n  armorMax: 50,\n  armor: 50,\n  crashSpeed: 2,\n  crashAngle: 0.5,\n  imageScale: 0.7,\n  imageFile: SHIP_SKELETON_FILE,\n  cost: {titanium: 200, gold: 200, uranium: 50},\n  description: \"A framework with 8 slots that makes it flexible.\",\n};\n\nexport const SHIP_HEAVY = {\n  name: \"Heavy\",\n  objType: OBJ_SHIP,\n  propulsion: 0.055, // best between 0.02 - 0.1\n  turnSpeed: 0.05, // // best between 0.3 - 0.07\n  resourcesMax: 300,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 8,\n  equip: [EQUIP_BRAKE],\n  armorMax: 500,\n  armor: 500,\n  crashSpeed: 1.5,\n  crashAngle: 0.4,\n  imageScale: 0.5,\n  imageFile: SHIP_HEAVY_FILE,\n  cost: {titanium: 500, gold: 400, uranium: 300},\n  description: \"A large ship with 500 armor, 300 resources and 8 slots.\",\n};\n\nexport const SHIP_FIGHTER = {\n  name: \"Fighter\",\n  objType: OBJ_SHIP,\n  propulsion: 0.08, // best between 0.02 - 0.1\n  turnSpeed: 0.07, // // best between 0.3 - 0.07\n  resourcesMax: 200,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 10,\n  equip: [EQUIP_BRAKE],\n  armorMax: 300,\n  armor: 300,\n  crashSpeed: 1.5,\n  crashAngle: 0.6,\n  imageScale: 0.6,\n  imageFile: SHIP_FIGHTER_FILE,\n  cost: {titanium: 500, gold: 500, uranium: 500},\n  description: \"A fast, ship with 300 armor, 200 resources and 10 slots.\",\n};\n\nexport const SHIP_WING = {\n  name: \"Wing Ship\",\n  objType: OBJ_SHIP,\n  propulsion: 0.075, // best between 0.02 - 0.1\n  turnSpeed: 0.06, // // best between 0.3 - 0.07\n  resourcesMax: 300,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 12,\n  equip: [EQUIP_BLINK_BRAKE],\n  armorMax: 500,\n  armor: 500,\n  crashSpeed: 3,\n  crashAngle: 0.5,\n  imageScale: 0.7,\n  imageFile: SHIP_RED_WINGS_FILE,\n  cost: {titanium: 1000, gold: 1000, uranium: 1000},\n  description: \"A large ship with good handling 500 armor, 300 resources and 12 slots.\",\n};\n\nexport const SHIP_ALIEN_TURRET = {\n  name: \"Alien Turret\",\n  objType: OBJ_SHIP,\n  propulsion: 0.001, // best between 0.02 - 0.1\n  turnSpeed: 0.05, // // best between 0.3 - 0.07\n  resourcesMax: 100,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 3,\n  equip: [EQUIP_BRAKE, EQUIP_ALIEN_BLASTER],\n  armorMax: 100,\n  armor: 100,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 0.8,\n  imageFile: ALIEN_SHIP_GREEN_SMALL_FILE,\n  cost: {titanium: 50, gold: 50, uranium: 50},\n  aiType: ALIEN_AI_TURRET,\n  description: \"A basic turret with an alien blaster\",\n};\n\nexport const SHIP_ALIEN = {\n  name: \"Alien Ship\",\n  objType: OBJ_SHIP,\n  propulsion: 0.05, // best between 0.02 - 0.1\n  turnSpeed: 0.05, // // best between 0.3 - 0.07\n  resourcesMax: 100,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 5,\n  equip: [EQUIP_BRAKE, EQUIP_ALIEN_BLASTER],\n  armorMax: 100,\n  armor: 100,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 0.9,\n  imageFile: ALIEN_SHIP_GREEN_FILE,\n  cost: {titanium: 150, gold: 100, uranium: 80},\n  aiType: ALIEN_AI_CREEPER,\n  description: \"The basic alien scout ship.\",\n};\n\nexport const SHIP_ALIEN_LARGE = {\n  name: \"Alien Large\",\n  objType: OBJ_SHIP,\n  propulsion: 0.03, // best between 0.02 - 0.1\n  turnSpeed: 0.05, // // best between 0.3 - 0.07\n  resourcesMax: 100,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 8,\n  equip: [EQUIP_BRAKE, EQUIP_ALIEN_BLASTER_FAST],\n  armorMax: 300,\n  armor: 300,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 1,\n  imageFile: ALIEN_SHIP_GREEN_LARGE_FILE,\n  cost: {titanium: 150, gold: 100, uranium: 80},\n  aiType: ALIEN_AI_CREEPER,\n  description: \"A large heavily armored alien.\",\n};\n\nexport const SHIP_ALIEN_STAPLE_TURRET = {\n  name: \"Alien Staple Turret\",\n  objType: OBJ_SHIP,\n  propulsion: 0.00,\n  turnSpeed: 0.001,\n  resourcesMax: 100,\n  resources: {\n     titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 3,\n  equip: [EQUIP_BRAKE, EQUIP_STAPLE_GUN_HEAVY],\n  armorMax: 230,\n  armor: 230,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 1.3,\n  imageFile: ALIEN_SHIP_BLUE_SMALL_FILE,\n  cost: {titanium: 150, gold: 150, uranium: 200},\n  aiType: ALIEN_AI_TURRET,\n  description: \"A hard-to-hit turret with a heavy staple gun.\",\n};\n\nexport const SHIP_ALIEN_FIRE = {\n  name: \"Alien Fire\",\n  objType: OBJ_SHIP,\n  propulsion: 0.08, // best between 0.02 - 0.1\n  turnSpeed: 0.05, // // best between 0.3 - 0.07\n  resourcesMax: 100,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 8,\n  equip: [EQUIP_BRAKE, EQUIP_STAPLE_GUN_HEAVY, EQUIP_SHIELD_LONG],\n  armorMax: 450,\n  armor: 450,\n  crashSpeed: 2,\n  crashAngle: 0.4,\n  imageScale: 1.5,\n  imageFile: ALIEN_SHIP_FIRE_FILE,\n  cost: {titanium: 250, gold: 200, uranium: 80},\n  aiType: ALIEN_AI_CREEPER,\n  description: \"A tough alien ship with a shield and heavy staple gun.\",\n};\n\nexport const SHIP_ALIEN_STEALTH = {\n  name: \"Alien Stealth\",\n  objType: OBJ_SHIP,\n  propulsion: 0.04, // best between 0.02 - 0.1\n  turnSpeed: 0.05, // // best between 0.3 - 0.07\n  resourcesMax: 100,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 6,\n  equip: [EQUIP_BRAKE, EQUIP_ALIEN_BLASTER_FAST],\n  armorMax: 150,\n  armor: 150,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 1.5,\n  imageFile: ALIEN_SHIP_BLACK_FILE,\n  cost: {titanium: 100, gold: 200, uranium: 150},\n  aiType: ALIEN_AI_CREEPER,\n  description: \"An alien with a cloak making it hard to see.\",\n};\n\nexport const SHIP_ALIEN_MOTHERSHIP = {\n  name: \"Alien Mothership\",\n  objType: OBJ_SHIP,\n  propulsion: 0.00,\n  turnSpeed: 0.001,\n  resourcesMax: 10000,\n  resources: {\n    titanium: 1000,\n    gold: 1000,\n    uranium: 2000,\n  },\n  equipMax: 10,\n  equip: [EQUIP_BRAKE, EQUIP_ALIEN_MISSILE_LAUNCHER, EQUIP_SHIELD_ULTRA, EQUIP_ALIEN_BLASTER_LIGHTNING],\n  armorMax: 1000,\n  armor: 1000,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 1.3,\n  imageFile: ALIEN_SHIP_RED_LARGE_FILE,\n  cost: {titanium: 1200, gold: 1000, uranium: 750},\n  aiType: ALIEN_AI_MOTHERSHIP,\n  description: \"A large heavily armored ship with smart missiles.\",\n};\n\nexport const SHIP_DECOY = {\n  name: \"Decoy\",\n  objType: OBJ_SHIP,\n  propulsion: 0.0,\n  turnSpeed: 0.0,\n  resourcesMax: 0,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 0,\n  equip: [],\n  armorMax: 350,\n  armor: 350,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 0.55,\n  imageFile: SHIP_EXPLORER_FILE,\n  cost: {titanium:10, gold: 0, uranium: 0},\n  aiType: EQUIP_AI_MINE,\n  description: \"An empty shell of a ship.\",\n};\n\nexport const SHIP_TURRET = {\n  name: \"Turret\",\n  objType: OBJ_SHIP,\n  propulsion: 0.0,\n  turnSpeed: 0.0,\n  resourcesMax: 0,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 1,\n  equip: [EQUIP_FAST_BLASTER],\n  armorMax: 350,\n  armor: 350,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 0.6,\n  imageFile: ALIEN_SHIP_BLUE_LARGE_FILE,\n  cost: {titanium: 5, gold: 10, uranium: 5},\n  aiType: EQUIP_AI_TURRET,\n  description: \"A turret with a fast blaster.\",\n};\n\nexport const SHIP_STREAM_TURRET = {\n  name: \"Stream Turret\",\n  objType: OBJ_SHIP,\n  propulsion: 0.0,\n  turnSpeed: 0.0,\n  resourcesMax: 0,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 1,\n  equip: [EQUIP_STREAM_BLASTER],\n  armorMax: 250,\n  armor: 250,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 0.4,\n  imageFile: ALIEN_SHIP_BLUE_LARGE_FILE,\n  cost: {titanium: 10, gold: 30, uranium: 20},\n  aiType: EQUIP_AI_TURRET,\n  description: \"A turret with a stream blaster\",\n};\n\nexport const SHIP_MISSILE = {\n  name: \"Missile\",\n  objType: OBJ_SHIP,\n  propulsion: 0.08,\n  turnSpeed: 0.25,\n  resourcesMax: 0,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 0,\n  equip: [],\n  armorMax: 220,\n  armor: 220,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 1,\n  imageFile: SHIP_BALL_FILE,\n  cost: {titanium: 0, gold: 15, uranium: 15},\n  aiType: EQUIP_AI_MISSILE,\n  description: \"An enemy seeking missile.\",\n};\n\nexport const SHIP_FRIENDSHIP_MISSILE = {\n  name: \"Friendship Missile\",\n  objType: OBJ_SHIP,\n  propulsion: 0.09, // best between 0.02 - 0.1\n  turnSpeed: 0.25, // // best between 0.3 - 0.07\n  resourcesMax: 0,\n  resources: {\n    titanium: 0,\n    gold: 0,\n    uranium: 0,\n  },\n  equipMax: 0,\n  equip: [],\n  armorMax: 40,\n  armor: 40,\n  crashSpeed: 2,\n  crashAngle: 10,\n  imageScale: 0.5,\n  imageFile: ALIEN_SHIP_BLUE_FILE,\n  cost: {titanium: 0, gold: 5, uranium: 5},\n  aiType: EQUIP_AI_MISSILE,\n  description: \"A missile that turns enemies into friends.\",\n};\n\nexport const ALL_ALIENS = [SHIP_ALIEN_TURRET, SHIP_ALIEN, SHIP_ALIEN_LARGE, SHIP_ALIEN_STEALTH,  SHIP_ALIEN_STAPLE_TURRET, SHIP_ALIEN_FIRE, SHIP_ALIEN_MOTHERSHIP];\nexport const ALL_SHIPS = [SHIP_EXPLORER, SHIP_CARGO, SHIP_FAST, SHIP_SKELETON, SHIP_HEAVY, SHIP_FIGHTER, SHIP_WING, ...ALL_ALIENS];\n\n// This equipment needs to go after the ships (ugh)\nexport const EQUIP_DECOY_DEPLOYER = {\n  name: \"Decoy Deployer\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, coolTime: 25, cool: 0,\n  createShip: {type: SHIP_DECOY, dir: DIR_BEHIND_SHIP},\n  cost: {titanium: 0, gold: 50, uranium: 100},\n  description: \"Drops a fake ship.\"\n};\nexport const EQUIP_TURRET_DEPLOYER = {\n  name: \"Turret Deployer\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, coolTime: 100, cool: 0,\n  createShip: {type: SHIP_TURRET, dir: DIR_BEHIND_SHIP},\n  cost: {titanium: 0, gold: 200, uranium: 100},\n  description: \"Drops a turret with a fast blaster.\",\n};\nexport const EQUIP_STREAM_TURRET_DEPLOYER = {\n  name: \"Stream Turret Deployer\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, coolTime: 100, cool: 0,\n  createShip: {type: SHIP_STREAM_TURRET, dir: DIR_BEHIND_SHIP},\n  cost: {titanium: 100, gold: 400, uranium: 400},\n  description: \"Drops a turret with a stream blaster.\",\n};\n\nexport const EQUIP_MISSILE_LAUNCHER = {\n  name: \"Missile Launcher\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, coolTime: 100, cool: 0,\n  createShip: {type: SHIP_MISSILE, dir: DIR_AHEAD_OF_SHIP},\n  cost: {titanium: 50, gold: 250, uranium: 300},\n  description: \"Fires enemy-seeking missiles.\",\n};\nexport const EQUIP_FRIENDSHIP_GUN = {\n  name: \"Friendship Gun\", objType: OBJ_EQUIP, type: EQUIP_TYPE_SECONDARY_WEAPON, coolTime: 100, cool: 0,\n  createShip: {type: SHIP_FRIENDSHIP_MISSILE, dir: DIR_AHEAD_OF_SHIP},\n  cost: {titanium: 100, gold: 300, uranium: 100},\n  description: \"Fires a missile that turns your enemies into allies.\",\n};\n\n\nexport const EQUIP_UPGRADES = [EQUIP_BRAKE, EQUIP_BLINK_BRAKE, EQUIP_THRUSTER, EQUIP_BLINK_THRUSTER, EQUIP_ARMOR, EQUIP_SPEED_BOOST, EQUIP_TURN_BOOST,\n  EQUIP_STORAGE, EQUIP_ENHANCED_ARMOR, EQUIP_ENHANCED_STORAGE, EQUIP_AUTOLANDER];\nexport const EQUIP_PRIMARY_WEAPONS = [EQUIP_BLASTER, EQUIP_FAST_BLASTER, EQUIP_STREAM_BLASTER, EQUIP_SPRINKLER_BLASTER, EQUIP_MELEE_GUN, EQUIP_SNIPER_RIFLE, EQUIP_ALIEN_BLASTER, EQUIP_STAPLE_GUN, EQUIP_STAPLE_GUN_HEAVY, EQUIP_ALIEN_BLASTER_FAST, EQUIP_ALIEN_BLASTER_LIGHTNING];\nexport const EQUIP_SECONDARY_WEAPONS = [EQUIP_DECOY_DEPLOYER, EQUIP_TURRET_DEPLOYER, EQUIP_STREAM_TURRET_DEPLOYER, EQUIP_MISSILE_LAUNCHER, EQUIP_ALIEN_MISSILE_LAUNCHER, EQUIP_FRIENDSHIP_GUN, EQUIP_SHIELD, EQUIP_SHIELD_LONG, EQUIP_SHIELD_STRONG, EQUIP_SHIELD_ULTRA, EQUIP_SHIELD_BLINK];\nexport const EQUIP_DROIDS = [EQUIP_R2D2, EQUIP_GUNNERY_DROID, EQUIP_LIGHTING_DROID, EQUIP_SHIELD_DROID];\nexport const ALL_EQUIP = [...EQUIP_UPGRADES, ...EQUIP_PRIMARY_WEAPONS, ...EQUIP_SECONDARY_WEAPONS, ...EQUIP_DROIDS];\n\nexport const XP_LEVELS = {\n  // Mining resources\n  [PLANET_ROCK_FILE]: [\n    {xp: 1, obj: EQUIP_BLASTER},\n    {xp: 10, obj: EQUIP_BRAKE},\n    {xp: 50, obj: SHIP_EXPLORER},\n    {xp: 100, obj: SHIP_CARGO},\n    {xp: 200, obj: EQUIP_ARMOR},\n    {xp: 1000, obj: EQUIP_SPEED_BOOST},\n  ],\n  [PLANET_RED_FILE]: [\n    {xp: 10, obj: EQUIP_STORAGE},\n    {xp: 50, obj: EQUIP_BLINK_BRAKE},\n    {xp: 100, obj: EQUIP_THRUSTER},\n    {xp: 500, obj: SHIP_FAST},\n    {xp: 1000, obj: EQUIP_BLINK_THRUSTER},\n    {xp: 2000, obj: EQUIP_TURN_BOOST},\n  ],\n  [PLANET_GREEN_FILE]: [\n    {xp: 10, obj: SHIP_SKELETON},\n    {xp: 50, obj: EQUIP_R2D2},\n    {xp: 500, obj: SHIP_HEAVY},\n    {xp: 1000, obj: EQUIP_AUTOLANDER},\n  ],\n  [PLANET_PURPLE_FILE]: [\n    {xp: 300, obj: EQUIP_SHIELD_STRONG},\n    {xp: 750, obj: EQUIP_GUNNERY_DROID},\n    {xp: 1000, obj: SHIP_FIGHTER},\n    {xp: 2000, obj: EQUIP_SHIELD_ULTRA},\n  ],\n  // Killing aliens\n  [SHIP_ALIEN_TURRET.name]: [\n    {xp: 1, obj: EQUIP_FAST_BLASTER},\n    {xp: 5, obj: EQUIP_ALIEN_BLASTER},\n    {xp: 10, obj: EQUIP_ALIEN_BLASTER_FAST},\n  ],\n  [SHIP_ALIEN.name]: [\n    {xp: 1, obj: EQUIP_SHIELD},\n    {xp: 5, obj: EQUIP_DECOY_DEPLOYER},\n    {xp: 10, obj: EQUIP_SHIELD_LONG},\n    {xp: 30, obj: SHIP_ALIEN},\n  ],\n  [SHIP_ALIEN_LARGE.name]: [\n    {xp: 1, obj: EQUIP_TURRET_DEPLOYER},\n    {xp: 5, obj: EQUIP_STREAM_BLASTER},\n    {xp: 10, obj: EQUIP_ENHANCED_STORAGE},\n    {xp: 15, obj: EQUIP_SNIPER_RIFLE},\n    {xp: 25, obj: SHIP_ALIEN_LARGE},\n  ],\n  [SHIP_ALIEN_STEALTH.name]: [\n    {xp: 1, obj: EQUIP_SPRINKLER_BLASTER},\n    {xp: 7, obj: EQUIP_MISSILE_LAUNCHER},\n    {xp: 15, obj: EQUIP_FRIENDSHIP_GUN},\n  ],\n  [SHIP_ALIEN_STAPLE_TURRET.name]: [\n    {xp: 1, obj: EQUIP_STAPLE_GUN},\n    {xp: 5, obj: EQUIP_MELEE_GUN},\n    {xp: 10, obj: EQUIP_ENHANCED_ARMOR},\n    {xp: 20, obj: EQUIP_SHIELD_DROID},\n  ],\n  [SHIP_ALIEN_FIRE.name]: [\n    {xp: 1, obj: EQUIP_STAPLE_GUN_HEAVY},\n    {xp: 5, obj: EQUIP_SHIELD_BLINK},\n    {xp: 10, obj: EQUIP_STREAM_TURRET_DEPLOYER},\n    {xp: 20, obj: SHIP_ALIEN_FIRE},\n  ],\n  [SHIP_ALIEN_MOTHERSHIP.name]: [\n    {xp: 1, obj: EQUIP_ALIEN_BLASTER_LIGHTNING},\n    {xp: 2, obj: EQUIP_ALIEN_MISSILE_LAUNCHER},\n    {xp: 3, obj: EQUIP_LIGHTING_DROID},\n    {xp: 4, obj: SHIP_WING},\n  ]\n}\n\nexport const PLANET_DENSITY = new Map();\nPLANET_DENSITY.set(PLANET_ROCK_FILE, 0.025)\nPLANET_DENSITY.set(PLANET_RED_FILE, 0.02)\nPLANET_DENSITY.set(PLANET_GREEN_FILE, 0.013)\nPLANET_DENSITY.set(PLANET_PURPLE_FILE, 0.010)\n\n// Universe Rings\nexport const UNIVERSE_RINGS = [\n  {\n    planetCount: 1,\n    minDist: 1, maxDist: 2,\n    minDistToOtherPlanet: 10,\n    minPlanetRadius: 1500, maxPlanetRadius: 1501,\n    planetFiles: [PLANET_PURPLE_FILE],\n    aliens: [{count: 0, file: null}],\n  },\n  {\n    planetCount: 0,\n    minDist: 1700, maxDist: 2500,\n    minDistToOtherPlanet: 10,\n    minPlanetRadius: 10, maxPlanetRadius: 10,\n    planetFiles: [],\n    aliens: [\n      {count: 50, file: SHIP_ALIEN_STEALTH},\n      {count: 75, file: SHIP_ALIEN_FIRE},\n      {count: 30, file: SHIP_ALIEN_STAPLE_TURRET},\n    ],\n  },\n  {\n    planetCount: 180,\n    minDist: 2500, maxDist: 10000,\n    minDistToOtherPlanet: 150,\n    minPlanetRadius: 300, maxPlanetRadius: 600,\n    planetFiles: [PLANET_RED_FILE, PLANET_PURPLE_FILE, PLANET_GREEN_FILE],\n    aliens: [\n      {count: 400, file: SHIP_ALIEN_STAPLE_TURRET},\n      {count: 500, file: SHIP_ALIEN_LARGE},\n      {count: 500, file: SHIP_ALIEN_STEALTH},\n    ],\n  },\n  {\n    planetCount: 0,\n    minDist: 8000, maxDist: 12000,\n    minDistToOtherPlanet: 10,\n    minPlanetRadius: 10, maxPlanetRadius: 10,\n    planetFiles: [PLANET_RED_FILE],\n    aliens: [\n      {count: 100, file: SHIP_ALIEN_STAPLE_TURRET},\n      {count: 400, file: SHIP_ALIEN_STEALTH},\n    ],\n  },\n  {\n    planetCount: 1000,\n    minDist: 10000, maxDist: 20000,\n    minDistToOtherPlanet: 150,\n    minPlanetRadius: 200, maxPlanetRadius: 360,\n    planetFiles: [PLANET_ROCK_FILE, PLANET_RED_FILE, PLANET_GREEN_FILE],\n    aliens: [\n      {count: 400, file: SHIP_ALIEN_TURRET},\n      {count: 800, file: SHIP_ALIEN},\n      {count: 400, file: SHIP_ALIEN_LARGE},\n    ],\n  },\n  {\n    planetCount: 2000,\n    minDist: 20000, maxDist: 30000,\n    minDistToOtherPlanet: 200,\n    minPlanetRadius: 170, maxPlanetRadius: 220,\n    planetFiles: [PLANET_ROCK_FILE, PLANET_RED_FILE],\n    aliens: [\n      {count: 1300, file: SHIP_ALIEN_TURRET},\n      {count: 400, file: SHIP_ALIEN}\n    ],\n  },\n  {\n    planetCount: 1000,\n    minDist: 30000, maxDist: 35000,\n    minDistToOtherPlanet: 300,\n    minPlanetRadius: 150, maxPlanetRadius: 180,\n    planetFiles: [PLANET_ROCK_FILE],\n    aliens: [{count: 600, file: SHIP_ALIEN_TURRET}],\n  },\n  {\n    planetCount: 900,\n    minDist: 35000, maxDist: UNIVERSE_RADIUS,\n    minDistToOtherPlanet: 500,\n    minPlanetRadius: 80, maxPlanetRadius: 150,\n    planetFiles: [PLANET_ROCK_FILE],\n    aliens: [],\n  },\n];\n","import {c, fly, manage, utils} from './';\nimport lodash from 'lodash';\n\n/**\n * Creates an empty world object, with only basic properties.\n * This will be populated by setupWorld()\n */\nexport function createEmptyWorld() {\n  return {\n    saveGameName: null, // name of last game saved/loaded\n    ship: null,\n    view: { // global XY for current view (in manage mode, always ship.xy in fly mode)\n      x: 0,\n      y: 0,\n    },\n    ships: [],\n    planets: [],\n    selectedPlanet: {resources: {}},\n    lastPlanetLanded: null,\n    gameTickCount : 0,\n    nextId: 100, // unique ID for sprites, equip, etc...\n    introDialogShown: false,\n    blueprints: {\n      ship: [],\n      equip: [],\n      xp: {\n        [c.PLANET_ROCK_FILE]: 0,\n        [c.PLANET_RED_FILE]: 0,\n        [c.PLANET_GREEN_FILE]: 0,\n        [c.PLANET_PURPLE_FILE]: 0,\n        [c.SHIP_ALIEN_TURRET.name]: 0,\n        [c.SHIP_ALIEN.name]: 0,\n        [c.SHIP_ALIEN_LARGE.name]: 0,\n        [c.SHIP_ALIEN_STEALTH.name]: 0,\n        [c.SHIP_ALIEN_STAPLE_TURRET.name]: 0,\n        [c.SHIP_ALIEN_FIRE.name]: 0,\n        [c.SHIP_ALIEN_MOTHERSHIP.name]: 0,\n      },\n      xpLevels: lodash.cloneDeep(c.XP_LEVELS),\n    },\n    // everything in system is transient and not serialized when saving the game\n    system: {\n      keys: {}, // Global keypress handlers\n      app: null, // Pixi App\n      gameState: c.GAME_STATE.INIT, // Current game state\n      isTyping: false, // used to stop keypress events ('w') when user is typing in input\n      gameLoop: null, // loop function in this state\n      bgSprite: null, // star background\n      explosionSheet: null, // spritesheet for explosions\n      explosions: [], //contains sprites\n      bullets: [], // contains all the bullets\n      nearby: {planets: [], ships: []}, // ships and planets near enough for collision detection and running AI\n      planetSpriteCache: {}, // {\"green_planet.png\" : Map(id:sprite, id:sprite)... }\n      shipSpriteCache: {}, // {\"alien_small.png\" : Map(id:sprite, id:sprite)... }\n      shieldSpriteCache: new Map(), // These sprites are each added to a ship and not reused\n      spriteContainers: {background: null, planets: null, bullets: null, ships: null, minimap: null, explosions:null},\n      screenHeight: c.SCREEN_HEIGHT, // changed based on window size\n      screenScale: 1, // scale due to window sizing\n      miniMapGraphics: null, // used as a canvas for drawing the miniMap\n      initializing: true, // set to false when the game fully running (after first draw)\n    },\n  };\n}\n\nexport function setupWorld() {\n  const world = window.world;\n  setupSpriteContainers();\n  createBackground();\n  createPlanets();\n  // Default selectedPlanet, shouldn't be displayed\n  world.selectedPlanet = world.planets[0];\n  window.world.shipStartX = c.PLAYER_START_X;\n  // window.world.shipStartX = -2500;\n  window.world.shipStartY = c.PLAYER_START_Y;\n  world.ship = createShip(c.SHIP_EXPLORER, c.PLAYER);\n  const shipSprite = getShipSprite(world.ship);\n  shipSprite.visible = true;\n  world.ship.resources = c.PLAYER_STARTING_RESOURCES;\n\n  // DEBUG SHIP\n  // world.ship.armorMax = 55000;\n  // world.ship.armor = 55000;\n  // world.ship.resources = {titanium: 10000, gold: 10000, uranium: 10000};\n  // world.ship.resourcesMax = 100000;\n  // world.ship.equip = [manage.makeEquip(c.EQUIP_BRAKE), manage.makeEquip(c.EQUIP_AUTOLANDER), manage.makeEquip(c.EQUIP_MELEE_GUN),\n  //   manage.makeEquip(c.EQUIP_ALIEN_MISSILE_LAUNCHER),\n  //   manage.makeEquip(c.EQUIP_SHIELD_DROID), manage.makeEquip(c.EQUIP_SHIELD_BLINK), manage.makeEquip(c.EQUIP_SHIELD_BLINK)];\n  // world.ship.equipMax = world.ship.equip.length;\n  // world.blueprints.equip = [...c.ALL_EQUIP];\n  // world.blueprints.ship = [...c.ALL_SHIPS];\n  // world.introDialogShown = true;\n\n  // DEBUG test alien\n  // createAlien(c.SHIP_ALIEN_TURRET, c.PLAYER_START_X + 450, c.PLAYER_START_Y + 70);\n  // createAlien(c.SHIP_ALIEN_LARGE, c.PLAYER_START_X + 450, c.PLAYER_START_Y - 70);\n\n  // DEBUG Planet\n  // let testPlanet = createPlanet(c.PLANET_ROCK_FILE, \"home\", 100, 200, {\n  //   titanium: 20000,\n  //   gold: 50000,\n  //   uranium: 50000,\n  // });\n  // testPlanet.x = c.PLAYER_START_X - 150;\n  // testPlanet.y = c.PLAYER_START_Y;\n  // testPlanet.resources.stored = {titanium: 10000, gold: 10000, uranium: 10000};\n\n  createAliens();\n  setupMiniMap();\n  setupExplosionSheet();\n}\n\n/**\n * Sets up the sprite containers in the correct display order\n */\nexport function setupSpriteContainers() {\n  let mainStage = window.world.system.app.stage;\n  let spriteContainers = window.world.system.spriteContainers;\n  spriteContainers.background = new window.PIXI.Container();\n  mainStage.addChild(spriteContainers.background);\n\n  spriteContainers.planets = new window.PIXI.Container();\n  mainStage.addChild(spriteContainers.planets);\n\n  spriteContainers.bullets = new window.PIXI.Container();\n  mainStage.addChild(spriteContainers.bullets);\n\n  spriteContainers.ships = new window.PIXI.Container();\n  mainStage.addChild(spriteContainers.ships);\n\n  spriteContainers.explosions = new window.PIXI.Container();\n  mainStage.addChild(spriteContainers.explosions);\n\n  spriteContainers.minimap = new window.PIXI.Container();\n  mainStage.addChild(spriteContainers.minimap);\n}\n\nexport function createBackground() {\n  let container = window.world.system.spriteContainers.background;\n  window.world.system.bgSprite = new window.PIXI.TilingSprite(\n    window.PIXI.Texture.from(c.STAR_BACKGROUND_FILE),\n    c.SCREEN_WIDTH,\n    c.SCREEN_HEIGHT,\n  );\n  container.addChild(window.world.system.bgSprite);\n}\n\nexport function createPlanets() {\n  let container = window.world.system.spriteContainers.planets;\n  for (let ring of c.UNIVERSE_RINGS) {\n    for (let i = 0; i < ring.planetCount; i++) {\n      let fileName = ring.planetFiles[utils.randomInt(0, ring.planetFiles.length - 1)];\n      let name = String.fromCharCode(65 + Math.floor(Math.random() * 26)) + utils.randomInt(1000, 999999);\n      let radius = utils.randomInt(ring.minPlanetRadius, ring.maxPlanetRadius);\n      let mass = radius * radius * c.PLANET_DENSITY.get(fileName);\n      let maxResource = mass * 2 * 0.3;\n      let minResource = mass * 0.15;\n      if (radius > 1000) {\n        minResource += 10000;\n        maxResource += 10000;\n      } else if (radius > 500) {\n        minResource += 500;\n        maxResource += 500;\n      }\n      // Setup the planet\n      let planet = createPlanet(fileName, name, radius, mass, {\n        titanium: utils.randomInt(minResource, maxResource),\n        gold: utils.randomInt(minResource, maxResource),\n        uranium: utils.randomInt(minResource, maxResource),\n      }, container);\n      let {x, y} = getFreeXy(planet, ring.minDistToOtherPlanet, 0, ring.minDist, ring.maxDist);\n      planet.x = x;\n      planet.y = y;\n    }\n  }\n}\n\n/**\n * Distance to the nearest planet that is not equal to origPlanet\n * @return {{nearestPlanetDist: number, nearestPlanet: null}}\n */\nfunction nearestPlanetDistance(origPlanet, x, y) {\n  let minDist = 99999999999;\n  let nearestPlanet = null;\n  for (let planet of window.world.planets) {\n    if (planet !== origPlanet) {\n      let dist = utils.distanceBetween(x, y, planet.x, planet.y) - planet.radius;\n      if (origPlanet) {\n        dist -= origPlanet.radius;\n      }\n      if (!nearestPlanet || (dist < minDist)) {\n        minDist = dist;\n        nearestPlanet = planet;\n      }\n    }\n  } // for planet\n  return {nearestPlanet: nearestPlanet, nearestPlanetDist: minDist};\n}\n\n/**\n * Distance to the nearest alien\n * @return {{nearestAlien: null, nearestAlienDist: number}}\n */\nfunction nearestAlienDistance(x, y) {\n  let minDist = 99999999999;\n  let nearestAlien = null;\n  for (let alien of window.world.system.nearby.ships) {\n    if (alien === window.world.ship) {\n      continue;\n    }\n    // This assumes the calling code alien is the same size\n    let dist = utils.distanceBetween(x, y, alien.x, alien.y) - (alien.radius * 2);\n    if (!nearestAlien || (dist < minDist)) {\n      minDist = dist;\n      nearestAlien = alien;\n    }\n  } // for\n  return {nearestAlien: nearestAlien, nearestAlienDist: minDist};\n}\n\n/**\n * Find a free spot of space to stick something\n * This will recurse until it finds a free spot.\n * @return {{x, y}}\n */\nfunction getFreeXy(planet, minDistToPlanet, minDistToAlien, minDist, maxDist, failCount = 0) {\n  let dir = utils.randomFloat(0, Math.PI * 2);\n  let dist = utils.randomInt(minDist, maxDist);\n  let {x, y} = utils.getPointFrom(0, 0, dir, dist);\n  if (failCount > 200) {\n    // If we tried a lot of times and can't find a spot, we will dump the object into the outer ring\n    console.warn(\"Had a hard time finding a spot in ring \"+minDist+\"-\"+maxDist+\" dumping to outer ring\");\n    return getFreeXy(planet, minDistToPlanet, minDistToAlien, c.OUTER_RING_MIN, c.OUTER_RING_MAX, 0);\n  }\n  if (minDistToPlanet > 0) {\n    let {nearestPlanetDist} = nearestPlanetDistance(planet, x, y);\n    if (nearestPlanetDist < minDistToPlanet) {\n      return getFreeXy(planet, minDistToPlanet, minDistToAlien, minDist, maxDist, ++failCount);\n    }\n  }\n  if (minDistToAlien > 0) {\n    let {nearestAlienDist} = nearestAlienDistance(x, y);\n    if (nearestAlienDist < minDistToAlien) {\n      return getFreeXy(planet, minDistToPlanet, minDistToAlien, minDist, maxDist, ++failCount);\n    }\n  }\n  return {x, y};\n}\n\n// Creates and returns a planet (and adds it to the app)\nexport function createPlanet(planetFile, name, radius, mass, resources) {\n  let planet = {};\n  planet.name = name;\n  planet.x = 0; // temp should get reset\n  planet.y = 0; // temp should get reset\n  planet.mass = mass;\n  planet.resources = {\n    stored: {titanium: 0, gold: 0, uranium: 0},\n    raw: resources\n  };\n  planet.ships = []; // stored ships \n  planet.equip = []; // stored equipment\n  planet.buildings = []; // mines, factories\n  planet.radius = radius;\n  planet.lastLandingDir = 0;\n  planet.spriteFile = planetFile;\n  planet.spriteId = null; // no sprite created yet\n  window.world.planets.push(planet);\n  return planet;\n}\n\n/**\n * Finds or creates a planet sprite.\n * This cache works a little different, no sprites are re-used.\n * Once a planetSprite is created the buildings are added and it stays attached to the planet\n * Otherwise we would have to empty out the container and redraw the planet and buildings each time\n */\nexport function getPlanetSprite(planet) {\n  let planetSpriteCache = window.world.system.planetSpriteCache[planet.spriteFile];\n  // No cache for this file yet - create an empty cache\n  if (!planetSpriteCache) {\n    planetSpriteCache = new Map();\n    window.world.system.planetSpriteCache[planet.spriteFile] = planetSpriteCache;\n  }\n  // Lookup the sprite in the cache by ID\n  let planetContainer = planetSpriteCache.get(planet.spriteId);\n  if (planetContainer) {\n    return planetContainer;\n  }\n  // Setup the planet container sprite (contains planet plus buildings)\n  planetContainer = new window.PIXI.Container();\n  planetContainer.x = 0; // will be set on every draw\n  planetContainer.y = 0;\n  planetContainer.visible = true;\n  window.world.system.spriteContainers.planets.addChild(planetContainer);\n\n  // Setup the planet sprite itself\n  const planetSprite = new window.PIXI.Sprite(\n    window.PIXI.loader.resources[c.SPRITESHEET_JSON].textures[planet.spriteFile]);\n  planetSprite.anchor.set(0.5, 0.5);\n  let spriteScale = planet.radius * 2 / planetSprite.width;\n  // Planets with atmosphere are a little smaller than the full image size\n  if ((planet.spriteFile === c.PLANET_PURPLE_FILE) || (planet.spriteFile === c.PLANET_GREEN_FILE)) {\n    spriteScale = spriteScale * 1.08;\n  }\n  planetSprite.scale.set(spriteScale, spriteScale);\n  planetContainer.addChild(planetSprite);\n\n  for (const building of planet.buildings) {\n    manage.makeBuildingSprite(building, planet, planetContainer);\n  }\n\n  // Cache the new sprite\n  planet.spriteId = window.world.nextId++;\n  planetSpriteCache.set(planet.spriteId, planetContainer);\n  return planetContainer;\n}\n\n/**\n * Finds or creates a sprite for the ship\n * NOTE: This will return a non-visible sprite, the calling code is responsible for making the sprite visible\n */\nexport function getShipSprite(ship) {\n  // if (!ship.alive) {\n  //   console.warn('You should not get sprites for dead ships.');\n  //   console.trace();\n  //   window.error(); // does not exist... thus an error!\n  //   return;\n  // }\n  let shipSpriteCache = window.world.system.shipSpriteCache[ship.imageFile];\n  // No cache for this file yet - create an empty cache\n  if (!shipSpriteCache) {\n    shipSpriteCache = new Map();\n    window.world.system.shipSpriteCache[ship.imageFile] = shipSpriteCache;\n  }\n  // Lookup the sprite in the cache by ID\n  let sprite = shipSpriteCache.get(ship.spriteId);\n  if (sprite) {\n    return sprite;\n  }\n  // Lookup a free sprite (dead or off-screen alien)\n  for (let [spriteId, foundSprite] of shipSpriteCache.entries()) {\n    if (!foundSprite.visible) {\n      foundSprite.visible = false;\n      foundSprite.rotation = ship.rotation;\n      foundSprite.scale.set(ship.imageScale, ship.imageScale);\n      ship.spriteWidth = foundSprite.width;\n      ship.spriteHeight = foundSprite.height;\n      ship.radius = foundSprite.width / 2; // used for circular aliens\n      ship.spriteId = spriteId;\n      //console.log('found old sprite '+spriteId+' '+ship.imageFile);\n      return foundSprite;\n    }\n  } // foundSprite\n\n  // No sprite found - create a new one\n  let spriteSheet = window.PIXI.loader.resources[c.SPRITESHEET_JSON];\n  sprite = new window.PIXI.Sprite(spriteSheet.textures[ship.imageFile]);\n  sprite.position.set(c.HALF_SCREEN_WIDTH, c.HALF_SCREEN_HEIGHT);\n  sprite.anchor.set(0.5, 0.5);  // pivot on ship center\n  sprite.scale.set(ship.imageScale, ship.imageScale);\n  sprite.rotation = ship.rotation;\n  sprite.visible = false;\n  ship.spriteWidth = sprite.width;\n  ship.spriteHeight = sprite.height;\n  ship.radius = sprite.width / 2; // used for circular aliens\n  ship.spriteId = window.world.nextId++;\n  shipSpriteCache.set(ship.spriteId, sprite);\n  window.world.system.spriteContainers.ships.addChild(sprite);\n  //console.log('created new ship sprite '+ship.imageFile, sprite);\n  return sprite;\n}\n\n/**\n * @return The original width/height of the sprite before scaling was applied\n *   {width, height}\n */\nexport function getSpriteOrigWithHeight(sprite) {\n  const origWidth = sprite.width;\n  const origHeight = sprite.height;\n  sprite.scale.set(1, 1);\n  const width = sprite.width;\n  const height = sprite.height;\n  sprite.width = origWidth;\n  sprite.height = origHeight;\n  return {width, height};\n}\n\nexport function setShieldRadius(ship, shield, shieldSprite) {\n  const shipSprite = getShipSprite(ship);\n  shieldSprite.anchor.set(0.5, 0.5);  // pivot on center\n  const {width, height} = getSpriteOrigWithHeight(shipSprite);\n  // Radius within the scaled ship sprite\n  const shieldWidth = Math.max(width, height) * 1.5; // 1.5 to make it larger than the ship\n  shieldSprite.width = shieldWidth;\n  shieldSprite.height = shieldWidth;\n  shield.radius = (shieldWidth * ship.imageScale) / 2; // size without ship scaling\n}\n\nexport function getShieldSprite(ship, shield) {\n  const cacheId = ship.id + '~' + shield.spriteFile;\n  // Lookup the sprite in the cache by ID\n  let shieldSprite = window.world.system.shieldSpriteCache.get(cacheId);\n  if (shieldSprite) {\n    setShieldRadius(ship, shield, shieldSprite);\n    return shieldSprite;\n  }\n  // Add a new shield image to the ship\n  const shipSprite = getShipSprite(ship);\n  let spriteSheet = window.PIXI.loader.resources[c.SPRITESHEET_JSON];\n  shieldSprite = new window.PIXI.Sprite(spriteSheet.textures[shield.spriteFile]);\n  setShieldRadius(ship, shield, shieldSprite);\n  shipSprite.addChild(shieldSprite);\n  window.world.system.shieldSpriteCache.set(cacheId, shieldSprite);\n  return shieldSprite;\n}\n\n// Creates and returns a ship object\nexport function createShip(shipType, owner) {\n  let ship = lodash.cloneDeep(shipType);\n  ship.id = window.world.nextId++;\n  ship.selectedSecondaryWeaponIndex = -1;\n  for (let i=0; i<ship.equip.length; i++) {\n    const equip = ship.equip[i];\n    equip.id = window.world.nextId++;\n    if (ship.selectedSecondaryWeaponIndex < 0 && equip.type === c.EQUIP_TYPE_SECONDARY_WEAPON) {\n      ship.selectedSecondaryWeaponIndex = i;\n    }\n  }\n  ship.owner = owner;\n  ship.vx = 0; // velocityX\n  ship.vy = 0; // velocityY\n  ship.x = window.world.shipStartX;\n  ship.y = window.world.shipStartY;\n  ship.spriteId = null; // no sprite yet\n  ship.alive = true; // set to false if it blows up\n  ship.spriteWidth = null; //We won't know until we load the sprite\n  ship.rotation = 0;\n  window.world.system.nearby.ships.push(ship);\n  return ship;\n}\n\nexport function createAlien(shipType, x, y) {\n  let alien = createShip(shipType, c.ALIEN);\n  window.world.ships.push(alien);\n  alien.x = x;\n  alien.y = y;\n  alien.radius = 50; // will be set to a real value when sprite loads\n  return alien;\n}\n\nexport function createAliens() {\n  // Create motherships\n  createAlien(c.SHIP_ALIEN_MOTHERSHIP, 1700, 200);\n  createAlien(c.SHIP_ALIEN_MOTHERSHIP, 0, 1700);\n  createAlien(c.SHIP_ALIEN_MOTHERSHIP, -1700, 0);\n  createAlien(c.SHIP_ALIEN_MOTHERSHIP, 0, -1700);\n\n  for (let ring of c.UNIVERSE_RINGS) {\n    for (const alienInfo of ring.aliens) {\n      for (let i = 0; i < alienInfo.count; i++) {\n        let {x, y} = getFreeXy(null, c.MIN_ALIEN_DIST_TO_PLANET, c.MIN_ALIEN_DIST_TO_ALIEN, ring.minDist, ring.maxDist);\n        createAlien(alienInfo.file, x, y);\n      } // for i\n    } // for alienInfo\n  } // for ring\n}\n\nexport function setupMiniMap() {\n  let container = window.world.system.spriteContainers.minimap;\n  let miniMapContainer = new window.PIXI.Container();\n  container.addChild(miniMapContainer);\n\n  // Mask so drawings don't spill out of the map\n  let mask = new window.PIXI.Graphics();\n  mask.drawRect(0, c.SCREEN_HEIGHT - c.MINIMAP_HEIGHT, c.MINIMAP_WIDTH, c.SCREEN_HEIGHT);\n  mask.renderable = true;\n  mask.cacheAsBitmap = true;\n  miniMapContainer.addChild(mask);\n  miniMapContainer.mask = mask;\n\n  // Graphics for drawing shapes on\n  let g = new window.PIXI.Graphics();\n  miniMapContainer.addChild(g);\n  window.world.system.miniMapGraphics = g;\n}\n\n/**\n * Called when the user clicks on the screen\n */\nexport function click(event) {\n  let x = event.data.global.x;\n  let y = event.data.global.y;\n  const screenScale = window.world.system.screenScale;\n  let scaledX = x / screenScale;\n  let scaledY = y / screenScale;\n  if ((scaledX < c.MINIMAP_WIDTH) && (scaledY > (c.SCREEN_HEIGHT - c.MINIMAP_HEIGHT))) {\n    fly.clickOnMinimap(scaledX, scaledY);\n  }\n}\n\nexport function changeGameState(newState) {\n  const world = window.world;\n  world.system.gameState = newState;\n  if (newState === c.GAME_STATE.FLY) {\n    fly.enterFlyState();\n    world.system.gameLoop = fly.flyLoop;\n  } else if (newState === c.GAME_STATE.MANAGE) {\n    manage.enterManageState();\n    world.system.gameLoop = manage.manageLoop;\n  } else {\n    world.system.gameLoop = null;\n  }\n}\n\n/**\n * Loop to run building, runs in any game mode (fly + manage)\n */\nexport function runBuildings() {\n  const world = window.world;\n  for (let planet of world.planets) {\n    for (let building of planet.buildings) {\n      if (building.type === c.BUILDING_TYPE_MINE) {\n        mineResource(planet, 'titanium', c.MINE_SPEED_TITANIUM);\n        mineResource(planet, 'gold', c.MINE_SPEED_GOLD);\n        mineResource(planet, 'uranium', c.MINE_SPEED_URANIUM);\n      }\n    } // for building\n    // If planet is out of resources stop the mine animations\n    if ((planet.resources.raw.titanium === 0)\n      && (planet.resources.raw.gold === 0)\n      && (planet.resources.raw.uranium === 0)) {\n      const planetSprite = getPlanetSprite(planet);\n      for (const buildingSprite of planetSprite.children) {\n        // all animated sprites stop (this may not be true if new building types are added)\n        if (buildingSprite.animationSpeed) {\n          buildingSprite.animationSpeed = 0;\n        }\n      }\n    }\n  } // for planet\n}\n\nfunction mineResource(planet, resourceType, amount) {\n  if (planet.resources.raw[resourceType] > 0) {\n    planet.resources.raw[resourceType] -= amount;\n    planet.resources.stored[resourceType] += amount;\n    if (planet.resources.raw[resourceType] <= 0) {\n      planet.resources.raw[resourceType] = 0;\n    }\n    addMiningXp(amount, planet);\n  }\n}\n\nfunction addMiningXp(amount, planet) {\n  let blueprints = window.world.blueprints;\n  const xp = blueprints.xp[planet.spriteFile] += amount;\n  let nextLevel = blueprints.xpLevels[planet.spriteFile][0];\n  if (nextLevel && (nextLevel.xp <= xp)) {\n    addBlueprint(nextLevel);\n    // Remove the item\n    blueprints.xpLevels[planet.spriteFile].shift();\n  }\n}\n\nexport function addAlienXp(ship) {\n  let blueprints = window.world.blueprints;\n  let xp = blueprints.xp[ship.name];\n  if (!xp) {\n    xp = 1;\n  }  else {\n    xp += 1;\n  }\n  blueprints.xp[ship.name] = xp;\n  if (blueprints.xpLevels[ship.name]) {\n    let nextLevel = blueprints.xpLevels[ship.name][0];\n    if (nextLevel && (nextLevel.xp <= xp)) {\n      addBlueprint(nextLevel);\n      // Remove the item\n      blueprints.xpLevels[ship.name].shift();\n    }\n  }\n}\n\nexport function addBlueprint(nextLevel) {\n  utils.showToast('New plan: ' + nextLevel.obj.name);\n  let blueprints = window.world.blueprints;\n  if (nextLevel.obj.objType === c.OBJ_EQUIP) {\n    blueprints.equip.push(nextLevel.obj);\n  } else if (nextLevel.obj.objType === c.OBJ_SHIP) {\n    blueprints.ship.push(nextLevel.obj);\n  } else {\n    console.warn(\"Could not find blueprint of type \" + nextLevel.obj.objType + \" nextLevel=\", nextLevel);\n  }\n}\n\n/**\n * Checks if the combined resources of planet and ship can afford the resources\n * Call this before calling payResourceCost\n * @return true if there are enough resources available\n */\nexport function canAfford(planet, ship, resources) {\n  let titanium = 0;\n  let gold = 0;\n  let uranium = 0;\n  if (planet) {\n    titanium += planet.resources.stored.titanium;\n    gold += planet.resources.stored.gold;\n    uranium += planet.resources.stored.uranium;\n  }\n  if (ship) {\n    titanium += ship.resources.titanium;\n    gold += ship.resources.gold;\n    uranium += ship.resources.uranium;\n  }\n  return (titanium >= resources.titanium)\n    && (gold >= resources.gold)\n    && (uranium >= resources.uranium);\n}\n\n/**\n * Pays the cost, taking from the planet and the ship as available\n * NOTE: This will not ensure you have enough resources, you can go into debt if you call this without checking\n * first using canAfford()\n * @param planet planet to get resources from\n * @param ship ship to get resources from\n * @param resources amount to pay\n */\nexport function payResourceCost(planet, ship, resources) {\n  payResource(planet, ship, 'titanium', resources.titanium);\n  payResource(planet, ship, 'gold', resources.gold);\n  payResource(planet, ship, 'uranium', resources.uranium);\n}\n\nexport function payResource(planet, ship, resourceType, amount) {\n  let paid = -amount; // amount owing (overwritten if some payment comes from the planet)\n  if (planet) {\n    paid = planet.resources.stored[resourceType] - amount;\n    if (paid >= 0) {\n      planet.resources.stored[resourceType] -= amount;\n      return;\n    } else {\n      // Planet can't afford this purchase, take some from the ship\n      planet.resources.stored[resourceType] = 0;\n    }\n  }\n  if (ship) {\n    ship.resources[resourceType] = ship.resources[resourceType] + paid;\n    if (ship.resources[resourceType] < 0) {\n      console.warn(\"Ship is in debt \" + ship.resources[resourceType] + \" \" + resourceType);\n    }\n  } else if (paid < 0) {\n    planet.resources.stored[resourceType] = planet.resources.stored[resourceType] + paid;\n    console.warn(\"Planet is in debt \" + planet.resources.stored[resourceType] + \" \" + resourceType);\n  }\n}\n\nexport function setupExplosionSheet() {\n  window.world.system.explosionSheet = window.PIXI.Loader.shared.resources[c.CRASH_JSON].spritesheet;\n  // Preload an explosion sprite animation (these will be cached and reused in world.system.explosions)\n  createExplosionSprite();\n}\n\nexport function createExplosionSprite() {\n  let sprite = new window.PIXI.AnimatedSprite(window.world.system.explosionSheet.animations[c.CRASH]);\n  sprite.animationSpeed = 0.4;\n  sprite.loop = false;\n  sprite.anchor.set(0.5, 0.5);\n  sprite.scale.set(2, 2);\n  sprite.x = c.HALF_SCREEN_WIDTH;\n  sprite.y = c.HALF_SCREEN_WIDTH;\n  sprite.loop = true;\n  sprite.visible = false;\n  window.world.system.explosions.push(sprite);\n  window.world.system.spriteContainers.explosions.addChild(sprite);\n  return sprite;\n}\n","import {ai, c, game, manage, utils} from './';\n\nexport function enterFlyState() {\n  console.log(\"Take off\");\n}\n\n// Main play mode - flying\nexport function flyLoop(delta) {\n  if (delta > 1.005) {\n    console.log('Lagging with delta=' + delta);\n  }\n  let world = window.world;\n  let ship = window.world.ship;\n\n  // Cache all the nearby planets and ships\n  setupNearby();\n\n  // When ship.alive is false the ship is exploding\n  if (ship.alive) {\n    runDroids(ship);\n    // Keypress handling\n    if (world.system.keys.left.isDown || world.system.keys.a.isDown) {\n      turnShip(ship, true);\n    }\n    if (world.system.keys.right.isDown || world.system.keys.d.isDown) {\n      turnShip(ship, false);\n    }\n    if (world.system.keys.up.isDown || world.system.keys.w.isDown) {\n      propelShip(ship);\n    }\n    if (world.system.keys.down.isDown || world.system.keys.s.isDown) {\n      brakeShip(ship);\n    }\n    if (world.system.keys.space.isDown) {\n      firePrimaryWeapon(ship, 0.05);\n    }\n    if (world.system.keys.x.isDown) {\n      fireSecondaryWeapon(ship);\n    }\n    if (world.system.keys.q.isDown) {\n      thrustShip(ship, true);\n    }\n    if (world.system.keys.e.isDown) {\n      thrustShip(ship, false);\n    }\n\n    // Find planets in view\n    let planetsInView = [];\n    for (let planet of world.system.nearby.planets) {\n      if (planetInView(ship, planet)) {\n        planetsInView.push(planet);\n      }\n    }\n\n    // Gravity\n    for (let planet of planetsInView) {\n      let grav = utils.calcGravity(ship.x, ship.y, planet);\n      ship.vx += grav.x;\n      ship.vy += grav.y;\n    }\n\n    // move the ship\n    ship.x += ship.vx;\n    ship.y += ship.vy;\n    world.view.x = ship.x;\n    world.view.y = ship.y;\n\n    let shipSprite = game.getShipSprite(ship);\n    shipSprite.rotation = ship.rotation;\n\n    // Don't detect collisions until all the drawing is done\n    // Pixijs sometimes gets the sprite locations wrong when they haven't been rendered yet\n    if (!world.system.initializing) {\n      // Ship-Planet Collisions\n      for (let planet of planetsInView) {\n        if (detectCollisionWithPlanet(ship, shipSprite, planet)) {\n          landShip(ship, planet);\n          return; // exit loop\n        }\n      } // for planet\n      // Ship-Alien collision\n      for (let alien of world.system.nearby.ships) {\n        if (alien.alive && detectCollisionWithAlien(ship, shipSprite, alien)) {\n          shipsCollide(ship, alien);\n        }\n      }\n    }\n  }\n\n  moveExplosions(); // especially alien explosions\n  moveBackground(ship);\n  drawMiniMap();\n  // first draw is done\n  if (world.system.initializing) {\n    world.system.initializing = false;\n  }\n}\n\n\n/**\n * Creates a cache of all nearby planets and ships\n */\nexport function setupNearby() {\n  const nearby = window.world.system.nearby;\n  const ship = window.world.ship;\n  const minX = ship.x - c.NEARBY_WIDTH / 2;\n  const maxX = ship.x + c.NEARBY_WIDTH / 2;\n  const minY = ship.y - c.NEARBY_HEIGHT / 2;\n  const maxY = ship.y + c.NEARBY_HEIGHT / 2;\n\n  nearby.planets = [];\n  // for every planet\n  for (const planet of window.world.planets) {\n    if ((planet.x + planet.radius >= minX) && (planet.x - planet.radius <= maxX) &&\n      (planet.y + planet.radius >= minY) && (planet.y - planet.radius <= maxY)) {\n      nearby.planets.push(planet);\n    }\n  } // for planet\n\n  // for every ship\n  nearby.ships = [window.world.ship]; // ship is always nearby\n  for (const ship of window.world.ships) {\n    if ((ship.x + ship.radius >= minX) && (ship.x - ship.radius <= maxX) &&\n      (ship.y + ship.radius >= minY) && (ship.y - ship.radius <= maxY)) {\n      nearby.ships.push(ship);\n    }\n  } // for ship\n}\n\n/**\n * Redraw all planets and aliens\n */\nexport function repositionScreen() {\n  const ship = window.world.ship;\n  // Reposition all the planets\n  for (let planet of window.world.planets) {\n    planetInView(ship, planet);\n  }\n  for (const ship of window.world.ships) {\n    if (ship.spriteId) {\n      game.getShipSprite(ship).visible = false;\n      ship.spriteId = null;\n    }\n  }\n  setupNearby();\n  // Reposition all the aliens\n  ai.moveAliens();\n  drawMiniMap();\n}\n\n/**\n * Cools all ship weapons, run in mainLoop\n */\nexport function coolAllWeapons() {\n  // Ship is in nearby\n  for (let ship of window.world.system.nearby.ships) {\n    coolWeapons(ship);\n  }\n}\n\n/**\n * called in flyLoop to cool weapons\n */\nexport function coolWeapons(ship) {\n  for (let equip of ship.equip) {\n    // If equip has a cool time\n    if (equip.cool) {\n      equip.cool -= 1;\n    }\n    // Gunnery Droids are equip with weapons\n    if (equip.weapon && equip.weapon.cool) {\n      equip.weapon.cool -= 1;\n    }\n    if (equip.shield && equip.shield.active) {\n      equip.shield.lifetime -= 1;\n      if (equip.shield.lifetime <= 0) {\n        equip.shield.lifetime = 0;\n        disableShield(ship, equip.shield);\n      }\n    }\n  }\n}\n\nexport function resetWeaponsCool(ship) {\n  for (let equip of ship.equip) {\n    if ((equip.type === c.EQUIP_TYPE_PRIMARY_WEAPON) && (equip.cool > 0)) {\n      equip.cool = 0;\n    }\n  }\n}\n\nexport function runDroids(ship) {\n  for (let droid of ship.equip) {\n    if ((droid.type === c.EQUIP_TYPE_REPAIR_DROID) && (ship.armor < ship.armorMax)) {\n      let cost = {titanium: 0, gold: 0, uranium: 0};\n      if (game.canAfford(null, ship, cost)) {\n        ship.armor += droid.repairSpeed;\n        game.payResourceCost(null, ship, cost);\n      }\n    } else if (droid.type === c.EQUIP_TYPE_GUNNERY_DROID) {\n      shootAtNearestAlien(ship, droid.weapon);\n    }\n    // NOTE: Shield droid runs in checkForBulletCollision\n  } // for\n}\n\n/**\n * Fires the weapon in the direction of the nearest alien (if able to )\n */\nexport function shootAtNearestAlien(ship, weapon) {\n  // If we can't shoot, don't waste our time\n  if (weapon.cool > 0) {\n    return;\n  }\n  let nearestAlien = null;\n  let nearestAlienDist = null;\n  for (let alien of window.world.system.nearby.ships) {\n    if (alien.alive && alien.owner === c.ALIEN) {\n      let dist = utils.distanceBetween(ship.x, ship.y, alien.x, alien.y);\n      if (!nearestAlien || (dist < nearestAlienDist)) {\n        nearestAlien = alien;\n        nearestAlienDist = dist;\n      }\n    }\n  } // for\n  if (nearestAlien && (nearestAlienDist <= weaponRange(weapon))) {\n    const origDir = ship.rotation;\n    ship.rotation = utils.normalizeRadian(Math.atan2(nearestAlien.y - ship.y, nearestAlien.x - ship.x));\n    fireWeapon(weapon, ship, 0.1);\n    ship.rotation = origDir;\n  }\n}\n\nexport function moveBackground(ship) {\n  let bgSprite = window.world.system.bgSprite;\n  bgSprite.tilePosition.x = (100 - ship.x) + c.HALF_SCREEN_WIDTH;\n  bgSprite.tilePosition.y = (100 - ship.y) + c.HALF_SCREEN_HEIGHT;\n}\n\n/**\n * @return true if the planet is in view of the ship, false otherwise\n * NOTE: This will set the sprite.visible and sprite x/y attributes for the planet\n */\nexport function planetInView(ship, planet) {\n  // Right side\n  if ((ship.x + c.HALF_SCREEN_WIDTH + planet.radius < planet.x) || // Right\n    (ship.x - c.HALF_SCREEN_WIDTH - planet.radius > planet.x) || // Left\n    (ship.y + c.HALF_SCREEN_HEIGHT + planet.radius < planet.y) || // Bottom\n    (ship.y - c.HALF_SCREEN_HEIGHT - planet.radius > planet.y)) { // Top\n    // Planet is not currently visible, but if it has an Id then it used to be visible\n    if (planet.spriteId) {\n      const sprite = game.getPlanetSprite(planet);\n      if (sprite.visible) {\n        sprite.visible = false;\n      }\n    }\n    return false;\n  }\n  // Here we know this planet is in view\n  const sprite = game.getPlanetSprite(planet);\n  sprite.visible = true;\n  // Set planet relative to the ship's viewport\n  sprite.x = (planet.x - ship.x) + c.HALF_SCREEN_WIDTH;\n  sprite.y = (planet.y - ship.y) + c.HALF_SCREEN_HEIGHT;\n  return true;\n}\n\n/**\n * @return the first active shield the ship is equipped with\n * NOTE: This returns equip.shield (NOT the full equip object)\n */\nexport function getActiveShield(ship) {\n  for (const equip of ship.equip) {\n    if (equip.shield && equip.shield.active) {\n      return equip.shield;\n    }\n  }\n  return null;\n}\n\n/**\n * @returns The first shield that is not currently used and cooled enough to re-use\n * NOTE: This returns the whole equip (not just the shield)\n */\nexport function getAvailableShieldEquip(ship) {\n  for (const equip of ship.equip) {\n    if (equip.shield && !equip.shield.active && equip.cool === 0) {\n      return equip;\n    }\n  }\n  return null;\n}\n\n/**\n * @returns true if the ship is equipped with a shield droid\n */\nexport function hasShieldDroid(ship) {\n  for (const equip of ship.equip) {\n    if (equip.type === c.EQUIP_TYPE_SHIELD_DROID) {\n      return equip;\n    }\n  }\n  return null;\n}\n\n/**\n * @return the first active shield equip in the ship, and if none are active, returns the first shield it finds.\n * returns an equip (not equip.shield like getActiveShield)\n */\nexport function getEquippedShield(ship) {\n  let shield = null;\n  for (const equip of ship.equip) {\n    if (equip.shield) {\n      shield = equip;\n      if (equip.shield.active) {\n        return shield;\n      }\n    }\n  } // for equip\n  return shield;\n}\n\n// Returns true if there is a collision and false otherwise\nexport function detectCollisionWithPlanet(ship, shipSprite, planet) {\n  const shield = getActiveShield(ship);\n  if (shield) {\n    // shield collision is round\n    return utils.distanceBetween(ship.x, ship.y, planet.x, planet.y) < (planet.radius + shield.radius);\n  }\n  // [[x,y],[x,y]]\n  let collisionPoints = utils.getVertexData(ship.x, ship.y, shipSprite);\n  for (let point of collisionPoints) {\n    let dist = utils.distanceBetween(point[0], point[1], planet.x, planet.y);\n    if (dist < planet.radius - c.ALLOWED_OVERLAP) {\n      return true;\n    }\n  }\n  return false;\n}\n\n// Returns true if there is a collision and false otherwise\nexport function detectCollisionWithAlien(ship, shipSprite, alien) {\n  if (ship === alien) {\n    return false;\n  }\n  const shield = getActiveShield(ship);\n  if (shield) {\n    // shield collision is round\n    return utils.distanceBetween(ship.x, ship.y, alien.x, alien.y) < (alien.radius + shield.radius);\n  }\n  let collisionPoints = utils.getVertexData(ship.x, ship.y, shipSprite);\n  for (let point of collisionPoints) {\n    // Only works with circular aliens (need different logic for squares)\n    if (alien.radius) {\n      let dist = utils.distanceBetween(point[0], point[1], alien.x, alien.y);\n      if (dist < alien.radius - c.ALLOWED_OVERLAP) {\n        return true;\n      }\n    }\n  }\n  return false;\n}\n\n/**\n * Land the ship on the planet\n * NOTE: This will cause damage to the ship attempting to land (side-effects)\n */\nfunction landShip(ship, planet) {\n  // atan2 has parameters (y,x)\n  let planetDir = utils.normalizeRadian(Math.atan2(ship.y - planet.y, ship.x - planet.x));\n  let dirDiff = Math.abs(ship.rotation - planetDir);\n  let speed = Math.abs(ship.vx) + Math.abs(ship.vy);\n  // 0 and PI*2 are right beside each other, so large values are very close to small values\n  let success = ((dirDiff < ship.crashAngle) || (dirDiff > (Math.PI * 2 - ship.crashAngle))) &&\n                (speed < ship.crashSpeed);\n  const hasAutolander = !!getEquip(ship, c.EQUIP_TYPE_AUTOLANDER);\n  // Stop moving\n  ship.vx = 0;\n  ship.vy = 0;\n  if (!success && !hasAutolander) {\n    // The landing was rough - do damage\n    let speedDiff = Math.max(speed - ship.crashSpeed, 0); // 0 if negative\n    let dirDiffAdj = Math.max(dirDiff - ship.crashAngle, 0); // 0 if negative\n    if (dirDiffAdj > Math.PI) {\n      dirDiffAdj = (Math.PI * 2) - dirDiff - ship.crashAngle;\n    }\n    let dmgPct = (speedDiff / 3) + dirDiffAdj;\n    let dmg = dmgPct * ship.armorMax;\n    damageShip(ship, dmg, resetGame);\n  }\n  // Disable shields when landing\n  const shield = getActiveShield(ship);\n  if (shield) {\n    disableShield(ship, shield);\n  }\n  // If the ship survived the landing\n  if (ship.armor > 0) {\n    window.world.selectedPlanet = planet; // currently selected planet (for manage UI)\n    window.world.lastPlanetLanded = planet; // last planet landed on\n    //Set ship position and angle on the planet surface\n    let dir = utils.directionTo(planet.x, planet.y, ship.x, ship.y)\n    let r = planet.radius + ship.spriteWidth / 2;\n    let {xAmt, yAmt} = utils.dirComponents(dir, r);\n    ship.x = planet.x + xAmt;\n    ship.y = planet.y + yAmt;\n    ship.rotation = dir;\n    planet.lastLandingDir = dir;\n    game.getShipSprite(ship).rotation = dir;\n    repositionScreen();\n    game.changeGameState(c.GAME_STATE.MANAGE);\n  }\n}\n\nexport function getExplosionSprite(ship) {\n  let sprite = null;\n  for (let explosionSprite of window.world.system.explosions) {\n    if (!explosionSprite.visible) {\n      sprite = explosionSprite;\n      break;\n    }\n  }\n  if (!sprite) {\n    sprite = game.createExplosionSprite();\n  }\n  let playerShip = window.world.ship;\n  sprite.visible = true;\n  sprite.globalX = ship.x;\n  sprite.globalY = ship.y;\n  sprite.x = (ship.x - playerShip.x) + c.HALF_SCREEN_WIDTH;\n  sprite.y = (ship.y - playerShip.y) + c.HALF_SCREEN_HEIGHT;\n  return sprite\n}\n\n/**\n * Destroys the ship playing an explosion animation\n * @param ship: the one to explode\n * @param afterExplosion: function to run after exploding (or null if nothing to do)\n */\nexport function destroyShip(ship, afterExplosion) {\n  if (ship.owner === c.ALIEN) {\n    game.addAlienXp(ship);\n  }\n  let explosionSprite = getExplosionSprite(ship);\n  const shipSprite = game.getShipSprite(ship);\n  shipSprite.visible = false;\n  ship.alive = false;\n  ship.spriteId = null;\n  explosionSprite.play();\n  // This function runs after the animation finishes a loop\n  explosionSprite.onLoop = () => {\n    explosionSprite.stop(); // pause until we crash again\n    explosionSprite.visible = false;\n    if (afterExplosion) {\n      afterExplosion();\n    }\n  };\n}\n\nfunction resetGame() {\n  // loadNewShip will setup a new ship but not position it\n  let ship = window.world.ship;\n  let planet = window.world.selectedPlanet;\n  // The current ship is gone\n  ship.resourcesMax = 0;\n  ship.resources = {titanium: 0, gold: 0, uranium: 0};\n  ship.equip = [];\n  ship.armorMax = 0;\n  ship.armor = 0;\n\n  // If the most recently used planet doesn't have any buildings\n  if (!planet || (planet.buildings.length === 0)) {\n    // find a planet with a mine\n    for (let planet of window.world.planets) {\n      if (planet.buildings.length > 0) {\n        window.world.selectedPlanet = planet;\n        break;\n      }\n    }\n    // No buildings on any planet- game over! \n    if (!planet) {\n      window.world.selectedPlanet = window.world.planets[0];\n    }\n  }\n  let {x, y, rotation} = manage.getAvailablePlanetXY(planet, ship, planet.lastLandingDir, 20, 0);\n  ship.x = x;\n  ship.y = y;\n  ship.vx = 0;\n  ship.vy = 0;\n  ship.rotation = rotation;\n  repositionScreen();\n  game.changeGameState(c.GAME_STATE.MANAGE);\n}\n\n/**\n * Explosion position update on screen as ship moves\n * This is called in the fly loop\n */\nfunction moveExplosions() {\n  let ship = window.world.ship;\n  for (let sprite of window.world.system.explosions) {\n    sprite.x = (sprite.globalX - ship.x) + c.HALF_SCREEN_WIDTH;\n    sprite.y = (sprite.globalY - ship.y) + c.HALF_SCREEN_HEIGHT;\n  }\n}\n\nfunction turnShip(ship, left) {\n  let turnSpeed = ship.turnSpeed;\n  for (const equip of ship.equip) {\n    if (equip.type === c.EQUIP_TYPE_TURN && equip.boostSpeed) {\n      turnSpeed += equip.boostSpeed;\n    }\n  }\n  ship.rotation = utils.normalizeRadian(ship.rotation + turnSpeed * (left ? -1 : 1));\n}\n\nfunction propelShip(ship) {\n  let propulsion = ship.propulsion;\n  for (const equip of ship.equip) {\n    if (equip.type === c.EQUIP_TYPE_SPEED && equip.boostSpeed) {\n      propulsion += equip.boostSpeed;\n    }\n  }\n  ship.vx += propulsion * Math.cos(ship.rotation);\n  ship.vy += propulsion * Math.sin(ship.rotation);\n}\n\nfunction brakeShip(ship) {\n  let brake = getEquip(ship, c.EQUIP_TYPE_BRAKE);\n  if (brake) {\n    if (brake.brakeSpeedPct > 0) {\n      ship.vx -= ship.vx * brake.brakeSpeedPct;\n      ship.vy -= ship.vy * brake.brakeSpeedPct;\n    } else {\n      // Blink brake pct is 0, immediate stop (no momentum)\n      ship.vx = 0;\n      ship.vy = 0;\n    }\n  }\n}\n\nfunction thrustShip(ship, left) {\n  let thruster = getEquip(ship, c.EQUIP_TYPE_THRUSTER);\n  if (thruster) {\n    let dir = utils.normalizeRadian(ship.rotation + ((left ? -1 : 1) * Math.PI / 2)); // 90 deg turn\n    const thrustX = thruster.thrustSpeed * Math.cos(dir);\n    const thrustY = thruster.thrustSpeed * Math.sin(dir);\n    if (thruster.thrustType === c.THRUST_MOMENTUM) {\n      ship.vx += thrustX;\n      ship.vy += thrustY\n    } else if (thruster.thrustType === c.THRUST_BLINK) {\n      ship.x += thrustX;\n      ship.y += thrustY;\n    } else {\n      console.warn(\"Unable to use thruster with type \" + thruster.thrustType);\n    }\n  }\n}\n\n/**\n * Fires the weapon from the location and direction of the ship\n */\nexport function fireWeapon(weapon, ship, jitter) {\n  if (weapon && (weapon.cool <= 0)) {\n    fireBullet(ship, weapon, jitter);\n    weapon.cool = weapon.coolTime; // this is decremented in coolWeapons\n  }\n}\n\nexport function firePrimaryWeapon(ship, jitter) {\n  let gun = getEquip(ship, c.EQUIP_TYPE_PRIMARY_WEAPON);\n  if (gun) {\n    fireWeapon(gun, ship, gun.jitter ? gun.jitter : jitter);\n  }\n}\n\nexport function getSecondaryWeapon(ship) {\n  if (!ship.selectedSecondaryWeaponIndex || ship.selectedSecondaryWeaponIndex < 0) {\n    // Just find any secondary weapon - none was selected\n    return getEquip(ship, c.EQUIP_TYPE_SECONDARY_WEAPON);\n  }\n  // Find the equipped weapon\n  const equip = ship.equip[ship.selectedSecondaryWeaponIndex];\n  if (equip.type !== c.EQUIP_TYPE_SECONDARY_WEAPON) {\n    manage.selectFirstSecondaryWeapon(ship);\n    return getEquip(ship, c.EQUIP_TYPE_SECONDARY_WEAPON);\n  }\n  return equip;\n}\n\nexport function fireSecondaryWeapon(ship) {\n  let weapon = getSecondaryWeapon(ship);\n  if (weapon && (weapon.cool <= 0)) {\n    if (weapon.createShip) {\n      if (!game.canAfford(null, ship, weapon.createShip.type.cost)) {\n        // We don't fire the weapon - we can't afford it\n        return;\n      }\n      game.payResourceCost(null, ship, weapon.createShip.type.cost);\n      const child = game.createShip(weapon.createShip.type, ship.owner);\n      const childSprite = game.getShipSprite(child);\n      const shipRadius = ship.spriteWidth || (ship.radius * 2);\n      const childDistFromShip = (shipRadius / 2) + (child.spriteWidth / 2) + 20;\n      const dir = weapon.createShip.dir === c.DIR_AHEAD_OF_SHIP ? utils.normalizeRadian(ship.rotation - Math.PI) : ship.rotation;\n      const {xAmt, yAmt} = utils.dirComponents(dir, childDistFromShip);\n      child.x = ship.x - xAmt;\n      child.y = ship.y - yAmt;\n      if (child.propulsion) {\n        child.vx = ship.vx;\n        child.vy = ship.vy;\n      }\n      child.rotation = utils.normalizeRadian(dir - Math.PI);\n      childSprite.x = (child.x - window.world.ship.x) + c.HALF_SCREEN_WIDTH;\n      childSprite.y = (child.y - window.world.ship.y) + c.HALF_SCREEN_HEIGHT;\n      childSprite.visible = true;\n      window.world.ships.push(child);\n      // Since it may not move we need to check if it collides with anything\n      ai.checkForCollisionWithPlanet(child);\n      ai.checkForCollisionWithShip(child);\n    }\n    if (weapon.shield) {\n      // If another shield is already in use - we won't reset the cool\n      if (getActiveShield(ship) !== null) {\n        return;\n      }\n      enableShield(ship, weapon.shield);\n    }\n    weapon.cool = weapon.coolTime; // this is decremented in coolWeapons\n  }\n}\n\n/**\n * Called to enable a ship's shield.\n * This will add a shield sprite to the ship and set it to visible\n */\nexport function enableShield(ship, shield) {\n  if (getActiveShield(ship) !== null) {\n    console.log('not enabling shield, as there is already one enabled')\n    return;\n  }\n  const shieldSprite = game.getShieldSprite(ship, shield);\n  shieldSprite.visible = true;\n  shield.active = true;\n  shield.lifetime = shield.lifetimeMax;\n  shield.armor = shield.armorMax;\n  // Increase the ship size to the size of the shield\n  ship.spriteWidth = shield.radius * 2;\n  ship.spriteHeight = shield.radius * 2;\n}\n\n/**\n * Called to disable, and stop drawing a shield on a ship\n */\nexport function disableShield(ship, shield) {\n  const shieldSprite = game.getShieldSprite(ship, shield);\n  shieldSprite.visible = false;\n  shield.active = false;\n  // Reset the ship size back to regular\n  const shipSprite = game.getShipSprite(ship);\n  ship.spriteWidth = shipSprite.width;\n  ship.spriteHeight = shipSprite.height;\n}\n\n/**\n * Fires a bullet from the ship\n */\nexport function fireBullet(ship, gun, jitter) {\n  let bullet = findOrCreateBullet(gun.bulletFile);\n  bullet.lifetime = gun.lifetime;\n  bullet.damage = gun.damage;\n  const jitterAmt = jitter ? (jitter * Math.random() * (utils.randomBool() ? -1 : 1)) : 0;\n  const rotation = ship.rotation + jitterAmt;\n  bullet.vx = ship.vx + gun.speed * Math.cos(rotation);\n  bullet.vy = ship.vy + gun.speed * Math.sin(rotation);\n  bullet.x = ship.x + Math.sqrt(ship.spriteWidth * ship.spriteWidth + ship.spriteHeight * ship.spriteHeight) / 2 * Math.cos(rotation);\n  bullet.y = ship.y + Math.sqrt(ship.spriteWidth * ship.spriteWidth + ship.spriteHeight * ship.spriteHeight) / 2 * Math.sin(rotation);\n}\n\n/**\n * Gets the next available bullet (one that is not visible)\n */\nfunction findOrCreateBullet(bulletFile) {\n  for (let bullet of window.world.system.bullets) {\n    if (!bullet.active && (bullet.fileName === bulletFile)) {\n      bullet.active = true;\n      bullet.sprite.visible = true;\n      return bullet;\n    }\n  }\n  // Create a new bullet\n  let bullet = {active: true, damage: 0, x: 0, y: 0, vx: 0, vy: 0, lifetime: 1, fileName: bulletFile};\n  // Setup sprite\n  let spritesheet = window.PIXI.loader.resources[c.SPRITESHEET_JSON];\n  let sprite = new window.PIXI.Sprite(spritesheet.textures[bulletFile]);\n  sprite.x = -100;\n  sprite.y = -100;\n  sprite.anchor.set(0.5, 0.5);\n  sprite.scale.set(0.5, 0.5);\n  window.world.system.spriteContainers.bullets.addChild(sprite);\n  bullet.sprite = sprite;\n  window.world.system.bullets.push(bullet);\n  return bullet;\n}\n\nfunction killBullet(bullet) {\n  bullet.active = false;\n  bullet.sprite.visible = false;\n  bullet.sprite.x = -100;\n  bullet.sprite.y = -100;\n  bullet.vx = 0;\n  bullet.vy = 0;\n}\n\n/**\n * Moves all the bullets (called every draw cycle from app.js mainLoop)\n */\nexport function moveBullets() {\n  let ship = window.world.ship;\n  for (let bullet of window.world.system.bullets) {\n    if (bullet.active) {\n      bullet.x = bullet.x + bullet.vx;\n      bullet.y = bullet.y + bullet.vy;\n      bullet.sprite.x = (bullet.x - ship.x) + c.HALF_SCREEN_WIDTH;\n      bullet.sprite.y = (bullet.y - ship.y) + c.HALF_SCREEN_HEIGHT;\n      bullet.lifetime = bullet.lifetime - 1;\n      if (bullet.lifetime <= 0) {\n        killBullet(bullet);\n      }\n      checkForBulletCollision(bullet);\n    }\n  } // for bullet\n}\n\nfunction checkForBulletCollision(bullet) {\n  let ship = window.world.ship;\n  // Collision with planet\n  for (let planet of window.world.system.nearby.planets) {\n    if (utils.distanceBetween(planet.x, planet.y, bullet.x, bullet.y) < planet.radius) {\n      killBullet(bullet);\n    }\n  }\n  // Collision with ship\n  if (ship.alive &&\n      // Initial check to see if the bullet is anywhere near the ship (before we do more expensive collision checks))\n      (bullet.x < ship.x + (ship.radius+10)) &&\n      (bullet.x > ship.x - (ship.radius+10)) &&\n      (bullet.y < ship.y + (ship.radius+10)) &&\n      (bullet.y > ship.y - (ship.radius+10))\n      ) {\n    const shipSprite = game.getShipSprite(ship);\n    const bulletWillHitShip = utils.pointInSprite(ship.x, ship.y, shipSprite, bullet.x, bullet.y);\n    let shield = getActiveShield(ship);\n    if (!shield && hasShieldDroid(ship)) {\n      const shieldEquip = getAvailableShieldEquip(ship);\n      if (shieldEquip && bulletWillHitShip) {\n        shieldEquip.cool = shieldEquip.coolTime;\n        enableShield(ship, shieldEquip.shield);\n        shield = shieldEquip.shield;\n      }\n    }\n    if (shield && utils.distanceBetween(ship.x, ship.y, bullet.x, bullet.y) < shield.radius) {\n      bulletHitShip(bullet, ship, resetGame);\n    } else if (bulletWillHitShip) {\n      bulletHitShip(bullet, ship, resetGame);\n    }\n  }\n  // Collision with alien ship\n  for (let alien of window.world.system.nearby.ships) {\n    if ((alien !== ship) && alien.alive && alien.radius &&\n      // Initial check to see if the bullet is anywhere near the alien (before we do more expensive collision checks))\n      (bullet.x < alien.x + (alien.radius+10)) &&\n      (bullet.x > alien.x - (alien.radius+10)) &&\n      (bullet.y < alien.y + (alien.radius+10)) &&\n      (bullet.y > alien.y - (alien.radius+10))\n    ) {\n      const shield = getActiveShield(alien);\n      if ((shield && utils.distanceBetween(alien.x, alien.y, bullet.x, bullet.y) < shield.radius) || // hit alien shield\n        (utils.distanceBetween(alien.x, alien.y, bullet.x, bullet.y) <= alien.radius)) { // hit alien ship\n        bulletHitShip(bullet, alien, null);\n      }\n    }\n  } // for alien\n}\n\n/**\n * Apply damage from bullet to ship, also kills the bullet\n */\nfunction bulletHitShip(bullet, ship, afterExplosion) {\n  damageShip(ship, bullet.damage, afterExplosion);\n  killBullet(bullet);\n}\n\n/**\n * applies damage to the ship, destroying the ship if needed\n */\nexport function damageShip(ship, damage, afterExplosion) {\n  const shield = getActiveShield(ship);\n  if (shield) {\n    shield.armor -= damage;\n    if (shield.armor <= 0) {\n      shield.armor = 0;\n      disableShield(ship, shield);\n    }\n  } else { // no shield\n    ship.armor = ship.armor - damage;\n    if (ship.armor <= 0) {\n      ship.armor = 0;\n      destroyShip(ship, afterExplosion);\n    }\n  }\n}\n\n/**\n * collision between player ship and alien (sometimes alien and alien)\n */\nexport function shipsCollide(ship, alien) {\n  if (ship === alien) {\n    return; // can't collide with yourself\n  }\n  let shipDamage = ship.armor;\n  let alienDamage = alien.armor;\n  damageShip(alien, shipDamage, (window.world.ship === alien) ? resetGame : null);\n  damageShip(ship, alienDamage, (window.world.ship === ship) ? resetGame : null);\n  // If you died hitting an alien, stop moving\n  if (!ship.alive) {\n    ship.vx = 0;\n    ship.vy = 0;\n  }\n}\n\n/**\n * @return matching acc equipment type if it is found, null otherwise\n */\nexport function getEquip(ship, equipType) {\n  for (let equip of ship.equip) {\n    if (equip.type === equipType) {\n      return equip;\n    }\n  }\n  return null;\n}\n\nexport function drawMiniMap() {\n  let g = window.world.system.miniMapGraphics;\n  let view = window.world.view;\n  let l = 0;\n  let t = c.SCREEN_HEIGHT - c.MINIMAP_HEIGHT;\n  let r = c.MINIMAP_WIDTH;\n  let b = c.SCREEN_HEIGHT;\n  g.clear();\n  // Background\n  g.beginFill(c.MINIMAP_BACKGROUND_COLOR);\n  g.lineStyle(1, c.MINIMAP_BORDER_COLOR);\n  g.drawRect(l, t, r, b);\n  g.endFill();\n  // Planets\n  for (let planet of window.world.planets) {\n    if (planetOnMap(view, planet)) {\n      let x = l + c.HALF_MINIMAP_WIDTH + ((planet.x - view.x) * c.MINIMAP_SCALE_X);\n      let y = t + c.HALF_MINIMAP_HEIGHT + ((planet.y - view.y) * c.MINIMAP_SCALE_Y);\n      const planetColor = window.world.selectedPlanet === planet ? c.MINIMAP_SELECTED_PLANET_COLOR : c.PLANET_COLORS[planet.spriteFile];\n      g.lineStyle(2, planetColor);\n      g.beginFill(planetColor);\n      g.drawCircle(x, y, planet.radius * c.MINIMAP_SCALE_X);\n      g.endFill();\n      // Buildings\n      for (let building of planet.buildings) {\n        let buildingX = l + c.HALF_MINIMAP_WIDTH + ((building.x - view.x) * c.MINIMAP_SCALE_X) - 1.5;\n        let buildingY = t + c.HALF_MINIMAP_HEIGHT + ((building.y - view.y) * c.MINIMAP_SCALE_Y) - 1.5;\n        g.lineStyle(1, c.MINIMAP_BUILDING_COLOR);\n        g.drawRect(buildingX, buildingY, 2, 2);\n      }\n    }\n  }\n  // Ship\n  const x = l + c.HALF_MINIMAP_WIDTH + ((window.world.ship.x - view.x) * c.MINIMAP_SCALE_X);\n  const y = t + c.HALF_MINIMAP_HEIGHT + ((window.world.ship.y - view.y) * c.MINIMAP_SCALE_Y);\n  g.lineStyle(1, c.MINIMAP_SHIP_COLOR);\n  g.beginFill(c.MINIMAP_SHIP_COLOR);\n  g.drawCircle(x, y, 2);\n  g.endFill();\n}\n\n/**\n * Handles clicks on the minimap\n */\nexport function clickOnMinimap(clickX, clickY) {\n  if (window.world.system.gameState === c.GAME_STATE.MANAGE) {\n    const view = window.world.view\n    let globalX = view.x + ((clickX - c.HALF_MINIMAP_WIDTH) * (1 / c.MINIMAP_SCALE_X));\n    let globalY = view.y + (((clickY - (c.SCREEN_HEIGHT - c.MINIMAP_HEIGHT)) - c.HALF_MINIMAP_HEIGHT) * (1 / c.MINIMAP_SCALE_X));\n    for (let planet of window.world.planets) {\n      if (utils.distanceBetween(globalX, globalY, planet.x, planet.y) <= planet.radius) {\n        window.world.selectedPlanet = planet;\n      }\n    }\n    view.x = globalX;\n    view.y = globalY;\n    drawMiniMap();\n  }\n}\n\nfunction planetOnMap(view, planet) {\n  // Right side\n  return !((view.x + c.HALF_MINIMAP_VIEW_WIDTH + planet.radius < planet.x) || // Right\n    (view.x - c.HALF_MINIMAP_VIEW_WIDTH - planet.radius > planet.x) || // Left\n    (view.y + c.HALF_MINIMAP_VIEW_HEIGHT + planet.radius < planet.y) || // Bottom\n    (view.y - c.HALF_MINIMAP_VIEW_HEIGHT - planet.radius > planet.y));\n}\n\n/**\n * @return the max range of the weapon\n */\nexport function weaponRange(weapon) {\n  if (!weapon) {\n    return 0;\n  }\n  // Not sure what the fudge factor is, but the range seems a little short without it\n  return weapon.speed * weapon.lifetime * 1.4;\n}\n\n/**\n * @return the max range of the primary weapon on the ship\n */\nexport function primaryWeaponRange(ship) {\n  let gun = getEquip(ship, c.EQUIP_TYPE_PRIMARY_WEAPON);\n  return weaponRange(gun);\n}","import { c, utils, fly, game } from './';\nimport lodash from 'lodash';\nimport {EQUIP_TYPE_BRAKE, EQUIP_TYPE_PRIMARY_WEAPON, EQUIP_TYPE_THRUSTER} from \"./constants\";\n\nexport function enterManageState() {\n  console.log(\"enter manage state\");\n}\n\n// When managing planet resources - loop runs 60/s\nexport function manageLoop(delta) {\n  if ((window.world.system.keys.up.isDown || window.world.system.keys.w.isDown)) {\n    if (window.world.ship.alive && !window.world.system.isTyping) {\n      takeOff();\n    }\n  }\n}\n\nfunction takeOff() {\n  let world = window.world;\n  let ship = world.ship;\n  game.changeGameState(c.GAME_STATE.FLY);\n  let gravity = utils.calcGravity(ship.x, ship.y, world.selectedPlanet);\n  ship.vx = gravity.x * -c.TAKEOFF_SPEED;\n  ship.vy = gravity.y * -c.TAKEOFF_SPEED;\n}\n\n/**\n * @return Correct set of constants for the building type.\n * Maybe these constants could be moved into a variable or something\n */\nfunction getBuildingInfo(buildingType) {\n  if (buildingType === c.BUILDING_TYPE_FACTORY) {\n    return {spriteScale:c.FACTORY_SCALE, spriteFile:c.FACTORY_FILE, animation:false};\n  } else if (buildingType === c.BUILDING_TYPE_MINE) {\n    return {spriteScale:c.MINE_SCALE, spriteFile:c.MINE_FILE, animation:true};\n  }\n  console.warn('Unknown building type ', buildingType);\n  return {}\n}\n\n/**\n * Creates a factory sprite and adds it to the planet container using the factory x,y and rotation\n * NOTE: The building x,y,rot need to be set before calling this\n * @param building building to build\n * @param planet planet to build on\n * @param planetSprite optional, if null this will lookup the sprite using getPlanetSprite()\n */\nexport function makeBuildingSprite(building, planet, planetSprite = null) {\n  const { spriteScale, spriteFile, animation } = getBuildingInfo(building.type);\n  let spritesheet = window.PIXI.Loader.shared.resources[c.SPRITESHEET_JSON].spritesheet;\n  let buildingSprite;\n  if (animation) {\n    buildingSprite = new window.PIXI.AnimatedSprite(spritesheet.animations[spriteFile]);\n    buildingSprite.animationSpeed = c.MINE_ANIMATION_SPEED;\n    buildingSprite.play();\n  } else {\n    buildingSprite = new window.PIXI.Sprite(spritesheet.textures[spriteFile]);\n  }\n  buildingSprite.anchor.set(0.5, 0.5);\n  buildingSprite.scale.set(spriteScale, spriteScale);\n  buildingSprite.rotation = building.rotation;\n  buildingSprite.x = (building.x - planet.x);\n  buildingSprite.y = (building.y - planet.y);\n  buildingSprite.visible = true;\n  if (!planetSprite) {\n    planetSprite = game.getPlanetSprite(planet);\n  }\n  planetSprite.addChild(buildingSprite);\n}\n\nexport function buildMine() {\n  let world = window.world;\n  let mine = {type: c.BUILDING_TYPE_MINE};\n  let planet = world.selectedPlanet;\n  let ship = world.ship;\n  // Place the mine (to the right of the ship)\n  const initRotation = getBuildingPlacementRotation(ship, planet, c.MINE_WIDTH);\n  // Calculate an X,Y point near the ship on surface of the planet\n  // NOTE: we use sprite.height for width because all sprites face to the right (0 rotation)\n  let {x,y,rotation} = getAvailablePlanetXY(planet, ship, initRotation, c.MINE_WIDTH, 0);\n  if (x === null) {\n    console.warn(\"Unable to place mine\");\n    return;\n  }\n  mine.width = c.MINE_WIDTH;\n  mine.x = x;\n  mine.y = y;\n  mine.rotation = rotation;\n  // Setup the graphics\n  makeBuildingSprite(mine, planet);\n  game.payResourceCost(planet, ship, c.MINE_COST);\n  planet.buildings.push(mine);\n  fly.drawMiniMap(); // add building to minimap\n}\n\n/**\n * @return the rotation direction of a place some distance to the right of the ship\n */\nexport function getBuildingPlacementRotation(ship, planet, distanceFromShip) {\n  let deg = ship.rotation + Math.PI/2; // 90 deg (right of the ship)\n  let degX = ship.x + distanceFromShip  * Math.cos(deg); // Some point Xpx to the right of the ship\n  let degY = ship.y + distanceFromShip * Math.sin(deg);\n  // Calculate the rotation direction to get to that point\n  return utils.normalizeRadian(Math.atan2(degY - planet.y, degX - planet.x));\n\n}\n\n/**\n * @return {x,y} for the next free space to the right of the ship on the planet circumfrence \n */\nexport function getAvailablePlanetXY(planet, ship, rotation, buildingWidth, count) {\n  if (buildingFits(planet, ship, rotation, buildingWidth)) {\n    let x = planet.x + ((planet.radius + 10) * Math.cos(rotation));\n    let y = planet.y + ((planet.radius + 10) * Math.sin(rotation));\n    return {x,y, rotation};\n  }\n  // If we have done a full circle then give up\n  if (count > (Math.PI*2 / c.BUILDING_PLACEMENT_ROTATION_INCREMENT)) {\n    return {x:null, y:null, rotation:null};\n  }\n  return getAvailablePlanetXY(planet, ship, rotation+c.BUILDING_PLACEMENT_ROTATION_INCREMENT\n    , buildingWidth, ++count);\n}\n\nexport function buildingFits(planet, ship, rotation, buildingWidth) {\n  let x = planet.x + ((planet.radius + 10) * Math.cos(rotation));\n  let y = planet.y + ((planet.radius + 10) * Math.sin(rotation));\n  // Min distance to building\n  let minDist = utils.distanceBetween(x,y, ship.x, ship.y);\n  let minBuildingWidth = buildingWidth;\n  for (let building of planet.buildings) {\n     let dist = utils.distanceBetween(x,y, building.x, building.y);\n     if (dist < minDist) {\n       minDist = dist;\n       minBuildingWidth = building.width;\n     }\n  } \n  return (minDist > (buildingWidth/2 + minBuildingWidth/2 + 15));\n}\n\n/**\n * Move a resource ship <-> planet \n */\nexport function transferResource(source, target, resourceType, requestedAmtStr, maxCapacity) {\n  let requestedAmt = Number(requestedAmtStr);\n  if (isNaN(requestedAmt)) {\n    requestedAmt = 0;\n  }\n  let amt = requestedAmt;\n  // requesting '' is requesting the entire source (same as requesting too much)\n  if (requestedAmtStr === '' || (source[resourceType] - requestedAmt < 0)) {\n    amt = source[resourceType];\n  }\n  // Cap to max capacity of target\n  if (maxCapacity !== null) {\n    let spaceLeft = maxCapacity - (target.titanium + target.gold + target.uranium);\n    if (spaceLeft < amt) {\n      amt = spaceLeft;\n    }\n  }\n  target[resourceType] += amt;\n  source[resourceType] -= amt;\n}\n\n/**\n * Move all resources to the planet\n */\nexport function unloadShip(ship, planet) {\n  transferResource(ship.resources, planet.resources.stored, 'titanium', ship.resources.titanium, null);\n  transferResource(ship.resources, planet.resources.stored, 'gold', ship.resources.gold, null);\n  transferResource(ship.resources, planet.resources.stored, 'uranium', ship.resources.uranium, null);\n}\n\n/**\n * Choose some default resources to resupply the ship with.\n * This is for quick restocking of resources\n * NOTE: This may need to do multiple passes to fill up the space properly especially when planets are low on uranium\n */\nexport function resupplyShip(ship, planet) {\n  const desiredAmt = Math.floor(ship.resourcesMax / 3);\n  let freeAmt = ship.resourcesMax - (ship.resources.titanium + ship.resources.gold + ship.resources.uranium);\n  if (freeAmt <= 0) {\n    // no space for more resources\n    return;\n  }\n  // 20 is the min required to build a mine - you probably want at least 20\n  const desiredTitanium = desiredAmt >= 20 ? desiredAmt : 20;\n  if (ship.resources.titanium < desiredTitanium) {\n    transferResource(planet.resources.stored, ship.resources, 'titanium', desiredTitanium - ship.resources.titanium, ship.resourcesMax);\n  }\n  if (ship.resources.gold < desiredAmt) {\n    transferResource(planet.resources.stored, ship.resources, 'gold', desiredAmt - ship.resources.gold, ship.resourcesMax);\n  }\n  // Fill up the rest of the space with uranium (it's the rarest)\n  freeAmt = ship.resourcesMax - (ship.resources.titanium + ship.resources.gold + ship.resources.uranium);\n  if (ship.resources.uranium < freeAmt) {\n    transferResource(planet.resources.stored, ship.resources, 'uranium', freeAmt, ship.resourcesMax);\n  }\n  // If we still have space\n  freeAmt = ship.resourcesMax - (ship.resources.titanium + ship.resources.gold + ship.resources.uranium);\n  if (freeAmt > 0) {\n    transferResource(planet.resources.stored, ship.resources, 'titanium', '', ship.resourcesMax);\n    transferResource(planet.resources.stored, ship.resources, 'gold', '', ship.resourcesMax);\n    transferResource(planet.resources.stored, ship.resources, 'uranium', '', ship.resourcesMax);\n  }\n}\n\nexport function buildFactory() {\n  let world = window.world;\n  let planet = world.selectedPlanet;\n  let ship = world.ship;\n  let factory = {type: c.BUILDING_TYPE_FACTORY};\n\n  // Place the mine (to the right of the ship)\n  const initialRotation = getBuildingPlacementRotation(ship, planet, c.FACTORY_WIDTH);\n  // Calculate an X,Y point near the ship on surface of the planet\n  // NOTE: we use sprite.height for width because all sprites face to the right (0 rotation)\n  let {x,y,rotation} = getAvailablePlanetXY(planet, ship, initialRotation, c.FACTORY_WIDTH, 0);\n  if (x === null) {\n    console.warn(\"Unable to place factory\");\n    return;\n  }\n  factory.width = c.MINE_WIDTH;\n  factory.x = x;\n  factory.y = y;\n  factory.rotation = rotation;\n  planet.buildings.push(factory);\n\n  // Setup the graphics\n  makeBuildingSprite(factory, planet);\n\n  game.payResourceCost(planet, ship, c.FACTORY_COST);\n  fly.drawMiniMap(); // add to minimap\n}\n\n/**\n * Called when the factory finishes building a new ship \n */\nexport function buildShip(shipTemplate) {\n  let world = window.world;\n  let planet = world.selectedPlanet;\n  let newShip = game.createShip(shipTemplate, c.PLAYER);\n  planet.ships.push(newShip);\n}\n\n/**\n * Called when the user clicks to switch to a new ship \n * NOTE: the new ship should already be created and stored in a planet\n */\nexport function switchToShip(newShip) {\n  let oldShip = window.world.ship;\n  let selectedPlanet = window.world.selectedPlanet;\n  let lastPlanetLanded = window.world.lastPlanetLanded;\n  if (!removeShipFromStorage(newShip, selectedPlanet)) {\n    console.warn(\"Unable to remove ship from planet \",newShip,\" planet=\",selectedPlanet);\n    return;\n  }\n  addShipToStorage(oldShip, lastPlanetLanded);\n\n  window.world.ship = newShip;\n  // check to ensure oldShip is not destroyed\n  if (oldShip && oldShip.alive && oldShip.spriteId) {\n    fly.resetWeaponsCool(oldShip);\n    const oldShipSprite = game.getShipSprite(oldShip);\n    oldShipSprite.visible = false;\n    oldShip.spriteId = null;\n  }\n  // Get the new sprite (adds it to the container)\n  const newShipSprite = game.getShipSprite(newShip);\n  newShipSprite.visible = true;\n  newShip.rotation = selectedPlanet.lastLandingDir;\n  newShipSprite.rotation = newShip.rotation;\n  newShipSprite.position.set(c.HALF_SCREEN_WIDTH, c.HALF_SCREEN_HEIGHT);\n\n  let r = selectedPlanet.radius + (newShip.spriteWidth / 2);\n  newShip.x = selectedPlanet.x + (r * Math.cos(newShip.rotation));\n  newShip.y = selectedPlanet.y + (r * Math.sin(newShip.rotation));\n  window.world.lastPlanetLanded = selectedPlanet;\n  fly.repositionScreen();\n}\n\n/**\n * Removes a ship from the planet, returns null if no matching ship was found\n */\nexport function removeShipFromStorage(ship, planet) {\n  let ships = planet.ships.filter((s) => s !== ship);\n  let removedShip = ships.length < planet.ships.length;\n  planet.ships = ships;\n  return removedShip;\n}\n\nexport function addShipToStorage(ship, planet) {\n  // If the ship is not visible (and armorMax is zero) it has been destroyed\n  // Some ships might be non-visible because they are not currently being used\n  if (ship.alive && ship.armorMax > 0) {\n    planet.ships.push(ship);\n  }\n}\n\n/**\n * @return true if the planet has a factory for the player\n */\nexport function hasFactory(planet) {\n  for (let building of planet.buildings) {\n    if (building.type === c.BUILDING_TYPE_FACTORY) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Create a new piece of equipment from the template\n */\nexport function makeEquip(equipTemplate) {\n  let equip = lodash.cloneDeep(equipTemplate);\n  equip.id = window.world.nextId++;\n  return equip;\n}\n\nexport function buildEquip(equipTemplate) {\n  let planet = window.world.selectedPlanet;\n  planet.equip.push(makeEquip(equipTemplate));\n}\n\nexport function costToRepair(ship) {\n  const damageToRepair = ship.armorMax - ship.armor;\n  return {titanium:(damageToRepair / 5), gold:0, uranium:0};\n}\n\nexport function repairShip(ship, planet) {\n  let cost = costToRepair(ship);\n  let addArmor = ship.armorMax - ship.armor; // armor needed\n  if (!game.canAfford(planet, ship, cost)) {\n    let titaniumOnHand = planet.resources.stored.titanium + ship.resources.titanium;\n    cost.titanium = titaniumOnHand;\n    addArmor = titaniumOnHand;\n  } \n  game.payResourceCost(planet, ship, cost);\n  ship.armor += addArmor;\n}\n\nexport function addEquip(ship, newEquip) {\n  if (newEquip.type === c.EQUIP_TYPE_ARMOR) {\n    // Only add armor if the ship is in full repair\n    if (ship.armor === ship.armorMax) {\n      ship.armor += newEquip.armorAmt;\n    }\n    ship.armorMax += newEquip.armorAmt;\n  } else if (newEquip.type === c.EQUIP_TYPE_STORAGE) {\n    ship.resourcesMax += newEquip.storageAmount;\n  }\n}\n\nexport function selectFirstSecondaryWeapon(ship) {\n  for (let i=0; i< ship.equip.length; i++) {\n    if (ship.equip[i].type === c.EQUIP_TYPE_SECONDARY_WEAPON) {\n      ship.selectedSecondaryWeaponIndex = i;\n      return;\n    }\n  } // for\n  // Couldn't find a secondary weapon\n  ship.selectedSecondaryWeaponIndex = -1;\n}\n\nexport function moveEquipFromPlanetToShip(ship, planet, equipToMove) {\n  // Remove from the planet\n  ship.equip.push(equipToMove);\n  addEquip(ship, equipToMove);\n  // Remove the oldEquip from the planet\n  lodash.remove(planet.equip, (e) => e.id === equipToMove.id);\n  selectFirstSecondaryWeapon(ship);\n}\n\nexport function moveEquipFromShipToPlanet(ship, planet, equipToMove) {\n  // Add to the planet\n  planet.equip.push(equipToMove);\n  if (equipToMove.type === c.EQUIP_TYPE_ARMOR) {\n    ship.armorMax -= equipToMove.armorAmt;\n    if (ship.armor > ship.armorMax) {\n      ship.armor = ship.armorMax;\n    }\n  } else if (equipToMove.type === c.EQUIP_TYPE_STORAGE) {\n    ship.resourcesMax -= equipToMove.storageAmount;\n    let shipResources = ship.resources.titanium + ship.resources.gold + ship.resources.uranium;\n    if (shipResources > ship.resourcesMax) {\n      let owing = this.removeResource(ship, 'titanium', (shipResources - ship.resourcesMax));\n      if (owing > 0) {\n        owing = this.removeResource(ship, 'gold', owing);\n      }\n      if (owing > 0) {\n        owing = this.removeResource(ship, 'uranium', owing);\n      }\n      if (owing > 0) {\n        console.warn(\"Cannot remove more resources from ship still owing \"+owing);\n      }\n    }\n  }\n  // Remove the oldEquip from the ship (no new equipment added)\n  lodash.remove(ship.equip, (e) => e.id === equipToMove.id);\n  selectFirstSecondaryWeapon(ship);\n}\n\n/**\n * Destroys unwanted equipment and recovers some material cost\n * @param planet location resources will be added to\n * @param equip to destroy\n */\nexport function salvageEquip(planet, equip) {\n  planet.resources.stored['titanium'] += equip.cost.titanium * c.SALVAGE_RATE;\n  planet.resources.stored['gold'] += equip.cost.gold * c.SALVAGE_RATE;\n  planet.resources.stored['uranium'] += equip.cost.uranium * c.SALVAGE_RATE;\n  // Remove the equip from the planet\n  lodash.remove(planet.equip, (e) => e.id === equip.id);\n}\n\n/**\n * Destroys unwanted ships and recovers some material cost\n * @param planet location resources will be added to\n * @param ship to destroy\n */\nexport function salvageShip(planet, ship) {\n  // First salvage all equipment on the ship\n  for (const equip of ship.equip) {\n    salvageEquip(planet, equip);\n  }\n  // Salvage the ship itself\n  planet.resources.stored['titanium'] += ship.cost.titanium * c.SALVAGE_RATE;\n  planet.resources.stored['gold'] += ship.cost.gold * c.SALVAGE_RATE;\n  planet.resources.stored['uranium'] += ship.cost.uranium * c.SALVAGE_RATE;\n  removeShipFromStorage(ship, planet);\n  // If ship is currently being used - stop using it!\n  if (ship === window.world.ship) {\n    const shipSprite = game.getShipSprite(ship);\n    shipSprite.visible = false;\n    ship.alive = false;\n    ship.spriteId = null;\n  }\n}\n\n\n/**\n * Removes the resource from the ship\n * @return the amount still owing after removing\n */\nexport function removeResource(ship, resourceType, amount) {\n  ship.resources[resourceType] -= amount;\n  if (ship.resources[resourceType] < 0) {\n    let owing = Math.abs(ship.resources[resourceType]);\n    ship.resources[resourceType] = 0;\n    return owing;\n  }\n  return 0;\n}\n\n/**\n * @return true if the equip can be added to the ship\n */\nexport function canEquip(ship, equip) {\n  if (!ship || !ship.equip || !equip) {\n    return false;\n  }\n  // No more space\n  if (ship.equip.length >= ship.equipMax) {\n    return false;\n  }\n  // Some equip you can only have one\n  if ([EQUIP_TYPE_BRAKE, EQUIP_TYPE_PRIMARY_WEAPON, EQUIP_TYPE_THRUSTER].includes(equip.type)) {\n    if (ship.equip.find((eq) => eq.type === equip.type)) {\n      return false;\n    }\n  }\n  return true;\n}\n\n","import {c, fly, utils} from './';\nimport {getShipSprite} from \"./game\";\n\nexport function moveAliens() {\n  let ship = window.world.ship;\n  for (let alien of window.world.system.nearby.ships) {\n    if (!alien.alive || ship === alien) {\n      continue;\n    }\n    let hasMoved = false;\n    if (alien.aiType === c.ALIEN_AI_CREEPER) {\n      hasMoved = creeperAi(alien, false);\n    } else if (alien.aiType === c.ALIEN_AI_KAMIKAZI) {\n      hasMoved = creeperAi(alien, true);\n    } else if (alien.aiType === c.EQUIP_AI_TURRET) {\n      hasMoved = turretAi(alien, 0.7);\n    } else if (alien.aiType === c.ALIEN_AI_TURRET) {\n      hasMoved = turretAi(alien, 0.25);\n    } else if (alien.aiType === c.EQUIP_AI_MISSILE) {\n      hasMoved = missileAi(alien);\n    } else if (alien.aiType === c.ALIEN_AI_MOTHERSHIP) {\n      mothershipAi(alien);\n    }\n    if (hasMoved) {\n      checkForCollisionWithPlanet(alien);\n      checkForCollisionWithShip(alien);\n    }\n\n    // If alien is in the viewport\n    if ((ship.x + c.HALF_SCREEN_WIDTH + alien.radius >= alien.x) && // Right\n      (ship.x - c.HALF_SCREEN_WIDTH - alien.radius <= alien.x) && // Left\n      (ship.y + c.HALF_SCREEN_HEIGHT + alien.radius >= alien.y) && // Bottom\n      (ship.y - c.HALF_SCREEN_HEIGHT - alien.radius <= alien.y)) { // Top\n      // alien may have died in a collision\n      if (alien.alive) {\n        // Set alien ship relative to the ship's viewport\n        const alienSprite = getShipSprite(alien);\n        alienSprite.visible = true;\n        alienSprite.rotation = alien.rotation;\n        alienSprite.x = (alien.x - ship.x) + c.HALF_SCREEN_WIDTH;\n        alienSprite.y = (alien.y - ship.y) + c.HALF_SCREEN_HEIGHT;\n      }\n    } else { // alien is not in view\n      // Release the sprite if the alien is not in the view\n      if (alien.spriteId) {\n        const alienSprite = getShipSprite(alien);\n        alienSprite.visible = false;\n        alien.spriteId = null;\n      }\n    }\n  } // for alien\n}\n\n/**\n * Fire primary weapon in the direction of x,y\n * @ship ship with gun to fire\n * @x/y  the location to aim at\n * @jitter amount (in radians) of randomness added to direction component\n *         0 - shoots directly at player\n *         PI - shoot completely randomly\n */\nexport function shootAt(shooter, x, y, jitter) {\n  shooter.rotation = utils.normalizeRadian(Math.atan2(y - shooter.y, x - shooter.x));\n  fly.firePrimaryWeapon(shooter, jitter);\n}\n\nexport function turretAi(turretShip, jitter) {\n  const {target, dist} = getNearestOpponentTarget(turretShip);\n  if (!target || !target.alive) {\n    return false;\n  }\n  if (dist < fly.primaryWeaponRange(turretShip)) {\n    shootAt(turretShip, target.x, target.y, jitter);\n  }\n  return false;\n}\n\nexport function mothershipAi(alien) {\n  let ship = window.world.ship;\n  if (!ship.alive) {\n    return;\n  }\n  const distanceToPlayer = utils.distanceBetween(alien.x, alien.y, ship.x, ship.y);\n  if (distanceToPlayer < fly.primaryWeaponRange(alien)) {\n    shootAt(alien, ship.x, ship.y, 0.3);\n  }\n  if (distanceToPlayer < c.SCREEN_WIDTH*3) {\n    fly.fireSecondaryWeapon(alien);\n  }\n  if (alien.armor < alien.armorMax) {\n    enableShieldIfNeeded(alien);\n  }\n}\n\n/**\n * Finds the nearest ship on the other team\n * @param ship ship to determine x,y and player\n */\nexport function getNearestOpponentTarget(ship) {\n  return (ship.owner === c.PLAYER)\n    ? getNearestAlienTarget(ship.x, ship.y, ship.id)\n    : getNearestPlayerTarget(ship.x, ship.y, ship.id);\n}\n\n/**\n * Finds the nearest ship on the same team\n * @param ship ship to determine x,y and player\n */\nexport function getNearestFriendlyTarget(ship) {\n  return (ship.owner === c.PLAYER)\n    ? getNearestPlayerTarget(ship.x, ship.y, ship.id)\n    : getNearestAlienTarget(ship.x, ship.y, ship.id);\n}\n\n/**\n * Simple AI for missiles - find nearest target and move toward it attempting to crash\n */\nexport function missileAi(missile) {\n  const {target, dist} = getNearestOpponentTarget(missile);\n  // Missiles don't track targets really far away\n  if (target && dist < c.SCREEN_WIDTH) {\n    let dirToTarget = utils.directionTo(missile.x, missile.y, target.x, target.y);\n    let {xAmt, yAmt} = utils.dirComponents(dirToTarget, missile.propulsion);\n    missile.vx += xAmt;\n    missile.vy += yAmt;\n    missile.x += missile.vx;\n    missile.y += missile.vy;\n    return true;\n  }\n  // Don't move if there's nobody to move towards\n  return false;\n}\n\n/**\n * AI for aliens that move toward the player and shoots\n * @return true if alien moved false otherwise\n */\nexport function creeperAi(alien, crashIntoPlayer=false) {\n  let ship = window.world.ship;\n  if (!ship.alive) {\n    return;\n  }\n  const viewRange = alien.viewRange || c.SCREEN_WIDTH;\n  let moved = false;\n  const {target:playerTarget, dist:distToOpponent} = getNearestOpponentTarget(alien);\n  if (!playerTarget) {\n    return;\n  }\n  if (distToOpponent < viewRange) {\n    let dirToTarget = utils.directionTo(alien.x, alien.y, playerTarget.x, playerTarget.y);\n    let {xAmt, yAmt} = utils.dirComponents(dirToTarget, 25 * alien.propulsion);\n    // Check if we are too close to a planet (need to move around the planet)\n    for (let planet of window.world.system.nearby.planets) {\n      if (utils.distanceBetween(alien.x + xAmt, alien.y + yAmt, planet.x, planet.y) < (planet.radius + alien.radius + 10)) {\n        const dirToPlanet = utils.directionTo(alien.x, alien.y, planet.x, planet.y);\n        let dirDiff = dirToPlanet - dirToTarget;\n        let rightLeft = (dirDiff >= 0) ? -1 : 1;\n        if (Math.abs(dirDiff) > Math.PI) {\n          rightLeft = rightLeft * -1;\n        }\n        const turnDir = dirToPlanet + (rightLeft * Math.PI / 2);\n        ({xAmt, yAmt} = utils.dirComponents(turnDir, 20 * alien.propulsion));\n      }\n    } // for planet\n    // Too close to an enemy, don't move as you might crash\n    if (!crashIntoPlayer && distToOpponent < (ship.spriteWidth + alien.radius + 20)) {\n      xAmt = 0;\n      yAmt = 0;\n    }\n    // Don't crash into friends\n    const {target: friend} = getNearestFriendlyTarget(alien);\n    if (friend &&\n      (utils.distanceBetween(alien.x + xAmt, alien.y + yAmt, friend.x, friend.y) < (alien.radius + friend.radius + 10))) {\n      xAmt = 0;\n      yAmt = 0;\n    }\n    if (alien.armor < alien.armorMax) {\n      enableShieldIfNeeded(alien);\n    }\n    alien.x += xAmt;\n    alien.y += yAmt;\n    alien.rotation = dirToTarget;\n    moved = true;\n  }\n  if (distToOpponent < fly.primaryWeaponRange(alien)) {\n    shootAt(alien, playerTarget.x, playerTarget.y, 0.15);\n  }\n  return moved;\n}\n\n/**\n * Finds the nearest alien target to the x,y location\n * @shipId : any alien except the one with a matching shipId\n * returns {target:X, dist:Y }  x and y will be null if no living targets are found\n */\nexport function getNearestAlienTarget(x, y, shipId = 'none') {\n  let target = null;\n  let minDist = null;\n  for (let alien of window.world.system.nearby.ships) {\n    if (alien.alive && alien.owner === c.ALIEN && alien.id !== shipId) {\n      let dist = utils.distanceBetween(x, y, alien.x, alien.y);\n      if (!target || (dist < minDist)) {\n        target = alien;\n        minDist = dist;\n      }\n    }\n  } // for\n  return {target: target, dist: minDist};\n}\n\n/**\n * Finds the nearest player target to the x,y location\n * @shipId : any ship except the one matching shipId\n * returns {target:X, dist:Y }  x and y will be null if no living targets are found\n */\nexport function getNearestPlayerTarget(x, y, shipId='none') {\n  const ship = window.world.ship;\n  let target = ship;\n  let minDist = ship.id !== shipId ? utils.distanceBetween(x, y, ship.x, ship.y) : 99999999999;\n  for (let ship of window.world.system.nearby.ships) {\n    if (ship.alive && ship.owner === c.PLAYER && ship.id !== shipId) {\n      let dist = utils.distanceBetween(x, y, ship.x, ship.y);\n      if (!target || (dist < minDist)) {\n        target = ship;\n        minDist = dist;\n      }\n    }\n  } // for\n  return {target: target, dist: minDist};\n}\n\n\nexport function checkForCollisionWithPlanet(alien) {\n  for (let planet of window.world.system.nearby.planets) {\n    let dist = utils.distanceBetween(alien.x, alien.y, planet.x, planet.y);\n    if (dist <= (alien.radius + planet.radius)) {\n      fly.destroyShip(alien, null);\n    }\n  } // for\n}\n\nexport function checkForCollisionWithShip(ship) {\n  for (let otherShip of window.world.system.nearby.ships) {\n    if (otherShip.alive && ship !== otherShip) {\n      let dist = utils.distanceBetween(ship.x, ship.y, otherShip.x, otherShip.y);\n      if (dist <= (ship.radius + otherShip.radius)) {\n        fly.shipsCollide(ship, otherShip);\n        if (ship.name === c.SHIP_FRIENDSHIP_MISSILE.name && otherShip.owner !== ship.owner) {\n          otherShip.owner = ship.owner;\n        }\n      }\n    }\n  } // for\n}\n\nexport function enableShieldIfNeeded(ship) {\n  const shieldEquip = getShield(ship);\n  if (!shieldEquip || shieldEquip.cool > 0) {\n    return;\n  }\n  fly.enableShield(ship, shieldEquip.shield);\n  shieldEquip.cool = shieldEquip.coolTime;\n}\n\nexport function getShield(ship) {\n  for (let i = 0; i < ship.equip.length; i++) {\n    const equip = ship.equip[i];\n    if ((equip.type === c.EQUIP_TYPE_SECONDARY_WEAPON) && equip.shield) {\n      return equip;\n    }\n  } // for\n  return null;\n}","import {fly, game, utils} from './';\nimport lodash from 'lodash';\n\n// IndexedDB constants\nconst WORLD_STORE = 'world';\nconst DB_NAME = 'astrominer';\nconst DB_VERSION = 1;\n\n/** Saves an object in localstorage.\n * @param key key to store/retrieve\n * @param objToSave: should be an Object or Array, NOT a primitive as the JSON.parse will fail\n */\nexport function saveLocalStorage(key, objToSave) {\n  const existing = localStorage.getItem(key);\n  if (existing) {\n    localStorage.removeItem(key);\n  }\n  localStorage.setItem(key, JSON.stringify(objToSave));\n}\n\n/**\n *  Loads an object from localstorage.\n * NOTE: The item stored must be an Object or Array as primitives will fail the JSON.parse\n */\nexport function loadLocalStorage(key) {\n  if (!key) {\n    console.warn('Unable to from localStorage without a key');\n    return;\n  }\n  const objString = localStorage.getItem(key)\n  //console.log('loaded objString ='+objString);\n  if (!objString) {\n    return null;\n  }\n  return JSON.parse(objString);\n}\n\nfunction upgradeDB(event) {\n  let db = event.target.result;\n  if (event.oldVersion >= 1) {\n    db.deleteObjectStore(WORLD_STORE);\n  }\n  db.createObjectStore(WORLD_STORE, {keyPath: \"saveGameName\"});\n}\n\n/**\n * Start using a newWorld, the old world and it's state will be discarded.\n * param key:  storage key where the world is kept\n */\nexport function loadWorld(key) {\n  let dbRequest = indexedDB.open(DB_NAME, DB_VERSION);\n  dbRequest.onerror = function (event) {\n    console.log('error ', event);\n  };\n  dbRequest.onupgradeneeded = upgradeDB;\n  dbRequest.onsuccess = function (event) {\n    let db = event.target.result;\n    let transaction = db.transaction([WORLD_STORE]);\n    let objectStore = transaction.objectStore(WORLD_STORE);\n    let request = objectStore.get(key);\n    request.onerror = function (event) {\n      console.log('Request error loading:', event);\n    };\n    request.onsuccess = function (event) {\n      const newWorld = request.result;\n      const oldSystem = window.world.system;\n      window.world = newWorld;\n      window.world.system = oldSystem;\n\n      // Clear the old containers of whatever they had\n      window.world.system.spriteContainers.planets.removeChildren();\n      window.world.system.planetSpriteCache = {};\n      window.world.system.spriteContainers.ships.removeChildren();\n      window.world.system.shipSpriteCache = {};\n      window.world.system.shieldSpriteCache = new Map();\n      window.world.system.bullets = []; // remove all active bullets from the screen\n      window.world.system.spriteContainers.bullets.removeChildren();\n      window.world.system.explosions = [];\n      window.world.system.spriteContainers.explosions.removeChildren();\n\n      // Reset/Redraw all the sprites\n      window.world.ship.spriteId = null;\n      const shipSprite = game.getShipSprite(window.world.ship);\n      shipSprite.visible = window.world.ship.alive;\n      fly.repositionScreen();\n      utils.showToast('Loaded game');\n    };\n  }\n\n}\n\nexport function saveWorld(key) {\n  const worldToStore = lodash.cloneDeep(lodash.omit(window.world, ['system']));\n  worldToStore.saveGameName = key;\n\n  let dbRequest = indexedDB.open(DB_NAME, DB_VERSION);\n  dbRequest.onerror = function (event) {\n    console.log('DB Request Error:', event);\n  };\n  dbRequest.onupgradeneeded = upgradeDB;\n  dbRequest.onsuccess = function (event) {\n    let db = event.target.result;\n    let transaction = db.transaction([WORLD_STORE], \"readwrite\");\n    let objectStore = transaction.objectStore(WORLD_STORE);\n    let objectStoreRequest = objectStore.put(worldToStore);\n    objectStoreRequest.onsuccess = function (event) {\n      utils.showToast('Saved game');\n    };\n    objectStoreRequest.onerror = function (event) {\n      console.log('failed to save ', event.target);\n    }\n  }\n}\n\nexport function deleteWorld(key) {\n  let dbRequest = indexedDB.open(DB_NAME, DB_VERSION);\n  dbRequest.onerror = function (event) {\n    console.log('DB Request Error:', event);\n  };\n  dbRequest.onupgradeneeded = upgradeDB;\n  dbRequest.onsuccess = function (event) {\n    let db = event.target.result;\n    let transaction = db.transaction([WORLD_STORE], \"readwrite\");\n    let objectStore = transaction.objectStore(WORLD_STORE);\n    let objectStoreRequest = objectStore.delete(key);\n    objectStoreRequest.onsuccess = function (event) {\n      utils.showToast('Deleted game ' + key);\n    };\n    objectStoreRequest.onerror = function (event) {\n      console.log('failed to delete ', event.target);\n    }\n  }\n}\n","import React from 'react';\nimport './Heatbar.css';\n\nconst IMG_HEIGHT = 100;\nconst IMG_WIDTH = 24;\n\nexport const HEATBAR = {\n  GREEN : 'heatbar-green.png',\n  RED: 'heatbar-red.png',\n  COLOR: 'heatbar-color.png'\n};\n\nexport function Heatbar({type, curr, max}) {\n  if (type !== HEATBAR.GREEN &&\n    type !== HEATBAR.RED &&\n    type !== HEATBAR.COLOR) {\n    console.warn('unknown heatbar type '+type);\n    return <span />;\n  }\n\n  const pct = curr / max;\n  const topFree = 100 - (pct * IMG_HEIGHT );\n\n  // Use red or green as the base\n  let colorImgSrc = 'images/'+(type === HEATBAR.RED ? HEATBAR.RED : HEATBAR.GREEN);\n\n  // Multicolor is based off green\n  if (type === HEATBAR.COLOR && (topFree > 60)) {\n    colorImgSrc = 'images/heatbar-color.png'\n  }\n\n  return (\n    <span className='heatbar-container' style={{width:IMG_WIDTH+'px',  height:IMG_HEIGHT+'px'}}>\n      <span className='heatbar-base'>\n        <img src='images/heatbar-base.png' width={IMG_WIDTH+'px'} height={IMG_HEIGHT+'px'} alt='heat' />\n      </span>\n      <span className='heatbar-color'>\n        <img src={colorImgSrc} width={IMG_WIDTH+'px'} height={IMG_HEIGHT+'px'} alt='heat' style={{\n          clipPath: 'inset('+topFree+'px 0px 00px 0px)'\n        }}\n        />\n      </span>\n    </span>);\n}\n\n","import React from 'react';\nimport './PushButton.css';\n\nconst IMG_HEIGHT = 26;\nconst IMG_WIDTH = 44;\n\nexport function PushButton({selected, onChange}) {\n  const imgFile = selected ? 'images/button_push_on.png' : 'images/button_push_off.png';\n  return (\n    <img src={imgFile} width={IMG_WIDTH + 'px'} height={IMG_HEIGHT + 'px'} alt='button' onClick={() => {\n      onChange();\n    }}/>\n  );\n}\n","import React from 'react';\nimport './StatusButton.css';\n\nconst IMG_HEIGHT = 24;\nconst IMG_WIDTH = 48;\n// pct at which red turns into yellow\nconst YELLOW_PCT = 0.7; // pct to change to yellow at\nconst BORDER = 5; // width of button border (non drawing part of button)\n\nconst BUTTON = {\n  GREEN: 'button_long_green.png',\n  RED: 'button_long_red.png',\n  YELLOW: 'button_long_yellow.png',\n  BLACK: 'button_long_black.png'\n};\n\nfunction getStatus(curr, max) {\n  if (!max || max <= 0) {\n    return {rightFree: 0, colorImgSrc: 'images/' + BUTTON.BLACK};\n  }\n  if (curr >= max) {\n    return {rightFree: 0, colorImgSrc: 'images/' + BUTTON.GREEN};\n  }\n  // Red\n  if (curr / max < YELLOW_PCT) {\n    const pct = curr / (max * YELLOW_PCT);\n    const rightFree = IMG_WIDTH - (BORDER + pct * (IMG_WIDTH - (2 * BORDER)));\n    return {rightFree, colorImgSrc: 'images/' + BUTTON.RED};\n  }\n  // Yellow\n  const pct = (curr - (max * YELLOW_PCT)) / (max * (1 - YELLOW_PCT));\n  const rightFree = IMG_WIDTH - (BORDER + pct * (IMG_WIDTH - (2 * BORDER)));\n  return {rightFree, colorImgSrc: 'images/' + BUTTON.YELLOW};\n}\n\n\nexport function StatusButton({curr, max}) {\n\n  const {rightFree, colorImgSrc} = getStatus(curr, max);\n\n  return (\n    <span className='statusbutton-container' style={{width: IMG_WIDTH + 'px', height: IMG_HEIGHT + 'px'}}>\n      <span className='statusbutton-base'>\n        <img src={'images/' + BUTTON.BLACK} width={IMG_WIDTH + 'px'} height={IMG_HEIGHT + 'px'} alt='status'/>\n      </span>\n      <span className='statusbutton-color'>\n        <img src={colorImgSrc} width={IMG_WIDTH + 'px'} height={IMG_HEIGHT + 'px'} alt='heat' style={{\n          clipPath: 'inset(0px ' + rightFree + 'px 0px 0px)'\n        }}\n        />\n      </span>\n    </span>);\n}\n\n","import React from 'react';\nimport {c, fly} from '../functions';\nimport './InfoFly.css';\nimport {HEATBAR, Heatbar} from \"./Heatbar\";\nimport {PushButton} from \"./PushButton\";\nimport {StatusButton} from \"./StatusButton\";\n\nexport function InfoFly() {\n  const ship = window.world.ship;\n  const shield = fly.getEquippedShield(ship);\n\n  function closeIntroDialog() {\n    window.world.introDialogShown = true;\n  }\n\n  return (\n    <div className='section'\n         style={{backgroundImage: 'url(\"images/metalbackground.png\")', backgroundSize: 'cover', height: '100%'}}>\n      <div>{ship.name}</div>\n\n      <table>\n        <thead>\n        <tr>\n          <th style={{paddingRight: '10px'}}>Armor</th>\n          <th>Shield</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr>\n          <td style={{textAlign: 'center'}}>\n            <Heatbar type={HEATBAR.COLOR} curr={ship.armor} max={ship.armorMax}/>\n          </td>\n          <td>\n            {shield && shield.shield.active &&\n            <span>\n                <Heatbar type={HEATBAR.RED} curr={shield.shield.lifetime} max={shield.shield.lifetimeMax}/>\n                <Heatbar type={HEATBAR.COLOR} curr={shield.shield.armor} max={shield.shield.armorMax}/>\n              </span>\n            }\n          </td>\n        </tr>\n        <tr>\n          <td>\n            {Math.floor(ship.armor)} / {ship.armorMax}\n          </td>\n          <td> </td>\n          <td> </td>\n        </tr>\n        </tbody>\n      </table>\n\n      <table>\n        <tbody>\n        <tr>\n          <td>\n            <div>\n              <b>Equip (max {ship.equipMax})</b>\n            </div>\n            <table>\n              <tbody>\n              {ship.equip.map((equip, i) => {\n                return <tr key={i} className='equip'>\n                  <td>\n                    {equip.type === c.EQUIP_TYPE_SECONDARY_WEAPON &&\n                    <PushButton selected={i === ship.selectedSecondaryWeaponIndex} onChange={() => {\n                      ship.selectedSecondaryWeaponIndex = i;\n                    }}/>}\n                  </td>\n                  <td>\n                    <StatusButton curr={equip.coolTime - equip.cool} max={equip.coolTime}/>\n                  </td>\n                  <td>\n                    {equip.name}\n                  </td>\n                </tr>\n              })}\n              </tbody>\n            </table>\n          </td>\n          <td style={{paddingLeft:'10px'}}>\n            <table>\n              <tbody>\n              <tr>\n                <td className='bluescreen-container'>\n                  <div className='bluescreen-background'>\n                    <img src='images/blue_screen.png' className='stretch' alt='bluescreen'/>\n                  </div>\n                  <div className='bluescreen-text'>\n                    <table cellPadding='4'>\n                      <thead>\n                      <tr>\n                        <th colSpan='100%'>Resources</th>\n                      </tr>\n                      </thead>\n                      <tbody>\n                      <tr>\n                        <td>Titatium</td>\n                        <td>{Math.floor(ship.resources.titanium)}</td>\n                      </tr>\n                      <tr>\n                        <td>Gold</td>\n                        <td>{Math.floor(ship.resources.gold)}</td>\n                      </tr>\n                      <tr>\n                        <td>Uranium</td>\n                        <td>{Math.floor(ship.resources.uranium)}</td>\n                      </tr>\n                      </tbody>\n                    </table>\n                  </div>\n                </td>\n              </tr>\n              </tbody>\n            </table>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n\n      <div className=\"intro-dialog\" onClick={() => closeIntroDialog()} style={{display: window.world.introDialogShown ? \"none\": \"block\"}}>\n        <p>Ship's Log: Day 348</p>\n        <p> After a long trip through deep space, I have finally made it to the edge of the asteroid field that until now I wasn't certain actually existed.\n          We will see if it lives up to the rumors from old men in taverns of asteroids full of titanium, gold and uranium, a place where a man can make\n          a fortune mining.  So it really does exist, but where are all the other people who came to make their fortune? This place looks empty.</p>\n        <p>It took years to save up enough to get this Explorer-class spaceship, and I outfitted it with a state-of-the-art AI which can build\n          autonomous mines to extract resources. It can also create fully automated factories to produce ships and equipment. The AI can learn new patterns\n          for the factories to build by being exposed to various different environments and equipment.  I have heard a lot about the power of this AI and\n           can't wait to try it out.</p>\n        <p>The first step is to find a planet with a good amount of resources and build a mine. I will have to be careful landing the ship though,\n          as the ship must be going slow enough and land on it's landing gear or it will be damaged.</p>\n        <p> Use the arrow keys or W-A-S-D keys to move the ship, and the spacebar to shoot. X will deploy a secondary weapon.</p>\n      </div>\n\n    </div>\n  );\n}\n\n\n","import React, {useState} from 'react';\nimport {c, game, manage} from '../functions';\nimport './ManagePlanet.css';\nimport 'font-awesome/css/font-awesome.min.css';\n\nexport function ManagePlanet() {\n  const [titaniumAmt, setTitaniumAmt] = useState('');\n  const [goldAmt, setGoldAmt] = useState('');\n  const [uraniumAmt, setUraniumAmt] = useState('');\n\n  let world = window.world;\n  let planet = window.world.selectedPlanet;\n  let ship = window.world.ship;\n  let shipOnPlanet = ((planet === window.world.lastPlanetLanded) && ship.alive);\n  return (\n    <div className='planet-info'>\n      <div className='section'><b>Planet Name: </b> {world.selectedPlanet.name}</div>\n      <div className='build-button'>\n        <button\n          disabled={!game.canAfford(planet, (shipOnPlanet ? ship : null), c.MINE_COST)}\n          onClick={() => manage.buildMine()}>Build Mine\n        </button>\n        Cost: T:{c.MINE_COST.titanium} G:{c.MINE_COST.gold}\n      </div>\n      <div className='build-button'>\n        <button\n          disabled={!game.canAfford(planet, (shipOnPlanet ? ship : null), c.FACTORY_COST)}\n          onClick={() => manage.buildFactory()}>Build Factory\n        </button>\n        Cost: T:{c.FACTORY_COST.titanium} G:{c.FACTORY_COST.gold} U:{c.FACTORY_COST.uranium}\n      </div>\n\n      <div style={{display:ship.alive?'block':'none'}} className='build-button'>\n        <div className='section'><b>Ship</b> ({Math.round(ship.armor) +' / '+ ship.armorMax}) </div>\n        <button style={{marginLeft:'10px'}}\n                onClick={() => manage.unloadShip(ship, planet)}>\n          Unload\n        </button>\n        <button style={{marginLeft:'10px'}}\n                onClick={() => manage.resupplyShip(ship, planet)}>\n            Resupply\n        </button>\n        <button style={{marginLeft:'10px'}}\n                onClick={() => manage.repairShip(ship, planet)}\n                disabled={ship.armorMax <= ship.armor}>\n          Repair\n        </button>\n      </div>\n\n      <div className='section'>\n        <b>Resources</b>\n      </div>\n      <div className=\"row-item\">Titanium {Math.floor(planet.resources.raw.titanium)}</div>\n      <div className=\"row-item\">Gold {Math.floor(planet.resources.raw.gold)}</div>\n      <div className=\"row-item\">Uranium {Math.floor(planet.resources.raw.uranium)}</div>\n\n      {shipOnPlanet && <table  className=\"row-item\">\n        <thead>\n        <tr>\n          <th>Resource</th>\n          <th>Planet</th>\n          <th>Transfer</th>\n          <th>Ship ({ship.resourcesMax})</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr>\n          <td>Titanium</td>\n          <td>{Math.floor(planet.resources.stored.titanium)}</td>\n          <td>\n              <span className='transfer-button'\n                    onClick={() => manage.transferResource(ship.resources, planet.resources.stored,\n                      'titanium', titaniumAmt, c.PLANET_RESOURCE_MAX)}><i className=\"fa fa-arrow-left\"> </i></span>\n            <input type='text' className='transfer-input'\n                   defaultValue={titaniumAmt}\n                   onChange={(event) => setTitaniumAmt(event.target.value)}/>\n            <span className='transfer-button'\n                  onClick={() => manage.transferResource(planet.resources.stored, ship.resources,\n                    'titanium', titaniumAmt, ship.resourcesMax)}><i className=\"fa fa-arrow-right\"> </i></span>\n          </td>\n          <td>{Math.floor(ship.resources.titanium)}</td>\n        </tr>\n        <tr>\n          <td>Gold</td>\n          <td>{Math.floor(planet.resources.stored.gold)}</td>\n          <td>\n              <span className='transfer-button'\n                    onClick={() => manage.transferResource(ship.resources, planet.resources.stored,\n                      'gold', goldAmt, c.PLANET_RESOURCE_MAX)}><i className=\"fa fa-arrow-left\"> </i></span>\n            <input type='text' className='transfer-input'\n                   defaultValue={goldAmt}\n                   onChange={(event) => setGoldAmt(event.target.value)}/>\n            <span className='transfer-button'\n                  onClick={() => manage.transferResource(planet.resources.stored, ship.resources,\n                    'gold', goldAmt, ship.resourcesMax)}><i className=\"fa fa-arrow-right\"> </i></span>\n          </td>\n          <td>{Math.floor(ship.resources.gold)}</td>\n        </tr>\n        <tr>\n          <td>Uranium</td>\n          <td>{Math.floor(planet.resources.stored.uranium)}</td>\n          <td>\n              <span className='transfer-button'\n                    onClick={() => manage.transferResource(ship.resources, planet.resources.stored,\n                      'uranium', uraniumAmt, c.PLANET_RESOURCE_MAX)}><i className=\"fa fa-arrow-left\"> </i></span>\n            <input type='text' className='transfer-input'\n                   defaultValue={uraniumAmt}\n                   onChange={(event) => setUraniumAmt(event.target.value)}/>\n            <span className='transfer-button'\n                  onClick={() => manage.transferResource(planet.resources.stored, ship.resources,\n                    'uranium', uraniumAmt, ship.resourcesMax)}><i className=\"fa fa-arrow-right\"> </i></span>\n          </td>\n          <td>{Math.floor(ship.resources.uranium)}</td>\n        </tr>\n        </tbody>\n      </table>}\n\n      {!shipOnPlanet &&\n      <table>\n        <thead>\n        <tr>\n          <th>Resource</th>\n          <th>Planet</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr>\n          <td>Titanium</td>\n          <td>{Math.floor(planet.resources.stored.titanium)}</td>\n        </tr>\n        <tr>\n          <td>Gold</td>\n          <td>{Math.floor(planet.resources.stored.gold)}</td>\n        </tr>\n        <tr>\n          <td>Uranium</td>\n          <td>{Math.floor(planet.resources.stored.uranium)}</td>\n        </tr>\n        </tbody>\n      </table>}\n    </div>);\n}\n\n","import React from 'react';\nimport { c, manage, game} from '../../functions';\nimport './FactoryButtonRow.css';\n\nexport function FactoryButtonRow({template}) {\n  const world = window.world;\n  const planet = world.selectedPlanet;\n  const ship = world.ship;\n  let existingInventory = (template.objType === c.OBJ_SHIP) ?\n    planet.ships.filter(s=> s.name === template.name).length:\n    planet.equip.filter(e=> e.name === template.name).length;\n\n  // Calculate the description\n  let description = template.description;\n  if (!description && template.damage) {\n    description = `${Math.round(template.damage * (60 / template.coolTime))} dmg/s Range ${template.speed * template.lifetime} Speed ${template.speed} `;\n  }\n  if (!description && template.shield) {\n    const shield = template.shield;\n    description = `${shield.armorMax}dmg for ${Math.round(shield.lifetimeMax/60)}s every ${Math.round(template.coolTime/60)}s`;\n  }\n  if (template.createShip) {\n    const newShip = template.createShip.type;\n    description += ` Cost (${newShip.cost.titanium}T ${newShip.cost.gold}G ${newShip.cost.uranium}U)`;\n  }\n\n  // We pretend the current ship is in storage in the planet\n  if (ship.alive && template.name === ship.name) {\n    existingInventory += 1;\n  }\n\n  function build(templateArg) {\n    if (templateArg.objType === c.OBJ_SHIP) {\n      manage.buildShip(templateArg);\n    } else if (templateArg.objType === c.OBJ_EQUIP) {\n      manage.buildEquip(templateArg);\n    }\n  }\n\n  return (\n    <tr>\n      <td className=\"factory-row\">\n        {existingInventory}\n      </td>\n      <td className=\"factory-row\">\n      <button className=\"factory-button\"\n        disabled={!manage.hasFactory(planet) || !game.canAfford(planet, ship, template.cost)}\n        onClick={() => build(template)}>{template.name}</button>\n      </td>\n      <td className=\"factory-row\">\n        <span className='cost'>{template.cost.titanium}T {template.cost.gold}G {template.cost.uranium}U</span>\n      </td>\n      <td className=\"factory-row\">\n        {description}\n      </td>\n    </tr>);\n}\n\n","import React from 'react';\nimport { c } from '../../functions/';\nimport './FactoryTab.css';\nimport {FactoryButtonRow} from \"./FactoryButtonRow\";\n\nexport function FactoryTab({type, templateList}) {\n  return (\n    <div className='container factory-tab' style={{maxHeight: (c.SCREEN_HEIGHT - 200), minWidth:'400px'}}>\n      <table>\n        <tbody>\n          {templateList.map((template, i) => {\n            return <FactoryButtonRow key={type+i} template={template} />;\n          })}\n        </tbody>\n      </table>\n    </div>);\n}\n\n","import React from 'react';\nimport { c } from '../../functions/';\nimport './ManageFactory.css';\nimport {Tab, Tabs} from \"react-bootstrap\";\nimport {FactoryTab} from \"./FactoryTab\";\n\n\nexport function FactoryTabs() {\n  const equip = window.world.blueprints.equip;\n\n  const upgrades =  equip.filter((e) => c.EQUIP_UPGRADES.find(u => u.name === e.name));\n  const primaryWeapons = equip.filter((e) => c.EQUIP_PRIMARY_WEAPONS.find(p => p.name === e.name));\n  const secondaryWeapons = equip.filter((e) => c.EQUIP_SECONDARY_WEAPONS.find(s => s.name === e.name));\n  const droids = equip.filter((e) => c.EQUIP_DROIDS.find(d => d.name === e.name));\n\n  return (\n    <div className='factory-info'>\n      <Tabs defaultActiveKey='ships' id='factory-tabs' className=\"flex-nowrap\">\n        <Tab eventKey='ships' title=\"Ships\">\n          <FactoryTab type='ship' templateList={window.world.blueprints.ship} />\n        </Tab>\n\n        {upgrades && upgrades.length > 0 &&\n        <Tab eventKey='upgrades' title=\"Upgrades\">\n          <FactoryTab type='equip' templateList={upgrades} />\n        </Tab>\n        }\n\n        {primaryWeapons && primaryWeapons.length > 0 &&\n        <Tab eventKey='primaryWeapons' title=\"Primary Weapons\">\n          <FactoryTab type='equip' templateList={primaryWeapons} />\n        </Tab>\n        }\n\n        {secondaryWeapons && secondaryWeapons.length > 0 &&\n        <Tab eventKey='secondaryWeapons' title=\"Secondary Weapons\">\n          <FactoryTab type='equip' templateList={secondaryWeapons} />\n        </Tab>\n        }\n\n        {droids && droids.length > 0 &&\n        <Tab eventKey='droids' title=\"Droids\">\n          <FactoryTab type='equip' templateList={droids} />\n        </Tab>\n        }\n\n      </Tabs>\n    </div>);\n}\n\n","import React, {useState} from 'react';\nimport {manage} from '../functions';\nimport './ManageStorage.css';\n\nexport function ManageStorage() {\n  const [selectedShip, setSelectedShip] = useState();\n  let world = window.world;\n  let planet = world.selectedPlanet;\n  let currentShip = world.ship;\n  let shipOnPlanet = ((planet === window.world.lastPlanetLanded) && currentShip.alive);\n\n  function viewShip(ship) {\n    setSelectedShip(ship);\n  }\n\n  function startUsingShip() {\n    manage.switchToShip(selectedShip);\n    setSelectedShip(null);\n  }\n\n  function salvageShip(selectedShip) {\n    manage.salvageShip(planet, selectedShip);\n    setSelectedShip(null);\n  }\n\n  // Default to selecting the current ship\n  if (!selectedShip && shipOnPlanet) {\n    setSelectedShip(currentShip);\n  }\n\n  let selectedShipEquip = [];\n  if (selectedShip) {\n    for (let equip of selectedShip.equip) {\n      selectedShipEquip.push(\n        <div className=\"item\" key={equip.id}>\n          {equip.name} &nbsp;\n          <button onClick={() => manage.moveEquipFromShipToPlanet(selectedShip, planet, equip)}>Remove</button>\n        </div>);\n    }\n  }\n\n  return (\n    <div>\n      <div className='storage-section'>\n        <div className='title'>Ships</div>\n        <span className='item-list'>\n          {(shipOnPlanet ? [currentShip] : []).concat(planet.ships).map((ship, i) => {\n            return <div key={i}\n                        onClick={() => viewShip(ship)}\n                        className={`ship ${selectedShip === ship ? 'selected-item' : 'non-selected-item'}`}>{ship.name}</div>\n          })}\n        </span>\n        <span className='item-details'>\n          {selectedShip != null && // exclude this block if no ship selected\n          <div>\n            <div className='item-attr'>\n              <button onClick={() => startUsingShip()} disabled={selectedShip === currentShip}>Use Ship</button>\n              <button onClick={() => salvageShip(selectedShip)} style={{marginLeft:'10px'}}>Salvage</button>\n            </div>\n            <div className='item-attr'><b>Name</b> {selectedShip.name} {selectedShip.id}</div>\n            <div className='item-attr'>\n              <b>Engine</b> Propulsion:{Math.floor(selectedShip.propulsion * 100)} Turn:{Math.floor(selectedShip.turnSpeed * 100)}\n            </div>\n            <div className='item-attr'>\n              <b>Landing</b> Speed:{Math.floor(selectedShip.crashSpeed)} Angle:{Math.floor(selectedShip.crashAngle * 10)}\n            </div>\n            <div className='item-attr'><b>Armor</b> &nbsp;\n              {Math.floor(selectedShip.armor)} of {Math.floor(selectedShip.armorMax)}&nbsp;\n              <button onClick={() => manage.repairShip(selectedShip, planet)}\n                      disabled={selectedShip.armorMax <= selectedShip.armor}> Repair\n              </button>\n              &nbsp; Cost {Math.floor(manage.costToRepair(selectedShip).titanium)} titanium\n            </div>\n            <div className='item-attr'><b>Resources Max</b>{Math.floor(selectedShip.resourcesMax)}</div>\n            <div className='item-attr'><b>Equip</b> (Max {selectedShip.equipMax})\n              {selectedShipEquip}\n            </div>\n          </div>\n          }\n        </span>\n      </div>\n\n      <div className='storage-section'>\n        <div className='title'>Equipment</div>\n        <span className='equip-list'>\n          {planet.equip.map((equip, i) => {\n            return <div key={i} className='item'>\n              {equip.name} &nbsp;\n              <button onClick={() => manage.moveEquipFromPlanetToShip(selectedShip, planet, equip)}\n                      disabled={!manage.canEquip(selectedShip, equip)}\n              >Equip\n              </button>\n              <button onClick={() => manage.salvageEquip(planet, equip)} style={{marginLeft:'10px'}}>Salvage</button>\n            </div>\n          })}\n        </span>\n      </div>\n    </div>);\n}\n\n","import React, {useRef} from 'react';\nimport {c, savegame} from '../functions';\nimport './ManageSystem.css';\nimport lodash from 'lodash';\nimport {showToast} from \"../functions/utils\";\n\nexport function ManageSystem() {\n  const world = window.world;\n  const nameInput = useRef();\n  let gameNames = savegame.loadLocalStorage(c.LOCALSTORAGE_GAME_NAMES_KEY);\n\n  function setCurrentGame(newName) {\n    nameInput.current.value = newName;\n    world.saveGameName = newName;\n    console.log('new name ' + newName);\n  }\n\n  /**\n   * Adds a game name to the list of saved game names.\n   */\n  function addGameName(newGameName) {\n    if (newGameName && !gameNames.includes(newGameName)) {\n      gameNames.push(newGameName)\n    }\n    savegame.saveLocalStorage(c.LOCALSTORAGE_GAME_NAMES_KEY, gameNames);\n  }\n\n  // If no games are saved, setup an empty list of game names\n  if (!gameNames) {\n    gameNames = [];\n    addGameName(null);\n  }\n\n  function saveGame() {\n    const saveGameName = nameInput.current.value;\n    if (!saveGameName) {\n      showToast('Cannot save game without name');\n      return;\n    }\n    // Save the world in indexedDB\n    savegame.saveWorld(saveGameName);\n    // Save the game name in localStorage\n    addGameName(saveGameName);\n    setCurrentGame(saveGameName);\n  }\n\n  function loadGame(gameName) {\n    savegame.loadWorld(gameName);\n    setCurrentGame(gameName);\n  }\n\n  function deleteGame(gameName) {\n    if (!window.confirm(\"Are you sure you want to delete \" + gameName + \"?\")) {\n      return;\n    }\n    savegame.deleteWorld(gameName);\n    gameNames = lodash.remove(gameNames, (name) => name !== gameName);\n    savegame.saveLocalStorage(c.LOCALSTORAGE_GAME_NAMES_KEY, gameNames);\n    if (world.saveGameName === gameName) {\n      world.saveGameName = null;\n    }\n    if (nameInput.current.value === gameName) {\n      nameInput.current.value = '';\n    }\n  }\n\n  return (\n    <div style={{paddingLeft:'10px'}}>\n      <div className='system-section'>\n        <div className='section'><b>Current Game</b></div>\n        <input type='text' defaultValue={world.saveGameName} onFocus={() => world.system.isTyping = true}\n               onBlur={() => world.system.isTyping = false} ref={nameInput}/>\n        <button name=\"Save\" onClick={() => saveGame()}>Save</button>\n        <div className='section'><b>Saved Game</b></div>\n        {gameNames.map(gameName => (\n          <div key={gameName} className={'game-list-row ' + (world.saveGameName === gameName ? 'selected-game' : '')}>\n            <span className='game-list-item'><button onClick={() => loadGame(gameName)}>Load </button></span>\n            <span className='game-list-item'><button onClick={() => deleteGame(gameName)}>Delete</button></span>\n            <span className='game-list-item'>{gameName}</span>\n          </div>\n        ))}\n      </div>\n      <div style={{color:\"#909090\"}}>Version {c.APP_VERSION}</div>\n    </div>);\n}\n\n","import React from 'react';\nimport {c} from '../functions';\nimport './ManageLog.css';\n\nexport function ManageLog() {\n  const xp = window.world.blueprints.xp;\n\n  const gameTickCount = window.world.gameTickCount;\n  let timeSpentMin = Math.floor((gameTickCount / 360))/10;\n  let timeSpentHr = 0;\n  if (timeSpentMin > 60) {\n    timeSpentHr = Math.floor(timeSpentMin / 60);\n    timeSpentMin = Math.floor(timeSpentMin - (timeSpentHr * 60));\n  }\n\n  const translations = {\n    [c.PLANET_ROCK_FILE]: 'Rock Planet',\n    [c.PLANET_RED_FILE]: 'Red Planet',\n    [c.PLANET_GREEN_FILE]: 'Green Planet',\n    [c.PLANET_PURPLE_FILE]: 'Purple Planet',\n  }\n\n  return (\n    <div>\n      <div className='system-section'>\n        <div className='section'><b>Experience Log</b></div>\n        <div>\n          <table className=\"log-table\">\n            <tbody>\n            {Object.entries(xp).map((entry) => {\n              const [key, value] = entry;\n              if (value) {\n                return <tr key={key}>\n                  <td><b>{translations[key] || key}</b></td>\n                  <td>{Math.round(value)}</td>\n                </tr>;\n              }\n              return <tr key={key}/>;\n              })}\n            </tbody>\n          </table>\n          <div className=\"tick-count\">\n            Total time spent : {timeSpentHr ? timeSpentHr + ' hour'+(timeSpentHr > 1 ? 's ': ' ') : ''} {timeSpentMin} min\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n","import React from 'react';\nimport { ManagePlanet } from './ManagePlanet';\nimport './ManageTabs.css';\nimport { FactoryTabs } from './factory/FactoryTabs';\nimport { ManageStorage } from './ManageStorage';\nimport {ManageSystem} from \"./ManageSystem\";\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport {Tab, Tabs} from \"react-bootstrap\";\nimport {ManageLog} from \"./ManageLog\";\n\nexport function ManageTabs() {\n\n  return (\n    <Tabs defaultActiveKey='planet' id='manage-tabs' mountOnEnter unmountOnExit className=\"flex-nowrap\">\n      <Tab eventKey='planet' title='Planet'>\n        <ManagePlanet/>\n      </Tab>\n\n      <Tab eventKey='factory' title='Factory'>\n        <FactoryTabs/>\n      </Tab>\n\n      <Tab eventKey='storage' title='Storage'>\n        <ManageStorage/>\n      </Tab>\n\n      <Tab eventKey='log' title='Log'>\n        <ManageLog/>\n      </Tab>\n\n      <Tab eventKey='system' title='System'>\n        <ManageSystem/>\n      </Tab>\n    </Tabs>);\n}\n\n","import React from 'react';\nimport { c } from './functions';\nimport './InfoPanel.css';\nimport { InfoFly } from './fly/InfoFly';\nimport { ManageTabs } from './manage/ManageTabs';\n\nexport class InfoPanel extends React.Component {\n  render() {\n    let world = window.world;\n    if (world.system.gameState === c.GAME_STATE.MANAGE) {\n      return (<ManageTabs/>);\n    } else if (world.system.gameState === c.GAME_STATE.FLY) {\n      return (<InfoFly/>);\n    }\n    return (<div>...</div>);\n  }\n}\n\n","import React from 'react';\nimport './App.css';\nimport {InfoPanel} from './InfoPanel';\nimport {ai, c, fly, game, utils} from './functions';\n\nexport default class App extends React.Component {\n\n  constructor(props) {\n    super(props);\n    window.world = game.createEmptyWorld();\n    this.pixiRef = React.createRef();\n  }\n\n  componentDidMount() {\n    this.createPixiApp();\n  }\n\n  render() {\n    return (\n      <table className='root-app' width='100%'>\n        <tbody>\n        <tr>\n          <td>\n            <div className='viewport' ref={this.pixiRef}/>\n          </td>\n          <td className='info-panel' width='100%' height={(window.world.system.screenHeight || c.SCREEN_HEIGHT) + 'px'}>\n            <div className='scroll-box'>\n              <InfoPanel/>\n            </div>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    );\n  }\n\n  createPixiApp = () => {\n    let app = new window.PIXI.Application({width: c.SCREEN_WIDTH, height: c.SCREEN_HEIGHT});\n    app.renderer.backgroundColor = c.BLACK;\n    this.pixiRef.current.appendChild(app.view);\n    window.PIXI.loader\n      .add(c.SPRITESHEET_JSON)\n      .add(c.CRASH_JSON)\n      .load(this.setupGame);\n    window.world.system.app = app;\n  }\n\n  // Setup the App\n  setupGame = () => {\n    game.setupWorld();\n    this.setupKeyboardListeners();\n    this.setupWindowResizeListener();\n    game.changeGameState(c.GAME_STATE.FLY);\n    window.world.system.app.renderer.plugins.interaction.on('pointerdown', (event) => {\n      game.click(event);\n    });\n    window.world.system.app.ticker.add(delta => this.mainLoop(delta));\n  }\n\n  // Main loop runs 60 times per sec\n  mainLoop = (delta) => {\n    if (window.world.system.gameLoop) {\n      window.world.gameTickCount += 1;\n      game.runBuildings();\n      fly.moveBullets();\n      fly.coolAllWeapons();\n      ai.moveAliens();\n      window.world.system.gameLoop(delta);\n    }\n    // Force redraw all the react HTML (doesn't need to be updated 60 times / sec)\n    if (window.world.gameTickCount % 15 === 0) {\n      this.forceUpdate();\n    }\n  }\n\n  setupKeyboardListeners = () => {\n    window.world.system.keys.left = utils.keyboardListener(\"ArrowLeft\");\n    window.world.system.keys.right = utils.keyboardListener(\"ArrowRight\");\n    window.world.system.keys.up = utils.keyboardListener(\"ArrowUp\");\n    window.world.system.keys.down = utils.keyboardListener(\"ArrowDown\");\n    window.world.system.keys.space = utils.keyboardListener(\" \");\n    window.world.system.keys.w = utils.keyboardListener(\"w\"); // up\n    window.world.system.keys.a = utils.keyboardListener(\"a\"); // left\n    window.world.system.keys.s = utils.keyboardListener(\"s\"); // down\n    window.world.system.keys.d = utils.keyboardListener(\"d\"); // right\n    window.world.system.keys.q = utils.keyboardListener(\"q\"); // thrust left\n    window.world.system.keys.e = utils.keyboardListener(\"e\"); // thrust right\n    window.world.system.keys.x = utils.keyboardListener(\"x\"); // secondary weapon\n  }\n\n  setupWindowResizeListener() {\n    window.addEventListener('resize', resizeScreenToWindow);\n    resizeScreenToWindow();\n  }\n}\n\nfunction resizeScreenToWindow() {\n  const app = window.world.system.app;\n  const h = Math.max(window.innerHeight - 10, 550);\n  const scale = h / 1000;\n  window.world.system.app.stage.scale.set(scale);\n  app.renderer.resize(h, h);\n  window.world.system.screenHeight = h;\n  window.world.system.screenScale = scale;\n}\n\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n    <App />,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}